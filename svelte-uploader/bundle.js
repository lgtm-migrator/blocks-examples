var app=function(){"use strict";function e(){}function t(e){return e()}function i(){return Object.create(null)}function s(e){e.forEach(t)}function r(e){return"function"==typeof e}function n(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a,o;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(e,t){e.appendChild(t)}function h(e,t,i){e.insertBefore(t,i||null)}function d(e){e.parentNode.removeChild(e)}function u(e){return document.createElement(e)}function p(){return e=" ",document.createTextNode(e);var e}function m(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function g(e,t,i){t in e?e[t]="boolean"==typeof e[t]&&""===i||i:m(e,t,i)}function b(e){o=e}const f=[],_=[],v=[],y=[],w=Promise.resolve();let C=!1;function x(e){v.push(e)}const $=new Set;let T=0;function A(){const e=o;do{for(;T<f.length;){const e=f[T];T++,b(e),k(e.$$)}for(b(null),f.length=0,T=0;_.length;)_.pop()();for(let e=0;e<v.length;e+=1){const t=v[e];$.has(t)||($.add(t),t())}v.length=0}while(f.length);for(;y.length;)y.pop()();C=!1,$.clear(),b(e)}function k(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(x)}}const E=new Set;function S(e,t){-1===e.$$.dirty[0]&&(f.push(e),C||(C=!0,w.then(A)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function I(n,a,l,c,h,u,p,m=[-1]){const g=o;b(n);const f=n.$$={fragment:null,ctx:null,props:u,update:e,not_equal:h,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(g?g.$$.context:[])),callbacks:i(),dirty:m,skip_bound:!1,root:a.target||g.$$.root};p&&p(f.root);let _=!1;if(f.ctx=l?l(n,a.props||{},((e,t,...i)=>{const s=i.length?i[0]:t;return f.ctx&&h(f.ctx[e],f.ctx[e]=s)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](s),_&&S(n,e)),t})):[],f.update(),_=!0,s(f.before_update),f.fragment=!!c&&c(f.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);f.fragment&&f.fragment.l(e),e.forEach(d)}else f.fragment&&f.fragment.c();a.intro&&((v=n.$$.fragment)&&v.i&&(E.delete(v),v.i(y))),function(e,i,n,a){const{fragment:o,on_mount:l,on_destroy:c,after_update:h}=e.$$;o&&o.m(i,n),a||x((()=>{const i=l.map(t).filter(r);c?c.push(...i):s(i),e.$$.on_mount=[]})),h.forEach(x)}(n,a.target,a.anchor,a.customElement),A()}var v,y;b(g)}var U=Object.defineProperty,L=(e,t,i)=>(((e,t,i)=>{t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);var R=class{constructor(e){e.constructor===Object?this.store=function(e){let t=e=>{var i;for(let s in e)(null==(i=e[s])?void 0:i.constructor)===Object&&(e[s]=t(e[s]));return{...e}};return t(e)}(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return this._storeIsProxy||this.store.hasOwnProperty(e)?this.store[e]:(R.warn("read",e),null)}has(e){return this._storeIsProxy?void 0!==this.store[e]:this.store.hasOwnProperty(e)}add(e,t,i=!1){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.notify(e))}pub(e,t){this._storeIsProxy||this.store.hasOwnProperty(e)?(this.store[e]=t,this.notify(e)):R.warn("publish",e)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach((t=>{t(this.store[e])}))}sub(e,t,i=!0){return this._storeIsProxy||this.store.hasOwnProperty(e)?(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t}):(R.warn("subscribe",e),null)}static registerCtx(e,t=Symbol()){let i=R.globalStore.get(t);return i?console.warn('State: context UID "'+t+'" already in use'):(i=new R(e),R.globalStore.set(t,i)),i}static deleteCtx(e){R.globalStore.delete(e)}static getCtx(e,t=!0){return R.globalStore.get(e)||(t&&console.warn('State: wrong context UID - "'+e+'"'),null)}};R.globalStore=new Map;var P=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),O="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",D=O.length-1,M=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+="-"===e[i]?e[i]:O.charAt(Math.random()*D);return t}};function N(e,t,i){let s,r=!0,n=t.split(".");return n.forEach(((t,i)=>{i<n.length-1?e=e[t]:s=t})),e?e[s]=i:r=!1,r}var V="{{",B="}}";var F=[function(e,t){[...e.querySelectorAll(`[${P.REPEAT_ATTR}]`)].forEach((e=>{let i,s=e.getAttribute(P.REPEAT_ITEM_TAG_ATTR);if(s&&(i=window.customElements.get(s)),!i){i=class extends t.BaseComponent{constructor(){super(),s||(this.style.display="contents")}};let r=e.innerHTML;i.template=r,i.reg(s)}for(;e.firstChild;)e.firstChild.remove();let r=e.getAttribute(P.REPEAT_ATTR);t.sub(r,(t=>{if(!t){for(;e.firstChild;)e.firstChild.remove();return}let s,r=[...e.children],n=t=>{t.forEach(((e,t)=>{if(r[t])if(r[t].set$)setTimeout((()=>{r[t].set$(e)}));else for(let i in e)r[t][i]=e[i];else{s||(s=new DocumentFragment);let t=new i;Object.assign(t.init$,e),s.appendChild(t)}})),s&&e.appendChild(s);let n=r.slice(t.length,r.length);for(let e of n)e.remove()};if(t.constructor===Array)n(t);else if(t.constructor===Object){let e=[];for(let i in t){let s=t[i];Object.defineProperty(s,"_KEY_",{value:i,enumerable:!0}),e.push(s)}n(e)}else console.warn("Symbiote repeat data type error:"),console.log(t)})),e.removeAttribute(P.REPEAT_ATTR),e.removeAttribute(P.REPEAT_ITEM_TAG_ATTR)}))},function(e,t){if(t.shadowRoot)return;let i=[...e.querySelectorAll("slot")];if(t.initChildren.length&&i.length){let e={};i.forEach((t=>{let i=t.getAttribute("name");i?e[i]={slot:t,fr:document.createDocumentFragment()}:e.__default__={slot:t,fr:document.createDocumentFragment()}})),t.initChildren.forEach((t=>{var i;let s=null==(i=t.getAttribute)?void 0:i.call(t,"slot");s?(t.removeAttribute("slot"),e[s].fr.appendChild(t)):e.__default__&&e.__default__.fr.appendChild(t)})),Object.values(e).forEach((e=>{e.slot.parentNode.insertBefore(e.fr,e.slot),e.slot.remove()}))}},function(e,t){[...e.querySelectorAll(`[${P.EL_REF_ATTR}]`)].forEach((e=>{let i=e.getAttribute(P.EL_REF_ATTR);t.ref[i]=e,e.removeAttribute(P.EL_REF_ATTR)}))},function(e,t){[...e.querySelectorAll(`[${P.BIND_ATTR}]`)].forEach((e=>{let i=e.getAttribute(P.BIND_ATTR).split(";");[...e.attributes].forEach((t=>{if(t.name.startsWith("-")&&t.value){let s=t.name.replace("-","").split("-").map(((e,t)=>e&&t?e[0].toUpperCase()+e.slice(1):e)).join("").split("_").map(((e,t)=>e&&t?e.toUpperCase():e)).join("");i.push(s+":"+t.value),e.removeAttribute(t.name)}})),i.forEach((i=>{if(!i)return;let s,r=i.split(":").map((e=>e.trim())),n=r[0];0===n.indexOf(P.ATTR_BIND_PRFX)&&(s=!0,n=n.replace(P.ATTR_BIND_PRFX,""));let a=r[1].split(",").map((e=>e.trim()));for(let i of a){let r;i.startsWith("!!")?(r="double",i=i.replace("!!","")):i.startsWith("!")&&(r="single",i=i.replace("!","")),t.sub(i,(t=>{"double"===r?t=!!t:"single"===r&&(t=!t),s?(null==t?void 0:t.constructor)===Boolean?t?e.setAttribute(n,""):e.removeAttribute(n):e.setAttribute(n,t):N(e,n,t)||(e[P.SET_LATER_KEY]||(e[P.SET_LATER_KEY]=Object.create(null)),e[P.SET_LATER_KEY][n]=t)}))}})),e.removeAttribute(P.BIND_ATTR)}))},function(e,t){(function(e){let t,i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>{var t;return!(null==(t=e.parentElement)?void 0:t.hasAttribute("skip-text"))&&e.textContent.includes(V)&&e.textContent.includes(B)&&1}});for(;t=s.nextNode();)i.push(t);return i})(e).forEach((e=>{let i,s=[];for(;e.textContent.includes(B);)e.textContent.startsWith(V)?(i=e.textContent.indexOf(B)+B.length,e.splitText(i),s.push(e)):(i=e.textContent.indexOf(V),e.splitText(i)),e=e.nextSibling;s.forEach((e=>{let i=e.textContent.replace(V,"").replace(B,"");e.textContent="",t.sub(i,(t=>{e.textContent=t}))}))}))}],z=0,j=null,H=null,q=class extends HTMLElement{constructor(){super(),L(this,"updateCssData",(()=>{var e;this.dropCssDataCache(),null==(e=this.__boundCssProps)||e.forEach((e=>{let t=this.getCssData(this.__extractCssName(e),!0);null!==t&&this.$[e]!==t&&(this.$[e]=t)}))})),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return q}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,null==(e=this.initCallback)||e.call(this))}render(e,t=this.renderShadow){let i;if(!t&&!this.constructor.__shadowStylesUrl||this.shadowRoot||this.attachShadow({mode:"open"}),this.allowCustomTemplate){let t=this.getAttribute(P.USE_TPL);if(t){let i=this.getRootNode(),s=(null==i?void 0:i.querySelector(t))||document.querySelector(t);s?e=s.content.cloneNode(!0):console.warn(`Symbiote template "${t}" is not found...`)}}if(this.processInnerHtml)for(let e of this.tplProcessors)e(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(null==e?void 0:e.constructor)===DocumentFragment)i=e;else if((null==e?void 0:e.constructor)===String){let t=document.createElement("template");t.innerHTML=e,i=t.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let e of this.tplProcessors)e(i,this)}let s=()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let e=document.createElement("link");e.rel="stylesheet",e.href=this.constructor.__shadowStylesUrl,e.onload=s,this.shadowRoot.prepend(e)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=M.generate(),this.style.setProperty(P.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(P.CSS_CTX_PROP,!0)}get ctxName(){var e;let t=(null==(e=this.getAttribute(P.CTX_NAME_ATTR))?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=R.registerCtx({},this)),this.__localCtx}get nodeCtx(){return R.getCtx(this.ctxName,!1)||R.registerCtx({},this.ctxName)}static __parseProp(e,t){let i,s;if(e.startsWith(P.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(P.EXT_DATA_CTX_PRFX,"");else if(e.includes(P.NAMED_DATA_CTX_SPLTR)){let t=e.split(P.NAMED_DATA_CTX_SPLTR);i=R.getCtx(t[0]),s=t[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t,i=!0){let s=e=>{this.isConnected&&t(e)},r=q.__parseProp(e,this);r.ctx.has(e)?this.allSubs.add(r.ctx.sub(r.name,s,i)):window.setTimeout((()=>{this.allSubs.add(r.ctx.sub(r.name,s,i))}))}notify(e){let t=q.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=q.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t,i=!1){let s=q.__parseProp(e,this);s.ctx.add(s.name,t,i)}add$(e,t=!1){for(let i in e)this.add(i,e[i],t)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(e,t,i)=>{let s=q.__parseProp(t,this);return s.ctx.pub(s.name,i),!0},get:(e,t)=>{let i=q.__parseProp(t,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(e,t=!1){for(let i in e){let s=e[i],r=[String,Number,Boolean];(t||!r.includes(null==s?void 0:s.constructor)||this.$[i]!==s)&&(this.$[i]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(P.CTX_OWNER_ATTR)&&"false"!==this.getAttribute(P.CTX_OWNER_ATTR)}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let e in this.init$)if(e.startsWith(P.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(P.EXT_DATA_CTX_PRFX,""),this.init$[e],this.__ctxOwner);else if(e.includes(P.NAMED_DATA_CTX_SPLTR)){let t=e.split(P.NAMED_DATA_CTX_SPLTR),i=t[0].trim(),s=t[1].trim();if(i&&s){let t=R.getCtx(i,!1);t||(t=R.registerCtx({},i)),t.add(s,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);for(let e in this.cssInit$)this.bindCssData(e,this.cssInit$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=null==(e=this.getAttribute(P.CTX_NAME_ATTR))?void 0:e.trim();if(t&&this.style.setProperty(P.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this[P.SET_LATER_KEY]){for(let e in this[P.SET_LATER_KEY])N(this,e,this[P.SET_LATER_KEY][e]);delete this[P.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of F)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(null==e?void 0:e.querySelector(`link[${P.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`))return void this.render();let t=this.constructor.__rootStylesLink.cloneNode(!0);t.setAttribute(P.ROOT_STYLE_ATTR_NAME,this.constructor.is),t.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(t):e.prepend(t)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);null==H||H.delete(this.updateCssData),(null==H?void 0:H.size)||(null==j||j.disconnect(),j=null,H=null)}),100)))}static reg(e,t=!1){e||(z++,e=`${P.AUTO_TAG_PRFX}-${z}`),this.__tag=e,window.customElements.get(e)?console.warn(`${e} - is already in "customElements" registry`):window.customElements.define(e,t?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){var s;if(t===i)return;let r=null==(s=this.constructor.__attrDesc)?void 0:s[e];r?this.__dataCtxInitialized?this.$[r]=i:this.init$[r]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[e]=JSON.parse(i)}catch(i){!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map(((e,t)=>0===t?"":e)).join("--")}__initStyleAttrObserver(){H||(H=new Set),H.add(this.updateCssData),j||(j=new MutationObserver((e=>{"attributes"===e[0].type&&H.forEach((e=>{e()}))}))).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]})}bindCssData(e,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let i=this.getCssData(this.__extractCssName(e),!0);null===i&&(i=t),this.add(e,i),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:e=>{this[s]=e,i?window.setTimeout((()=>{null==t||t(e)})):null==t||t(e)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(e){if(!this.__rootStylesLink){let t=new Blob([e],{type:"text/css"}),i=URL.createObjectURL(t),s=document.createElement("link");s.href=i,s.rel="stylesheet",this.__rootStylesLink=s}}},K=q;function X(e={tag:"div"}){let t=document.createElement(e.tag);if(e.attributes&&function(e,t){for(let i in t)t[i].constructor===Boolean?t[i]?e.setAttribute(i,""):e.removeAttribute(i):e.setAttribute(i,t[i])}(t,e.attributes),e.styles&&function(e,t){for(let i in t)i.includes("-")?e.style.setProperty(i,t[i]):e.style[i]=t[i]}(t,e.styles),e.properties)for(let i in e.properties)t[i]=e.properties[i];return e.processors&&e.processors.forEach((e=>{e(t)})),e.children&&e.children.forEach((e=>{let i=X(e);t.appendChild(i)})),t}L(K,"template");var W="idb-store-ready",G=class{static get readyEventName(){return W}static open(e="symbiote-db",t="store"){let i=e+"/"+t;return this._reg[i]||(this._reg[i]=new class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(W,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return"symbiote-idb-update_"+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,t){this.name=e,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=e=>{this._notifyWhenReady(e)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach((async t=>{t(await this.read(e.newValue))}))},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise(((i,s)=>{t.onsuccess=t=>{var s;(null==(s=t.target.result)?void 0:s._value)?i(t.target.result._value):(i(null),console.warn(`IDB: cannot read "${e}"`))},t.onerror=e=>{s(e)}}))}write(e,t,i=!1){let s={_key:e,_value:t},r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise(((t,s)=>{r.onsuccess=s=>{i||this._notifySubscribers(e),t(s.target.result)},r.onerror=e=>{s(e)}}))}delete(e,t=!1){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise(((s,r)=>{i.onsuccess=i=>{t||this._notifySubscribers(e),s(i)},i.onerror=e=>{r(e)}}))}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise(((t,i)=>{e.onsuccess=e=>{let i=e.target.result;t(i.map((e=>e._value)))},e.onerror=e=>{i(e)}}))}subscribe(e,t){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let i=this._subscriptionsMap[e];return i.add(t),{remove:()=>{i.delete(t),i.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,G.clear(this.name)}}(e,t)),this._reg[i]}static clear(e){window.indexedDB.deleteDatabase(e);for(let t in this._reg)t.split("/")[0]===e&&delete this._reg[t]}};L(G,"_reg",Object.create(null));const Y=e=>e;function J(e,t,i={}){let{openToken:s="{{",closeToken:r="}}",transform:n=Y}=i;for(let i in t){let a=t[i]?.toString();e=e.replaceAll(s+i+r,"string"==typeof a?n(a):a)}return e}function Z(e,t){[...e.querySelectorAll("[l10n]")].forEach((e=>{let i=e.getAttribute("l10n"),s="textContent";if(i.includes(":")){let e=i.split(":");s=e[0],i=e[1]}let r="l10n:"+i;t.__l10nKeys.push(r),t.add(r,i),t.sub(r,(i=>{e[s]=t.l10n(i)})),e.removeAttribute("l10n")}))}const Q=()=>({"*ctxTargetsRegistry":new Map}),ee=()=>({...Q(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*activityCaption":"","*activityIcon":""}),te=()=>({...ee(),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null});class ie extends K{allowCustomTemplate=!0;ctxInit=Q();init$=this.ctxInit;l10n(e,t={}){return J(this.getCssData("--l10n-"+e,!0)||e,t)}constructor(){super(),this.activityType=null,this.addTemplateProcessor(Z),this.__l10nKeys=[]}applyL10nKey(e,t){let i="l10n:"+e;this.$[i]=t,this.__l10nKeys.push(e)}checkCtxTarget(e){return this.$["*ctxTargetsRegistry"]?.has(e)}setForCtxTarget(e,t,i){this.checkCtxTarget(e)&&(this.$[t]=i)}connectedCallback(){if(this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){let e=R.getCtx(this.ctxName,!1);e&&(e.store={...this.ctxInit})}super.connectedCallback()}initCallback(){let e=this.constructor.is,t=this.$["*ctxTargetsRegistry"],i=t.has(e)?t.get(e)+1:1;t.set(e,i),this.$["*ctxTargetsRegistry"]=t}destroyCallback(){let e=this.constructor.is,t=this.$["*ctxTargetsRegistry"],i=t.has(t)?t.get(e)-1:0;0===i?t.delete(e):t.set(e,i),this.$["*ctxTargetsRegistry"]=t}fileSizeFmt(e,t=2){let i=["B","KB","MB","GB","TB"],s=e=>this.getCssData("--l10n-unit-"+e.toLowerCase(),!0)||e;if(0===e)return`0 ${s(i[0])}`;let r=t<0?0:t,n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/1024**n).toFixed(r))+" "+s(i[n])}proxyUrl(e){let t=this.getCssData("--cfg-secure-delivery-proxy",!0);return t?J(t,{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}static reg(e){e?super.reg(e.startsWith("lr-")?e:"lr-"+e):super.reg()}}function se(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}const re="active",ne="___ACTIVITY_IS_ACTIVE___";class ae extends ie{ctxInit=ee();_debouncedHistoryFlush=se(this._historyFlush.bind(this),10);initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",(e=>{this.setAttribute("current-activity",e)})),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(e=>{let t=this.ctxName+this.activityType,i=ae._activityRegistry[t];this.activityType!==e&&this[ne]?(this[ne]=!1,this.removeAttribute(re),i?.deactivateCallback?.()):this.activityType!==e||this[ne]||(this[ne]=!0,this.setAttribute(re,""),this.setForCtxTarget("lr-modal","*modalCloseCallback",i?.modalCloseCallback),i?.activateCallback?.(),this._debouncedHistoryFlush()),e||(this.$["*history"]=[])})))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),e.push(this.activityType),this.$["*history"]=e)}static _activityRegistry=Object.create(null);get isActivityActive(){return this[ne]}registerActivity(e,t){const{onActivate:i,onDeactivate:s,onClose:r}=t;ae._activityRegistry||(ae._activityRegistry=Object.create(null));let n=this.ctxName+e;ae._activityRegistry[n]={activateCallback:i,deactivateCallback:s,modalCloseCallback:r}}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){e.pop();let t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e}}}ae.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});const oe=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],le=e=>e?e.map((e=>e?.split(","))).flat().filter((e=>"string"==typeof e&&e)).map((e=>e.trim())):[],ce=(e,t)=>t.some((t=>t.endsWith("*")?(t=t.replace("*",""),e.startsWith(t)):e===t)),he=e=>{let t=e?.type;return!!t&&ce(t,oe)};class de extends Error{constructor(e,t,i,s,r){super(),this.name="UploadClientError",this.message=e,this.code=t,this.request=i,this.response=s,this.headers=r,Object.setPrototypeOf(this,de.prototype)}}const ue=(e="Request canceled")=>{const t=new de(e);return t.isCancel=!0,t},pe=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))},me=({method:e,url:t,data:i,headers:s={},signal:r,onProgress:n})=>new Promise(((a,o)=>{const l=new XMLHttpRequest,c=e?.toUpperCase()||"GET";let h=!1;l.open(c,t,!0),s&&Object.entries(s).forEach((e=>{const[t,i]=e;void 0!==i&&!Array.isArray(i)&&l.setRequestHeader(t,i)})),l.responseType="text",pe(r,(()=>{h=!0,l.abort(),o(ue())})),l.onload=()=>{if(200!=l.status)o(new Error(`Error ${l.status}: ${l.statusText}`));else{const e={method:c,url:t,data:i,headers:s||void 0,signal:r,onProgress:n},o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),h={};o.forEach((function(e){const t=e.split(": "),i=t.shift(),s=t.join(": ");i&&void 0!==i&&(h[i]=s)}));const d=l.response,u=l.status;a({request:e,data:d,headers:h,status:u})}},l.onerror=()=>{h||o(new Error("Network error"))},n&&"function"==typeof n&&(l.upload.onprogress=e=>{e.lengthComputable?n({isComputable:!0,value:e.loaded/e.total}):n({isComputable:!1})}),i?l.send(i):l.send()}));const ge=function(e){return e};const be=e=>void 0!==e&&("undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Buffer&&e instanceof Buffer),fe=e=>{const t=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!be(e)&&t.test(e)},_e=e=>{const t=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!be(e)&&t.test(e)};function ve(e,t,i){if((s=i)&&"object"==typeof s&&"data"in s&&be(s.data)){const{name:s,contentType:r}=i,n=ge(i.data),a=(({name:e})=>e?[e]:[])({name:s,contentType:r});e.push([t,n,...a])}else if((e=>!!e&&"object"==typeof e&&!Array.isArray(e))(i))for(const[s,r]of Object.entries(i))void 0!==r&&e.push([`${t}[${s}]`,String(r)]);else(e=>"string"==typeof e||"number"==typeof e||void 0===e)(i)&&i&&e.push([t,i.toString()]);var s}function ye(e){const t=new FormData,i=function(e){const t=[];for(const[i,s]of Object.entries(e))ve(t,i,s);return t}(e);for(const e of i){const[i,s,...r]=e;t.append(i,s,...r)}return t}const we=(e,t,i)=>{const s=new URL(e);return s.pathname=(s.pathname+t).replace("//","/"),i&&(s.search=(e=>{const t=new URLSearchParams;for(const[i,s]of Object.entries(e))s&&"object"==typeof s&&!Array.isArray(s)?Object.entries(s).filter((e=>e[1]??!1)).forEach((e=>t.set(`${i}[${e[0]}]`,String(e[1])))):Array.isArray(s)?s.forEach((e=>{t.append(`${i}[]`,e)})):"string"==typeof s&&s?t.set(i,s):"number"==typeof s&&t.set(i,s.toString());return t.toString()})(i)),s.toString()},Ce="https://ucarecdn.com",xe="https://upload.uploadcare.com",$e=1,Te=26214400,Ae=5242880,ke=4,Ee=3,Se="79ae88bd931ea68464d9",Ie="original";function Ue(e){return"[object Object]"===Object.prototype.toString.call(e)}const Le=/\W|_/g;function Re(e){return e.split(Le).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join("")}function Pe(e,{ignoreKeys:t}={ignoreKeys:[]}){return Array.isArray(e)?e.map((e=>Oe(e,{ignoreKeys:t}))):e}function Oe(e,{ignoreKeys:t}={ignoreKeys:[]}){if(Array.isArray(e))return Pe(e,{ignoreKeys:t});if(!Ue(e))return e;const i={};for(const s of Object.keys(e)){let r=e[s];t.includes(s)?i[s]=r:(Ue(r)?r=Oe(r,{ignoreKeys:t}):Array.isArray(r)&&(r=Pe(r,{ignoreKeys:t})),i[Re(s)]=r)}return i}function De({libraryName:e,libraryVersion:t,userAgent:i,publicKey:s="",integration:r=""}){const n="JavaScript";if("string"==typeof i)return i;if("function"==typeof i)return i({publicKey:s,libraryName:e,libraryVersion:t,languageName:n,integration:r});return`${[e,t,s].filter(Boolean).join("/")} (${[n,r].filter(Boolean).join("; ")})`}const Me={factor:2,time:100};function Ne(e,t=Me){let i=0;return function e(s){const r=Math.round(t.time*t.factor**i);return s({attempt:i,retry:t=>(e=>new Promise((t=>setTimeout(t,e))))(t??r).then((()=>(i+=1,e(s))))})}(e)}function Ve(e){return De({libraryName:"UploadcareUploadClient",libraryVersion:"4.3.1",...e})}function Be(e,t){return Ne((({attempt:i,retry:s})=>e().catch((e=>{if("response"in e&&"RequestThrottledError"===e?.code&&i<t)return s(function(e){const{headers:t}=e||{};return t&&1e3*Number.parseInt(t["x-throttle-wait-seconds"])||15e3}(e));throw e}))))}function Fe(e){return void 0===e?"auto":e?"1":"0"}var ze,je;!function(e){e.Token="token",e.FileInfo="file_info"}(ze||(ze={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(je||(je={}));function He(e,{publicKey:t,baseURL:i=xe,signal:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a=$e}={}){return Be((()=>me({method:"GET",headers:t?{"X-UC-User-Agent":Ve({publicKey:t,integration:r,userAgent:n})}:void 0,url:we(i,"/from_url/status/",{jsonerrors:1,token:e}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s&&!(e=>"status"in e&&e.status===je.Error)(s))throw new de(s.error.content,void 0,i,s,t);return s}))),a)}function qe(e,{publicKey:t,baseURL:i=xe,signal:s,source:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=$e}){return Be((()=>me({method:"GET",headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:n,userAgent:a})},url:we(i,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:r}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s}))),o)}class Ke{constructor(e,{baseCDN:t,fileName:i}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.s3Url=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null,this.contentInfo=null,this.metadata=null,this.s3Bucket=null;const{uuid:s,s3Bucket:r}=e,n=`${t}/${s}/`,a=r?`https://${r}.s3.amazonaws.com/${s}/${e.filename}`:null;this.uuid=s,this.name=i||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=n,this.originalFilename=e.originalFilename,this.imageInfo=e.imageInfo,this.videoInfo=e.videoInfo,this.contentInfo=e.contentInfo,this.metadata=e.metadata||null,this.s3Bucket=r||null,this.s3Url=a}}const Xe=({check:e,interval:t=500,signal:i})=>new Promise(((s,r)=>{let n;pe(i,(()=>{n&&clearTimeout(n),r(ue("Poll cancelled"))}));const a=()=>{try{Promise.resolve(e(i)).then((e=>{e?s(e):n=setTimeout(a,t)})).catch((e=>r(e)))}catch(e){r(e)}};n=setTimeout(a,0)}));function We({file:e,publicKey:t,baseURL:i,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,signal:o,onProgress:l}){return Xe({check:o=>qe(e,{publicKey:t,baseURL:i,signal:o,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a}).then((e=>e.isReady?e:(l&&l({isComputable:!0,value:1}),!1))),signal:o})}const Ge=(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,contentType:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,baseCDN:m,metadata:g})=>function(e,{publicKey:t,fileName:i,contentType:s,baseURL:r=xe,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=$e,metadata:m}){return Be((()=>me({method:"POST",url:we(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:d,userAgent:u})},data:ye({file:{data:e,name:i??e.name??Ie,contentType:s},UPLOADCARE_PUB_KEY:t,UPLOADCARE_STORE:Fe(o),signature:n,expire:a,source:h,metadata:m}),signal:l,onProgress:c}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s}))),p)}(e,{publicKey:t,fileName:i,contentType:o,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,metadata:g}).then((({file:e})=>We({file:e,publicKey:t,baseURL:s,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((e=>new Ke(e,{baseCDN:m}))),Ye=(e,{signal:t}={})=>{let i=null,s=null;const r=e.map((()=>new AbortController));return pe(t,(()=>{r.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const n=(e=>()=>{s=e,r.forEach(((t,i)=>i!==e&&t.abort()))})(t);return Promise.resolve().then((()=>e({stopRace:n,signal:r[t].signal}))).then((e=>(n(),e))).catch((e=>(i=e,null)))}))).then((e=>{if(null===s)throw i;return e[s]}))};var Je=window.WebSocket;class Ze{constructor(){this.events=Object.create({})}emit(e,t){this.events[e]?.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}}class Qe{constructor(e,t=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Ze,this.disconnectTimeoutId=null,this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Je(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,((e,t)=>"success"===e?{status:je.Success,...t}:"progress"===e?{status:je.Progress,...t}:{status:je.Error,...t})(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){const i=JSON.stringify({event:e,data:t});this.ws?.send(i)}subscribe(e,t){this.subscribers+=1,this.connect();const i=`task-status-${e}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(e){this.subscribers-=1;const t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}}let et=null;const tt=e=>{if(!et){const t="undefined"==typeof window?0:3e4;et=new Qe(e,t)}return et};const it=(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,onProgress:d,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:b=Se,metadata:f})=>{return Promise.resolve((_=b,void tt(_).connect())).then((()=>function(e,{publicKey:t,baseURL:i=xe,store:s,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=$e,metadata:m}){return Be((()=>me({method:"POST",headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:d,userAgent:u})},url:we(i,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:Fe(s),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c,metadata:m}),signal:h}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s}))),p)}(e,{publicKey:t,fileName:i,baseURL:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,metadata:f}))).catch((e=>(tt(b)?.disconnect(),Promise.reject(e)))).then((e=>e.type===ze.FileInfo?e:Ye([({signal:i})=>function({token:e,publicKey:t,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,onProgress:a,signal:o}){return Xe({check:o=>He(e,{publicKey:t,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,signal:o}).then((t=>{switch(t.status){case je.Error:return new de(t.error,t.errorCode);case je.Waiting:return!1;case je.Unknown:return new de(`Token "${e}" was not found.`);case je.Progress:return a&&("unknown"===t.total?a({isComputable:!1}):a({isComputable:!0,value:t.done/t.total})),!1;case je.Success:return a&&a({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:o})}({token:e.token,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:i}),({signal:t})=>(({token:e,pusherKey:t,signal:i,onProgress:s})=>new Promise(((r,n)=>{const a=tt(t),o=a.onError(n),l=()=>{o(),a.unsubscribe(e)};pe(i,(()=>{l(),n(ue("pusher cancelled"))})),a.subscribe(e,(e=>{switch(e.status){case je.Progress:s&&("unknown"===e.total?s({isComputable:!1}):s({isComputable:!0,value:e.done/e.total}));break;case je.Success:l(),s&&s({isComputable:!0,value:e.done/e.total}),r(e);break;case je.Error:l(),n(new de(e.msg,e.error_code))}}))})))({token:e.token,pusherKey:b,signal:t,onProgress:d})],{signal:h}))).then((e=>{if(e instanceof de)throw e;return e})).then((e=>We({file:e.uuid,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:h}))).then((e=>new Ke(e,{baseCDN:r})));var _},st=e=>e.length||e.size;function rt(e,t,i){return s=>((e,t,i,s)=>{const r=s*t,n=Math.min(r+s,i);return e.slice(r,n)})(e,s,t,i)}const nt=(e,t,{publicKey:i,onProgress:s,signal:r,integration:n,multipartMaxAttempts:a})=>Ne((({attempt:o,retry:l})=>function(e,t,{signal:i,onProgress:s}){return me({method:"PUT",url:t,data:e,onProgress:s,signal:i}).then((e=>(s&&s({isComputable:!0,value:1}),e))).then((({status:e})=>({code:e})))}(e,t,{publicKey:i,onProgress:s,signal:r,integration:n}).catch((e=>{if(o<a)return l();throw e})))),at=(e,{publicKey:t,fileName:i,fileSize:s,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,contentType:m,multipartChunkSize:g=Ae,maxConcurrentRequests:b=ke,multipartMaxAttempts:f=Ee,baseCDN:_,metadata:v})=>{const y=s||st(e);let w;const C=(e,t)=>{if(!c)return;w||(w=Array(e).fill(0));return i=>{var s;i.isComputable&&(w[t]=i.value,c({isComputable:!0,value:(s=w,s.reduce(((e,t)=>e+t),0)/e)}))}};return function(e,{publicKey:t,contentType:i,fileName:s,multipartChunkSize:r=Ae,baseURL:n="",secureSignature:a,secureExpire:o,store:l,signal:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=$e,metadata:m}){return Be((()=>me({method:"POST",url:we(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:d,userAgent:u})},data:ye({filename:s??Ie,size:e,content_type:i??"application/octet-stream",part_size:r,UPLOADCARE_STORE:Fe(l),UPLOADCARE_PUB_KEY:t,signature:a,expire:o,source:h,metadata:m}),signal:c}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s.parts=Object.keys(s.parts).map((e=>s.parts[e])),s}))),p)}(y,{publicKey:t,contentType:m,fileName:i??e.name,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,metadata:v}).then((({uuid:i,parts:s})=>{const r=rt(e,y,g);return Promise.all([i,(n=b,a=s.map(((e,i)=>()=>nt(r(i),e,{publicKey:t,onProgress:C(s.length,i),signal:l,integration:d,multipartMaxAttempts:f}))),new Promise(((e,t)=>{const i=[];let s=!1,r=a.length;const o=[...a],l=()=>{const n=a.length-o.length,c=o.shift();c&&c().then((t=>{s||(i[n]=t,r-=1,r?l():e(i))})).catch((e=>{s=!0,t(e)}))};for(let e=0;e<n;e++)l()})))]);var n,a})).then((([e])=>function(e,{publicKey:t,baseURL:i=xe,source:s="local",signal:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=$e}){return Be((()=>me({method:"POST",url:we(i,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:n,userAgent:a})},data:ye({uuid:e,UPLOADCARE_PUB_KEY:t,source:s}),signal:r}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s}))),o)}(e,{publicKey:t,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p}))).then((e=>e.isReady?e:We({file:e.uuid,publicKey:t,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((e=>new Ke(e,{baseCDN:_})))};function ot(e,{publicKey:t,fileName:i,baseURL:s=xe,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartMinFileSize:m,multipartChunkSize:g,multipartMaxAttempts:b,maxConcurrentRequests:f,baseCDN:_=Ce,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y,pusherKey:w,metadata:C}){if(be(e)){return((e,t=Te)=>e>=t)(st(e),m)?at(e,{publicKey:t,contentType:p,multipartChunkSize:g,multipartMaxAttempts:b,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,maxConcurrentRequests:f,retryThrottledRequestMaxTimes:u,baseCDN:_,metadata:C}):Ge(e,{publicKey:t,fileName:i,contentType:p,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:_,metadata:C})}if(_e(e))return it(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:_,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,pusherKey:w,metadata:C});if(fe(e))return((e,{publicKey:t,fileName:i,baseURL:s,signal:r,onProgress:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,baseCDN:h})=>qe(e,{publicKey:t,baseURL:s,signal:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c}).then((e=>new Ke(e,{baseCDN:h,fileName:i}))).then((e=>(n&&n({isComputable:!0,value:1}),e))))(e,{publicKey:t,fileName:i,baseURL:s,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:_});throw new TypeError(`File uploading from "${e}" is not supported`)}class lt{constructor(e,t){this.storedAt=null,this.uuid=e.id,this.filesCount=e.filesCount,this.totalSize=Object.values(e.files).reduce(((e,t)=>e+t.size),0),this.isStored=!!e.datetimeStored,this.isImage=!!Object.values(e.files).filter((e=>e.isImage)).length,this.cdnUrl=e.cdnUrl,this.files=t,this.createdAt=e.datetimeCreated,this.storedAt=e.datetimeStored}}function ct(e,{publicKey:t,fileName:i,baseURL:s=xe,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartChunkSize:m=Ae,baseCDN:g=Ce,jsonpCallback:b}){if(!(e=>{for(const t of e)if(!be(t))return!1;return!0})(e)&&!(e=>{for(const t of e)if(!_e(t))return!1;return!0})(e)&&!(e=>{for(const t of e)if(!fe(t))return!1;return!0})(e))throw new TypeError(`Group uploading from "${e}" is not supported`);let f,_=!0;const v=e.length,y=(e,t)=>{if(!l)return;f||(f=Array(e).fill(0));return i=>{if(!i.isComputable||!_)return _=!1,void l({isComputable:!1});var s;f[t]=i.value,l({isComputable:!0,value:(s=f,s.reduce(((e,t)=>e+t))/e)})}};return Promise.all(e.map(((e,l)=>ot(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:y(v,l),source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartChunkSize:m,baseCDN:g})))).then((e=>function(e,{publicKey:t,baseURL:i=xe,jsonpCallback:s,secureSignature:r,secureExpire:n,signal:a,source:o,integration:l,userAgent:c,retryThrottledRequestMaxTimes:h=$e}){return Be((()=>me({method:"POST",headers:{"X-UC-User-Agent":Ve({publicKey:t,integration:l,userAgent:c})},url:we(i,"/group/",{jsonerrors:1,pub_key:t,files:e,callback:s,signature:r,expire:n,source:o}),signal:a}).then((({data:e,headers:t,request:i})=>{const s=Oe(JSON.parse(e));if("error"in s)throw new de(s.error.content,s.error.errorCode,i,s,t);return s}))),h)}(e.map((e=>e.uuid)),{publicKey:t,baseURL:s,jsonpCallback:b,secureSignature:r,secureExpire:n,signal:o,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u}).then((t=>new lt(t,e))).then((e=>(l&&l({isComputable:!0,value:1}),e)))))}const ht=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:Ke,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0}});function dt(e){return De({...e,libraryName:"blocks",libraryVersion:"0.13.0"})}const ut="[Typed State] Wrong property name: ";class pt{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||M.generate(),this.__schema=Object.keys(e).reduce(((t,i)=>(t[i]=e[i].value,t)),{}),this.__data=R.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e))return void console.warn(ut+e);let i=this.__typedSchema[e];t?.constructor===i.type||t instanceof i.type||i.nullable&&null===t?this.__data.pub(e,t):console.warn("[Typed State] Wrong property type: "+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(this.__typedSchema.hasOwnProperty(e))return this.__data.read(e);console.warn(ut+e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){R.deleteCtx(this.__ctxId)}}class mt{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||M.generate(),this.__data=R.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[],this.__handler=e.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(e,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(i),this.__observeTimeout=window.setTimeout((()=>{this.__observers.forEach((e=>{e({...t})})),t=Object.create(null)}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{let e=this.__added,t=this.__removed;this.__added.clear(),this.__removed.clear(),this.__handler?.([...this.__items],e,t)}))}add(e){let t=new pt(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach((e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,(()=>{this.__notifyObservers(e,t.uid)})))})),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__removed.add(this.__data.read(e)),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach((e=>{this.remove(e)}))}observe(e){this.__observers.add(e)}unobserve(e){this.__observers.delete(e)}findItems(e){let t=[];return this.__items.forEach((i=>{let s=this.read(i);e(s)&&t.push(i)})),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){R.deleteCtx(this.__data),this.__observers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach((e=>{e.remove()})),delete this.__subsMap[e]}}const gt={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT"};class bt{constructor(e){this.ctx=e.ctx,this.type=e.type,this.data=e.data}}class ft{static eName(e){return"LR_"+e}static _timeoutStore=Object.create(null);static emit(e,t=window,i=!0){let s=()=>{t.dispatchEvent(new CustomEvent(this.eName(e.type),{detail:e}))};if(!i)return void s();let r=e.type+e.ctx;this._timeoutStore[r]&&window.clearTimeout(this._timeoutStore[r]),this._timeoutStore[r]=window.setTimeout((()=>{s(),delete this._timeoutStore[r]}),20)}}class _t extends ae{ctxInit=te();__initialUploadMetadata=null;setUploadMetadata(e){this.connectedOnce?this.$["*uploadMetadata"]=e:this.__initialUploadMetadata=e}initCallback(){super.initCallback(),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}destroyCallback(){super.destroyCallback(),0===this.$["*ctxTargetsRegistry"]?.size&&this.uploadCollection.unobserve(this._handleCollectionUpdate)}addFiles(e){e.forEach((e=>{this.uploadCollection.add({file:e,isImage:he(e),mimeType:e.type,fileName:e.name,fileSize:e.size})}))}openSystemDialog(){let e=le([this.getCssData("--cfg-accept"),...this.getCssData("--cfg-img-only")?oe:[]]).join(",");this.getCssData("--cfg-accept")&&this.getCssData("--cfg-img-only")&&console.warn("There could be a mistake.\nBoth `--cfg-accept` and `--cfg-img-only` parameters are set.\nThe value of `--cfg-accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.getCssData("--cfg-multiple"),this.fileInput.accept=e,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=ae.activities.UPLOAD_LIST,this.fileInput.value="",this.fileInput=null}}get sourceList(){let e=null;return this.getCssData("--cfg-source-list")&&(e=this.getCssData("--cfg-source-list").split(",").map((e=>e.trim()))),e}initFlow(e=!1){if(this.$["*uploadList"]?.length&&!e)this.set$({"*currentActivity":ae.activities.UPLOAD_LIST}),this.setForCtxTarget("lr-modal","*modalActive",!0);else if(1===this.sourceList?.length){let e=this.sourceList[0];"local"===e?(this.$["*currentActivity"]=ae.activities.UPLOAD_LIST,this?.openSystemDialog()):(Object.values(Block.extSrcList).includes(e)?this.set$({"*currentActivityParams":{externalSourceType:e},"*currentActivity":ae.activities.EXTERNAL}):this.$["*currentActivity"]=e,this.setForCtxTarget("lr-modal","*modalActive",!0))}else this.set$({"*currentActivity":ae.activities.START_FROM}),this.setForCtxTarget("lr-modal","*modalActive",!0)}cancelFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setForCtxTarget("lr-modal","*modalActive",!1)}get uploadCollection(){if(!this.has("*uploadCollection")){let e=new mt({typedSchema:ht,watchList:["uploadProgress","uuid","uploadError","validationErrorMsg","cdnUrlModifiers"],handler:(e,t,i)=>{for(let e of i)e?.getValue("abortController")?.abort(),e?.setValue("abortController",null),URL.revokeObjectURL(e?.getValue("thumbUrl"));this.$["*uploadList"]=e.map((e=>({uid:e})))}});e.observe(this._handleCollectionUpdate),this.add("*uploadCollection",e)}return this.$["*uploadCollection"]}_handleCollectionUpdate=e=>{let t=this.uploadCollection;if(e.uploadProgress){let e=0,i=t.findItems((e=>!e.getValue("uploadError")));i.forEach((i=>{e+=t.readProp(i,"uploadProgress")}));let s=Math.round(e/i.length);this.$["*commonProgress"]=s,ft.emit(new bt({type:gt.UPLOAD_PROGRESS,ctx:this.ctxName,data:s}),void 0,100===s)}if(e.uuid){let e=t.findItems((e=>!!e.getValue("uuid"))),i=t.findItems((e=>!!e.getValue("uploadError")||!!e.getValue("validationErrorMsg")));if(t.size-i.length===e.length){let e=this.getOutputData((e=>!!e.getValue("uuid")));ft.emit(new bt({type:gt.UPLOAD_FINISH,ctx:this.ctxName,data:e}))}}if(e.uploadError){t.findItems((e=>!!e.getValue("uploadError"))).forEach((e=>{ft.emit(new bt({type:gt.UPLOAD_ERROR,ctx:this.ctxName,data:t.readProp(e,"uploadError")}),void 0,!1)}))}if(e.validationErrorMsg){t.findItems((e=>!!e.getValue("validationErrorMsg"))).forEach((e=>{ft.emit(new bt({type:gt.VALIDATION_ERROR,ctx:this.ctxName,data:t.readProp(e,"validationErrorMsg")}),void 0,!1)}))}if(e.cdnUrlModifiers){t.findItems((e=>!!e.getValue("cdnUrlModifiers"))).forEach((e=>{ft.emit(new bt({type:gt.CDN_MODIFICATION,ctx:this.ctxName,data:t.readProp(e,"cdnUrlModifiers")}),void 0,!1)}))}};getUploadClientOptions(){let e={},t=this.getCssData("--cfg-store");null!==t&&(e.store=!!t);let i={...e,publicKey:this.getCssData("--cfg-pubkey"),baseCDN:this.getCssData("--cfg-cdn-cname"),baseURL:this.getCssData("--cfg-base-url"),userAgent:dt,integration:this.getCssData("--cfg-user-agent-integration"),secureSignature:this.getCssData("--cfg-secure-signature"),secureExpire:this.getCssData("--cfg-secure-expire"),retryThrottledRequestMaxTimes:this.getCssData("--cfg-retry-throttled-request-max-times"),multipartMinFileSize:this.getCssData("--cfg-multipart-min-file-size"),multipartChunkSize:this.getCssData("--cfg-multipart-chunk-size"),maxConcurrentRequests:this.getCssData("--cfg-max-concurrent-requests"),multipartMaxAttempts:this.getCssData("--cfg-multipart-max-attempts"),checkForUrlDuplicates:!!this.getCssData("--cfg-check-for-url-duplicates"),saveUrlForRecurrentUploads:!!this.getCssData("--cfg-save-url-for-recurrent-uploads"),metadata:this.$["*uploadMetadata"]};return console.log("Upload client options:",i),i}getOutputData(e){let t=[];return this.uploadCollection.findItems(e).forEach((e=>{let i=R.getCtx(e).store,s=i.fileInfo||{name:i.fileName,fileSize:i.fileSize,isImage:i.isImage,mimeType:i.mimeType},r={...s,cdnUrlModifiers:i.cdnUrlModifiers,cdnUrl:i.cdnUrl||s.cdnUrl};t.push(r)})),t}}_t.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",..._t.extSrcList}),_t.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),Object.keys(gt).forEach((e=>{let t=ft.eName(e);window.addEventListener(t,(e=>{if([gt.UPLOAD_FINISH,gt.REMOVE].includes(e.detail.type)){let t=R.getCtx(e.detail.ctx),i=t.read("uploadCollection"),s=[];i.items().forEach((e=>{let t=R.getCtx(e).store,i=t.fileInfo;if(i){let e={...i,cdnUrlModifiers:t.cdnUrlModifiers,cdnUrl:t.cdnUrl||i.cdnUrl};s.push(e)}})),ft.emit(new bt({type:gt.DATA_OUTPUT,ctx:e.detail.ctx,data:s})),t.pub("outputData",s)}}))}));class vt extends ie{init$={...this.ctxInit,name:"",path:"",size:"24",viewBox:""};initCallback(){super.initCallback(),this.sub("name",(e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)})),this.sub("path",(e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path d="${e}"></path>`)})),this.sub("size",(e=>{this.$.viewBox=`0 0 ${e} ${e}`}))}}vt.template='\n  <svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>\n',vt.bindAttributes({name:"name",size:"size"});const yt=(...e)=>e.filter((e=>"string"==typeof e&&e)).map((e=>(e=>{if("string"!=typeof e||!e)return"";let t=e.trim();return t.startsWith("-/")?t=t.slice(2):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,t.length-1)),t})(e))).join("/-/"),wt=(...e)=>{let t=yt(...e);return t?`-/${t}/`:""};function Ct(e){let t=new URL(e),i=t.pathname+t.search+t.hash,s=i.lastIndexOf("http"),r=i.lastIndexOf("/"),n="";return s>=0?n=i.slice(s):r>=0&&(n=i.slice(r+1)),n}function xt(e){return e.startsWith("http")}function $t(e){let t=new URL(e);return{pathname:t.origin+t.pathname||"",search:t.search||"",hash:t.hash||""}}const Tt=(e,t,i)=>{let s=new URL(function(e){let t=new URL(e),i=Ct(e),s=xt(i)?$t(i).pathname:i;return t.pathname=t.pathname.replace(s,""),t.search="",t.hash="",t.toString()}(e));if(i=i||Ct(e),s.pathname.startsWith("//")&&(s.pathname=s.pathname.replace("//","/")),xt(i)){let e=$t(i);s.pathname=s.pathname+(t||"")+(e.pathname||""),s.search=e.search,s.hash=e.hash}else s.pathname=s.pathname+(t||"")+(i||"");return s.toString()},At=(e,t)=>{let i=new URL(e);return i.pathname=t+"/",i.toString()},kt=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:"https://ucarecdn.com"},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}}),Et="--lr-img-",St="unresolved",It=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Ut=Object.create(null);for(let e in kt)Ut[Et+e]=kt[e]?.default||"";class Lt extends K{cssInit$=Ut;$$(e){return this.$[Et+e]}set$$(e){for(let t in e)this.$[Et+t]=e[t]}sub$$(e,t){this.sub(Et+e,(e=>{null!==e&&""!==e&&t(e)}))}_fmtAbs(e){return!e.includes("//")&&!It&&(e=new URL(e,document.baseURI).href),e}_getCdnModifiers(e=""){return wt(e&&`resize/${e}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||kt.format.default}`,`quality/${this.$$("quality")||kt.quality.default}`)}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(It&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);return this.$$("src").startsWith(this.$$("cdn-cname"))?Tt(this.$$("src"),t):this.$$("cdn-cname")&&this.$$("uuid")||this.$$("uuid")?this._proxyUrl(Tt(At(this.$$("cdn-cname"),this.$$("uuid")),t)):this.$$("proxy-cname")?this._proxyUrl(Tt(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src")))):this.$$("pubkey")?this._proxyUrl(Tt(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src")))):void 0}_proxyUrl(e){return this.$$("secure-delivery-proxy")?J(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}_getElSize(e,t=1,i=!0){let s=e.getBoundingClientRect(),r=t*Math.round(s.width),n=i?"":t*Math.round(s.height);return r||n?`${r||""}x${n||""}`:null}_setupEventProxy(e){let t=e=>{e.stopPropagation();let t=new Event(e.type,e);this.dispatchEvent(t)},i=["load","error"];for(let s of i)e.addEventListener(s,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(St,""),this.img.onload=()=>{this.img.removeAttribute(St)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach((e=>{kt[e.name]||this.img.setAttribute(e.name,e.value)}))}get breakpoints(){if(this.$$("breakpoints")){let e=new Set;return this.$$("breakpoints").split(",").forEach((t=>{e.add(parseFloat(t.trim()))})),e}return null}renderBg(e){let t=new Set;this.breakpoints?this.breakpoints.forEach((e=>{t.add(`url("${this._getUrlBase(e+"x")}") ${e}w`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(2*e+"x")}") ${2*e}w`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(3*e+"x")}") ${3*e}w`)})):(t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,2))}") 2x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,3))}") 3x`));let i=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach((t=>{e.add(this._getUrlBase(t+"x")+` ${t}w`),this.$$("hi-res-support")&&e.add(this._getUrlBase(2*t+"x")+` ${2*t}w`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(3*t+"x")+` ${3*t}w`)})):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach((e=>{this.$$("intersection")?this.initIntersection(e,(()=>{this.renderBg(e)})):this.renderBg(e)})):this.$$("intersection")?this.initIntersection(this.img,(()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()})):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(e,t){this._isnObserver=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(t(),this._isnObserver.unobserve(e))}))}),{root:null,rootMargin:"0px"}),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach((e=>{this._isnObserver.unobserve(e)})),this._isnObserver=null)}static get observedAttributes(){return Object.keys(kt)}attributeChangedCallback(e,t,i){window.setTimeout((()=>{this.$[Et+e]=i}))}}class Rt extends _t{init$={...this.ctxInit,"*simpleButtonText":"",onClick:()=>{this.initFlow()}};initCallback(){super.initCallback(),this.bindCssData("--cfg-multiple"),this.sub("--cfg-multiple",(e=>{this.$["*simpleButtonText"]=e?this.l10n("upload-files"):this.l10n("upload-file")}))}}Rt.template='\n  <lr-drop-area>\n    <button type="button" set="onclick: onClick">\n      <lr-icon name="upload"></lr-icon>\n      <span>{{*simpleButtonText}}</span>\n      <slot></slot>\n      <div class="visual-drop-area"></div>\n    </button>\n  </lr-drop-area>\n';function Pt(e){return new Promise((t=>{"function"!=typeof window.FileReader&&t(!1);try{let i=new FileReader;i.onerror=()=>{t(!0)};let s=e=>{"loadend"!==e.type&&i.abort(),t(!1)};i.onloadend=s,i.onprogress=s,i.readAsDataURL(e)}catch(e){t(!1)}}))}function Ot(e){return new Promise((t=>{let i=0,s=[],r=e=>{e||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),e.isFile?(i++,e.file((e=>{i--,s.push(e),0===i&&t(s)}))):e.isDirectory&&n(e.createReader())},n=e=>{i++,e.readEntries((e=>{i--;for(let t of e)r(t);0===i&&t(s)}))};r(e)}))}const Dt={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let Mt=["dragleave","dragexit","dragend","drop","mouseleave","mouseout"],Nt=new Map;function Vt(e){let t=new Set,i=e=>t.add(e),s=Dt.INACTIVE,r=e=>{s!==e&&t.forEach((t=>t(e))),s=e},n=e=>{let{clientX:t,clientY:i}=e,s=document.body.getBoundingClientRect(),n="drop"===e.type,a=["dragleave","dragexit","dragend"].includes(e.type)&&0===t&&0===i,o=["mouseleave","mouseout"].includes(e.type)&&(t<0||t>s.width||i<0||i>s.height);(n||a||o)&&r(Dt.INACTIVE),e.preventDefault()};i((t=>e.onChange(t))),i((e=>{e===Dt.ACTIVE&&Mt.forEach((e=>{window.addEventListener(e,n,!1)}))})),i((e=>{e===Dt.INACTIVE&&Mt.forEach((e=>{window.removeEventListener(e,n,!1)}))}));let a=t=>{t.preventDefault(),s===Dt.INACTIVE&&r(Dt.ACTIVE);let i=[t.x,t.y],n=e.element.getBoundingClientRect(),a=Math.floor(function(e,t){let i=Math.max(Math.min(e[0],t.x+t.width),t.x),s=Math.max(Math.min(e[1],t.y+t.height),t.y);return Math.sqrt((e[0]-i)*(e[0]-i)+(e[1]-s)*(e[1]-s))}(i,n)),o=a<100,l=t.composedPath().includes(e.element);Nt.set(e.element,a);let c=Math.min(...Nt.values())===a;r(l&&c?Dt.OVER:o&&c?Dt.NEAR:Dt.ACTIVE)};window.addEventListener("dragover",a,!1);let o=async t=>{t.preventDefault();let i=await function(e){let t=[],i=[];for(let s=0;s<e.items.length;s++){let r=e.items[s];if(r)if("file"===r.kind){if("function"==typeof r.webkitGetAsEntry||"function"==typeof r.getAsEntry){let e="function"==typeof r.webkitGetAsEntry?r.webkitGetAsEntry():r.getAsEntry();i.push(Ot(e).then((e=>{t.push(...e)})));continue}let e=r.getAsFile();i.push(Pt(e).then((i=>{i||t.push(e)})))}else"string"===r.kind&&r.type.match("^text/uri-list")&&i.push(new Promise((e=>{r.getAsString((i=>{t.push(i),e()}))})))}return Promise.all(i).then((()=>t))}(t.dataTransfer);e.onItems(i),r(Dt.INACTIVE)};return e.element.addEventListener("drop",o),()=>{Nt.delete(e.element),window.removeEventListener("dragover",a,!1),e.element.removeEventListener("drop",o),Mt.forEach((e=>{window.removeEventListener(e,n,!1)}))}}class Bt extends _t{_registeredTypes={};init$={...this.ctxInit,iconName:"default"};initTypes(){this.registerType({type:_t.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:_t.sourceTypes.URL,activity:ae.activities.URL,textKey:"from-url"}),this.registerType({type:_t.sourceTypes.CAMERA,activity:ae.activities.CAMERA}),this.registerType({type:"draw",activity:ae.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(_t.extSrcList))this.registerType({type:e,activity:ae.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",(e=>{e&&this.applyType(e)}))}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){const t=this._registeredTypes[e];if(!t)return void console.warn("Unsupported source type: "+e);const{textKey:i=e,icon:s=e,activity:r,onClick:n,activityParams:a={}}=t;this.applyL10nKey("src-type",`src-type-${i}`),this.$.iconName=s,this.onclick=e=>{r&&this.set$({"*currentActivityParams":a,"*currentActivity":r}),n&&n(e)}}}Bt.template='\n  <lr-icon set="@name: iconName"></lr-icon>\n  <div class="txt" l10n="src-type"></div>\n',Bt.bindAttributes({type:null});class Ft{caption="";text="";iconName="";isError=!1}class zt extends ie{init$={...this.ctxInit,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}};initCallback(){super.initCallback(),this.sub("*message",(e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption||"",msgTxt:e.text||"",iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")}))}}function jt(e){let t=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(t)}function Ht(e="hsl(0, 0%, 100%)",t=36,i=36){return jt(`\n  <svg width="${t}" height="${i}" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z" fill="black" fill-opacity="0.06"/>\n    <path d="M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z" fill="black" fill-opacity="0.06"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="${e}"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="url(#paint0_linear_2735_2136)"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z" fill="url(#paint1_radial_2735_2136)"/>\n    <path d="M21 8L26 13V14H20V8H21Z" fill="black" fill-opacity="0.03"/>\n    <path d="M21 8L26 13V13.5H20.5V8H21Z" fill="black" fill-opacity="0.08"/>\n    <path d="M21 8L26 13H21V8Z" fill="${e}"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint2_linear_2735_2136)"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint3_linear_2735_2136)"/>\n    <path d="M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z" fill="url(#paint4_linear_2735_2136)"/>\n    <defs>\n      <linearGradient id="paint0_linear_2735_2136" x1="18" y1="8" x2="18" y2="28.0027" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.06"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n      <radialGradient id="paint1_radial_2735_2136" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10 11) rotate(53.7462) scale(18.6011 18.0323)">\n        <stop stop-color="white" stop-opacity="0.12"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </radialGradient>\n      <linearGradient id="paint2_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop offset="0.40625" stop-opacity="0"/>\n        <stop offset="1" stop-opacity="0.04"/>\n      </linearGradient>\n      <linearGradient id="paint3_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.16"/>\n        <stop offset="1" stop-color="white" stop-opacity="0.06"/>\n      </linearGradient>\n      <linearGradient id="paint4_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.15"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n    </defs>\n</svg>\n  `)}zt.template='\n  <div class="heading">\n    <lr-icon set="@name: iconName"></lr-icon>\n    <div class="caption">{{captionTxt}}</div>\n    <button type="button" set="onclick: onClose">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </div>\n  <div class="msg">{{msgTxt}}</div>\n';const qt={FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)};class Kt extends _t{pauseRender=!0;_entrySubs=new Set;_entry=null;_isIntersecting=!1;_debouncedGenerateThumb=se(this._generateThumbnail.bind(this),100);_debouncedCalculateState=se(this._calculateState.bind(this),0);_renderedOnce=!1;init$={...this.ctxInit,uid:"",itemName:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,notImage:!0,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,state:qt.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry,"*currentActivity":ae.activities.DETAILS})},onRemove:()=>{let e=this._entry.getValue("uuid");if(e){let t=this.getOutputData((t=>t.getValue("uuid")===e));ft.emit(new bt({type:gt.REMOVE,ctx:this.ctxName,data:t}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}};_reset(){for(let e of this._entrySubs)e.remove();this._debouncedGenerateThumb.cancel(),this._entrySubs=new Set,this._entry=null,this._isIntersecting=!1}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),0===t.intersectionRatio?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){let e=this._entry,t=qt.IDLE;e.getValue("uploadError")||e.getValue("validationErrorMsg")?t=qt.FAILED:e.getValue("isUploading")?t=qt.UPLOADING:e.getValue("uuid")&&(t=qt.FINISHED),this.$.state!==t&&(this.$.state=t)}async _generateThumbnail(){let e=this._entry;if(e.getValue("uuid")&&e.getValue("isImage")){let t=this.getCssData("--cfg-thumb-size")||76,i=this.proxyUrl(Tt(At(this.getCssData("--cfg-cdn-cname"),this._entry.getValue("uuid")),wt(e.getValue("cdnUrlModifiers"),`scale_crop/${t}x${t}/center`))),s=e.getValue("thumbUrl");return e.setValue("thumbUrl",i),void URL.revokeObjectURL(s)}if(!e.getValue("thumbUrl"))if(e.getValue("file")?.type.includes("image"))try{let t=await function(e,t=40){if("image/svg+xml"===e.type)return URL.createObjectURL(e);let i=document.createElement("canvas"),s=i.getContext("2d"),r=new Image,n=new Promise(((e,n)=>{r.onload=()=>{let a=r.height/r.width;a>1?(i.width=t,i.height=t*a):(i.height=t,i.width=t/a),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(r,0,0,i.width,i.height),i.toBlob((t=>{if(!t)return void n();let i=URL.createObjectURL(t);e(i)}))},r.onerror=e=>{n(e)}}));return r.src=URL.createObjectURL(e),n}(e.getValue("file"),this.getCssData("--cfg-thumb-size")||76);e.setValue("thumbUrl",t)}catch(t){let i=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Ht(i))}else{let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Ht(t))}}_showMessage(e,t,i){let s=new Ft;s.caption=t,s.text=i,s.isError="error"===e,this.set$({badgeIcon:`badge-${e}`,"*message":s})}_subEntry(e,t){let i=this._entry.subscribe(e,t);this._entrySubs.add(i)}_handleEntryId(e){this._reset();let t=this.uploadCollection?.read(e);this._entry=t,t&&(this._subEntry("validationErrorMsg",(e=>{if(this._debouncedCalculateState(),!e)return;let i=this.l10n("validation-error")+": "+(t.getValue("file")?.name||t.getValue("externalUrl"));this._showMessage("error",i,e)})),this._subEntry("uploadError",(e=>{if(this._debouncedCalculateState(),!e)return;let i=this.l10n("upload-error")+": "+(t.getValue("file")?.name||t.getValue("externalUrl"));this._showMessage("error",i,e.message)})),this._subEntry("isUploading",(()=>{this._debouncedCalculateState()})),this._subEntry("uploadProgress",(e=>{this.$.progressValue=e})),this._subEntry("fileName",(e=>{this.$.itemName=e||t.getValue("externalUrl")||this.l10n("file-no-name")})),this._subEntry("fileSize",(e=>{let i=this.getCssData("--cfg-max-local-file-size-bytes");i&&e&&e>i&&t.setValue("validationErrorMsg",this.l10n("files-max-size-limit-error",{maxFileSize:i}))})),this._subEntry("mimeType",(e=>{if(!e)return;let i=this.getCssData("--cfg-img-only"),s=this.getCssData("--cfg-accept"),r=le([...i?oe:[],s]);r.length>0&&!ce(e,r)&&t.setValue("validationErrorMsg",this.l10n("file-type-not-allowed"))})),this._subEntry("isImage",(e=>{let i=this.getCssData("--cfg-img-only");t.getValue("externalUrl")&&!t.getValue("uuid")&&i&&!e||i&&!e&&t.setValue("validationErrorMsg",this.l10n("images-only-accepted"))})),this._subEntry("externalUrl",(e=>{this.$.itemName=t.getValue("fileName")||e||this.l10n("file-no-name")})),this._subEntry("uuid",(e=>{this._debouncedCalculateState(),e&&this._debouncedGenerateThumb()})),this._subEntry("cdnUrlModifiers",(()=>{this._debouncedGenerateThumb()})),this._subEntry("thumbUrl",(e=>{this.$.thumbUrl=e?`url(${e})`:""})),this.getCssData("--cfg-confirm-upload")||this.upload(),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",(e=>{this._handleEntryId(e)})),this.sub("state",(e=>{this.set$({isFailed:e===qt.FAILED,isUploading:e===qt.UPLOADING,isFinished:e===qt.FINISHED,progressVisible:e===qt.UPLOADING}),e===qt.FAILED?this.$.badgeIcon="badge-error":e===qt.FINISHED&&(this.$.badgeIcon="badge-success"),e===qt.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0})),this.onclick=()=>{Kt.activeInstances.forEach((e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")}))},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",(e=>{e&&this.isConnected&&this.upload()})),Kt.activeInstances.add(this)}destroyCallback(){super.destroyCallback(),Kt.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}async upload(){let e=this._entry;if(e.getValue("uuid")||e.getValue("isUploading")||e.getValue("validationErrorMsg"))return;let t=this.getOutputData((e=>!e.getValue("uuid")));ft.emit(new bt({type:gt.UPLOAD_START,ctx:this.ctxName,data:t})),this._debouncedCalculateState(),e.setValue("isUploading",!0),e.setValue("uploadError",null),e.setValue("validationErrorMsg",null),!e.getValue("file")&&e.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let t=new AbortController;e.setValue("abortController",t);let i=await ot(e.getValue("file")||e.getValue("externalUrl"),{...this.getUploadClientOptions(),fileName:e.getValue("fileName"),onProgress:t=>{if(t.isComputable){let i=100*t.value;e.setValue("uploadProgress",i)}this.$.progressUnknown=!t.isComputable},signal:t.signal});e===this._entry&&this._debouncedCalculateState(),e.setMultipleValues({fileInfo:i,isUploading:!1,fileName:i.name,fileSize:i.size,isImage:i.isImage,mimeType:i.mimeType,uuid:i.uuid,cdnUrl:i.cdnUrl})}catch(t){e.setValue("abortController",null),e.setValue("isUploading",!1),e.setValue("uploadProgress",0),e===this._entry&&this._debouncedCalculateState(),t?.isCancel||e.setValue("uploadError",t)}}}Kt.template='\n  <div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">\n    <div class="thumb" set="style.backgroundImage: thumbUrl">\n      <div class="badge">\n        <lr-icon set="@name: badgeIcon"></lr-icon>\n      </div>\n    </div>\n    <div class="file-name-wrapper">\n      <span class="file-name" set="@title: itemName">{{itemName}}</span>\n    </div>\n    <button type="button" class="edit-btn" set="onclick: onEdit;">\n      <lr-icon name="edit-file"></lr-icon>\n    </button>\n    <button type="button" class="remove-btn" set="onclick: onRemove;">\n      <lr-icon name="remove-file"></lr-icon>\n    </button>\n    <button type="button" class="upload-btn" set="onclick: onUpload;">\n      <lr-icon name="upload"></lr-icon>\n    </button>\n    <lr-progress-bar\n      class="progress-bar"\n      set="value: progressValue; visible: progressVisible; unknown: progressUnknown"\n    >\n    </lr-progress-bar>\n  </div>\n',Kt.activeInstances=new Set;class Xt extends ie{init$={...this.ctxInit,"*modalActive":!1,"*modalHeaderHidden":!1,"*modalCloseCallback":null,closeClicked:()=>{this.$["*modalCloseCallback"]?this.$["*modalCloseCallback"]():this.set$({"*modalActive":!1,"*currentActivity":""})}};initCallback(){super.initCallback(),this.sub("*modalActive",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active"),e&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null})),this.getCssData("--cfg-modal-backdrop-strokes")&&(this.style.backgroundImage=`url(${function(e="rgba(0, 0, 0, .1)"){return jt(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n    <line x1="0" y1="10" x2="10" y2="0" stroke="${e}" />\n  </svg>`)}()})`)}}Xt.template='\n  <div class="dialog">\n    <div class="heading" set="@hidden: *modalHeaderHidden">\n      <slot name="heading"></slot>\n      <button type="button" class="close-btn" set="onclick: closeClicked">\n        <lr-icon name="close"></lr-icon>\n      </button>\n    </div>\n    <div class="content">\n      <slot></slot>\n    </div>\n  </div>\n';class Wt{captionL10nStr="confirm-your-action";messageL10Str="are-you-sure";confirmL10nStr="yes";denyL10nStr="no";confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class Gt extends ae{activityType=ae.activities.CONFIRMATION;_defaults=new Wt;init$={...this.ctxInit,messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)};initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",(e=>{e&&this.set$({"*modalHeaderHidden":!0,"*currentActivity":ae.activities.CONFIRMATION,"*activityCaption":this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,e.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,e.confirmAction()}})}))}}Gt.template='\n  <div class="message">{{messageTxt}}</div>\n  <div class="toolbar">\n    <button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button>\n    <button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button>\n  </div>\n';class Yt extends _t{activityType=ae.activities.UPLOAD_LIST;init$={...this.ctxInit,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,uploadBtnEnabled:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.$["*uploadTrigger"]={},this._updateUploadsState()},onDone:()=>{this.cancelFlow()},onCancel:()=>{let e=new Wt;e.confirmAction=()=>{let e=this.getOutputData((e=>!!e.getValue("uuid")));ft.emit(new bt({type:gt.REMOVE,ctx:this.ctxName,data:e})),this.uploadCollection.clearAll(),this.historyBack()},e.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=e}};cssInit$={"--cfg-show-empty-list":0,"--cfg-multiple":1,"--cfg-multiple-min":0,"--cfg-multiple-max":0,"--cfg-confirm-upload":1,"--cfg-source-list":""};_debouncedHandleCollectionUpdate=se((()=>{this._updateUploadsState(),this._updateCountLimitMessage()}),0);_validateFilesCount(){let e=!!this.getCssData("--cfg-multiple"),t=e?this.getCssData("--cfg-multiple-min")??0:1,i=e?this.getCssData("--cfg-multiple-max")??0:1,s=this.uploadCollection.size,r=!!t&&s<t,n=!!i&&s>i;return{passed:!r&&!n,tooFew:r,tooMany:n,min:t,max:i,exact:i===s}}_updateCountLimitMessage(){let e=this.uploadCollection.size,t=this._validateFilesCount();if(e&&!t.passed){let i=new Ft,s=t.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";i.caption=this.l10n("files-count-limit-error-title"),i.text=this.l10n(s,{min:t.min,max:t.max,total:e}),i.isError=!0,this.set$({"*message":i})}}_updateUploadsState(){let e=this.uploadCollection.items(),t={total:e.length,succeed:0,uploading:0,failed:0};for(let i of e){let e=this.uploadCollection.read(i);e.getValue("uuid")&&!e.getValue("validationErrorMsg")&&(t.succeed+=1),e.getValue("isUploading")&&(t.uploading+=1),(e.getValue("validationErrorMsg")||e.getValue("uploadError"))&&(t.failed+=1)}let i=t.total===t.succeed+t.failed,{passed:s,tooMany:r,exact:n}=this._validateFilesCount(),a=0===t.failed,o=t.total>0&&s&&a,l=t.total-t.succeed-t.uploading-t.failed>0&&s;this.set$({doneBtnVisible:i,doneBtnEnabled:o,uploadBtnVisible:!i,uploadBtnEnabled:l,addMoreBtnEnabled:0===t.total||!r&&!n,addMoreBtnVisible:!n||this.getCssData("--cfg-multiple")})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.set$({"*activityCaption":this.l10n("selected"),"*activityIcon":"local"})}}),this.sub("--cfg-multiple",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-min",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-max",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",(e=>{0!==this.uploadCollection?.size||this.getCssData("--cfg-show-empty-list")||e!==this.activityType||(this.$["*currentActivity"]=this.initActivity)})),this.uploadCollection.observe(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",(e=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),0!==e?.length||this.getCssData("--cfg-show-empty-list")||this.cancelFlow()}))}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserve(this._debouncedHandleCollectionUpdate)}}Yt.template='\n  <div class="no-files" set="@hidden: hasFiles">\n    <slot name="empty"><span l10n="no-files"></span></slot>\n  </div>\n\n  <div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div>\n\n  <div class="toolbar">\n    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button>\n    <div class="toolbar-spacer"></div>\n    <button\n      type="button"\n      class="add-more-btn secondary-btn"\n      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"\n      l10n="add-more"\n    ></button>\n    <button\n      type="button"\n      class="upload-btn primary-btn"\n      set="@hidden: !uploadBtnVisible; onclick: onUpload; @disabled: !uploadBtnEnabled"\n      l10n="upload"\n    ></button>\n    <button\n      type="button"\n      class="done-btn primary-btn"\n      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"\n      l10n="done"\n    ></button>\n  </div>\n';class Jt extends _t{activityType=ae.activities.URL;init$={...this.ctxInit,importDisabled:!0,onUpload:()=>{let e=this.ref.input.value;this.uploadCollection.add({externalUrl:e}),this.$["*currentActivity"]=ae.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}};initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.set$({"*activityCaption":this.l10n("caption-from-url"),"*activityIcon":"url"})},onClose:()=>this.historyBack()})}}Jt.template='\n  <input placeholder="https://..." .url-input type="text" ref="input" set="oninput: onInput" />\n  <button type="button" class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled"></button>\n  <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>\n';const Zt=()=>void 0!==navigator.permissions;class Qt extends _t{activityType=ae.activities.CAMERA;_unsubPermissions=null;init$={...this.ctxInit,video:null,videoTransformCss:null,shotBtnDisabled:!1,videoHidden:!1,messageHidden:!0,requestBtnHidden:Zt(),l10nMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}};cssInit$={"--cfg-camera-mirror":1};_onActivate=()=>{this.set$({"*activityCaption":this.l10n("caption-camera"),"*activityIcon":"camera"}),Zt()&&this._subscribePermissions(),this._capture()};_onDeactivate=()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()};_onClose=()=>{this.historyBack()};_handlePermissionsChange=()=>{this._capture()};_setPermissionsState=se((e=>{"granted"===e?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):"prompt"===e?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())}),300);async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(e.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",(()=>{this._setPermissionsState("denied")})),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied")}}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob((i=>{let s=new File([i],t,{lastModified:e,type:"image/png"});this.uploadCollection.add({file:s,fileName:t,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":ae.activities.UPLOAD_LIST})}))}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate,onClose:this._onClose}),this.sub("--cfg-camera-mirror",(e=>{this.$.videoTransformCss=e?"scaleX(-1)":null}));let e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).map(((e,t)=>({text:e.label.trim()||`${this.l10n("caption-camera")} ${t+1}`,value:e.deviceId})));e.length>1&&(this.$.cameraSelectOptions=e,this.$.cameraSelectHidden=!1)}}Qt.template='\n  <div class="content">\n    <video\n      autoplay\n      playsinline\n      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"\n      ref="video"\n    ></video>\n    <div class="message-box" set="@hidden: messageHidden">\n      <span>{{l10nMessage}}</span>\n      <button\n        type="button"\n        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"\n        l10n="camera-permissions-request"\n      ></button>\n    </div>\n  </div>\n\n  <div class="toolbar">\n    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>\n    <lr-select set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange">\n    </lr-select>\n    <button\n      type="button"\n      class="shot-btn primary-btn"\n      set="onclick: onShot; @disabled: shotBtnDisabled"\n      l10n="camera-shot"\n    ></button>\n  </div>\n';class ei extends _t{activityType=ae.activities.DETAILS;pauseRender=!0;init$={...this.ctxInit,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=ae.activities.CLOUD_IMG_EDIT)}};cssInit$={"--cfg-use-cloud-image-editor":0,"--cfg-use-local-image-editor":0};showNonImageThumb(){let e=Ht(window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),108,108);this.ref.filePreview.setImageUrl(e),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onActivate:()=>{this.set$({"*activityCaption":this.l10n("caption-edit-file")})},onDeactivate:()=>{this.ref.filePreview.clear()},onClose:()=>this.historyBack()}),this.sub("*focusedEntry",(e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach((e=>{this._entrySubs.delete(e),e.remove()})):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(t){this._file=t;let i=he(this._file);i&&!e.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),i||this.showNonImageThumb()}let i=(e,t)=>{this._entrySubs.add(this.entry.subscribe(e,t))};i("fileName",(e=>{this.$.fileName=e,this.$.onNameInput=()=>{let e=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:e}),this.entry.setValue("fileName",e)}})),i("fileSize",(e=>{this.$.fileSize=Number.isFinite(e)?this.fileSizeFmt(e):this.l10n("file-size-unknown")})),i("uploadError",(e=>{this.$.errorTxt=e?.message})),i("externalUrl",(e=>{e&&(this.entry.getValue("uuid")||this.showNonImageThumb())})),i("cdnUrl",(e=>{const t=this.$["--cfg-use-cloud-image-editor"]&&e&&this.entry.getValue("isImage");if(e&&this.ref.filePreview.clear(),this.set$({cdnUrl:e,cloudEditBtnHidden:!t}),e&&this.entry.getValue("isImage")){let t=Tt(e,wt("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(t))}}))}))}}ei.template='\n  <lr-tabs tab-list="tab-view, tab-details">\n    <div tab-ctx="tab-details" class="details">\n      <div class="info-block">\n        <div class="info-block_name" l10n="file-name"></div>\n        <input\n          name="name-input"\n          ref="file_name_input"\n          set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl"\n          type="text"\n        />\n      </div>\n\n      <div class="info-block">\n        <div class="info-block_name" l10n="file-size"></div>\n        <div>{{fileSize}}</div>\n      </div>\n\n      <div class="info-block">\n        <div class="info-block_name" l10n="cdn-url"></div>\n        <a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a>\n      </div>\n\n      <div>{{errorTxt}}</div>\n    </div>\n\n    <lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"> </lr-file-preview>\n  </lr-tabs>\n\n  <div class="toolbar" set="@edit-disabled: cloudEditBtnHidden">\n    <button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;">\n      <lr-icon name="edit"></lr-icon>\n      <span l10n="edit-image"></span>\n    </button>\n    <button type="button" class="remove-btn secondary-btn" set="onclick: onRemove">\n      <lr-icon name="remove"></lr-icon>\n      <span l10n="remove-from-list"></span>\n    </button>\n    <div></div>\n    <button type="button" class="back-btn primary-btn" set="onclick: onBack">\n      <span l10n="ok"></span>\n    </button>\n  </div>\n';class ti extends _t{init$={...this.ctxInit,visible:!1,unknown:!1,value:0,"*commonProgress":0};initCallback(){super.initCallback(),this.uploadCollection.observe((()=>{let e=this.uploadCollection.items().some((e=>this.uploadCollection.read(e).getValue("isUploading")));this.$.visible=e})),this.sub("visible",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})),this.sub("*commonProgress",(e=>{this.$.value=e}))}}ti.template='\n  <lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>\n';class ii extends ie{_value=0;_unknownMode=!1;init$={...this.ctxInit,width:0,opacity:0};initCallback(){super.initCallback(),this.defineAccessor("value",(e=>{void 0!==e&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))})),this.defineAccessor("visible",(e=>{this.ref.line.classList.toggle("progress--hidden",!e)})),this.defineAccessor("unknown",(e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)}))}}ii.template=' <div ref="line" class="progress"></div> ';const si="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class ri extends ie{init$={...this.ctxInit,checkerboard:!1,src:si};constructor(){super()}initCallback(){super.initCallback(),this.sub("checkerboard",(()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${function(e="#fff",t="rgba(0, 0, 0, .1)"){return jt(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="0" y="0" width="20" height="20" fill="${e}" />\n    <rect x="0" y="0" width="10" height="10" fill="${t}" />\n    <rect x="10" y="10" width="10" height="10" fill="${t}" />\n  </svg>`)}()})`:"unset"}))}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(e){this.$.src=e.src}setImageFile(e){let t=URL.createObjectURL(e);this.$.src=t,this._lastObjectUrl=t}setImageUrl(e){this.$.src=e}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=si}}function ni(...e){return e.reduce(((e,t)=>{if("string"==typeof t)return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e}),{})}function ai(...e){let t=ni(...e);return Object.keys(t).reduce(((e,i)=>(t[i]&&e.push(i),e)),[]).join(" ")}function oi(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}function li(e){let t=new Image;return{promise:new Promise(((i,s)=>{t.src=e,t.onload=i,t.onerror=s})),image:t,cancel:()=>{0===t.naturalWidth&&(t.src=si)}}}function ci(e){let t=[];for(let i of e){let e=li(i);t.push(e)}let i=t.map((e=>e.image));return{promise:Promise.allSettled(t.map((e=>e.promise))),images:i,cancel:()=>{t.forEach((e=>{e.cancel()}))}}}ri.template=' <lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" /> ',ri.bindAttributes({checkerboard:"checkerboard"});const hi={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};const di=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function ui(e){return yt(...di.filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>function(e,t){if("number"==typeof t)return hi[e]!==t?`${e}/${t}`:"";if("boolean"==typeof t)return t&&hi[e]!==t?`${e}`:"";if("filter"===e){if(!t||hi[e]===t.amount)return"";let{name:i,amount:s}=t;return`${e}/${i}/${s}`}if("crop"===e){if(!t)return"";let{dimensions:i,coords:s}=t;return`${e}/${i.join("x")}/${s.join(",")}`}return""}(t,e[t]))).filter((e=>!!e)))}const pi=yt("format/auto","progressive/yes");function mi(e){return{"*originalUrl":null,"*tabId":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:si,fileType:"",showLoader:!1,uuid:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let t=e.querySelectorAll("img");for(let e of t){let t=e.src;e.src=si,e.src=t}e.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let i=e.$["*originalUrl"],s=wt(ui(t)),r={originalUrl:i,cdnUrlModifiers:s,cdnUrl:Tt(i,wt(s,"preview")),transformations:t};e.dispatchEvent(new CustomEvent("apply",{detail:r})),e.remove()},"*on.cancel":()=>{e.remove(),e.dispatchEvent(new CustomEvent("cancel"))}}}const gi=`\n  <div class="wrapper wrapper_desktop">\n    <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">\n      <div class="network_problems_content">\n        <div class="network_problems_icon">\n          <lr-icon size="20" name="sad"></lr-icon>\n        </div>\n        <div class="network_problems_text">Network error</div>\n      </div>\n      <div class="network_problems_footer">\n        <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n    <div class="viewport">\n      <div class="file_type_outer">\n        <div class="file_type">{{fileType}}</div>\n      </div>\n      <div class="image_container" ref="img-container-el">\n        <img src="${si}" class="image image_visible_from_editor" ref="img-el" />\n        <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>\n        <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>\n      </div>\n      <div class="info_pan">{{msg}}</div>\n    </div>\n    <div class="toolbar">\n      <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n      <div class="toolbar_content toolbar_content__editor">\n        <lr-editor-toolbar></lr-editor-toolbar>\n      </div>\n    </div>\n  </div>\n`,bi="crop",fi="sliders",_i="filters",vi=[bi,fi,_i],yi=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],wi=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Ci=["rotate","mirror","flip"],xi={brightness:{zero:hi.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:hi.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:hi.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:hi.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:hi.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:hi.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:hi.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:hi.enhance,range:[0,100],keypointsNumber:1},filter:{zero:hi.filter,range:[0,100],keypointsNumber:1}};function $i(e,t,i){let s=window.devicePixelRatio,r=Math.min(Math.ceil(t*s),3e3),n=s>=2?"lightest":"normal";return Tt(e,wt(pi,ui(i),`quality/${n}`,`stretch/off/-/resize/${r}x`))}class Ti extends ie{get ctxName(){return this.autoCtxName}init$={...this.ctxInit,...mi(this)};_debouncedShowLoader=oi(this._showLoader.bind(this),300);_showLoader(e){this.$.showLoader=e}_loadImageFromCdn(){this._debouncedShowLoader(!0);let e=this._imageSrc(),{promise:t,cancel:i}=li(e);t.then((()=>{this.$.src=e})).catch((t=>{this.$["*networkProblems"]=!0,this._debouncedShowLoader(!1),this.$.src=e})),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=i}_imageSrc(){let{width:e}=this.ref["img-container-el"].getBoundingClientRect();return this.proxyUrl($i(this.$["*originalUrl"],e,{}))}_waitForSize(){return new Promise(((e,t)=>{let i=Date.now(),s=()=>{if(!this.isConnected)return clearInterval(r),void t();if(Date.now()-i>300)return clearInterval(r),void t(new Error("[cloud-image-editor] timout waiting for non-zero container size"));let{width:s,height:n}=this.getBoundingClientRect();s>0&&n>0&&(clearInterval(r),e())},r=setInterval(s,50);s()}))}cssInit$={"--cfg-cdn-cname":"https://ucarecdn.com"};async initCallback(){this.$["*originalUrl"]=At(this.localCtx.read("--cfg-cdn-cname"),this.$.uuid),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.classList.add("editor_ON"),this.sub("*networkProblems",(e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e})),this.ref["img-el"].addEventListener("load",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==si&&(this.$["*networkProblems"]=!1)})),this.ref["img-el"].addEventListener("error",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0})),this.sub("src",(e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||si)})),this.sub("*tabId",(e=>{this.ref["img-el"].className=ai("image",{image_hidden_to_cropper:e===bi,image_hidden_effects:e!==bi})}));try{fetch(Tt(this.$["*originalUrl"],wt("json"))).then((e=>e.json())).then((({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}})),await this._waitForSize(),this._loadImageFromCdn()}catch(e){e&&console.error("Failed to load image info",e)}}}Ti.template=gi,Ti.bindAttributes({uuid:"uuid"});const Ai=1.5,ki=100/3,Ei=82;function Si(e,t){for(let i in t)e.setAttributeNS(null,i,t[i].toString())}function Ii(e,t={}){let i=document.createElementNS("http://www.w3.org/2000/svg",e);return Si(i,t),i}function Ui(e,t){let{x:i,y:s,width:r,height:n}=e,a=t.includes("w")?0:1,o=t.includes("n")?0:1,l=[-1,1][a],c=[-1,1][o],h=[i+a*r+Ai*l,s+o*n+Ai*c-24*c],d=[i+a*r+Ai*l,s+o*n+Ai*c],u=[i+a*r-24*l+Ai*l,s+o*n+Ai*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,center:d}}function Li(e,t){let i,s,{x:r,y:n,width:a,height:o}=e,l=["n","s"].includes(t)?.5:{w:0,e:1}[t],c=["w","e"].includes(t)?.5:{n:0,s:1}[t],h=[-1,1][l],d=[-1,1][c];return["n","s"].includes(t)?(i=[r+l*a-17,n+c*o+Ai*d],s=[r+l*a+17,n+c*o+Ai*d]):(i=[r+l*a+Ai*h,n+c*o-17],s=[r+l*a+Ai*h,n+c*o+17]),{d:`M ${i[0]} ${i[1]} L ${s[0]} ${s[1]}`,center:[s[0]-(s[0]-i[0])/2,s[1]-(s[1]-i[1])/2]}}function Ri(e,t){let{x:i}=e,{y:s}=e;return e.x<t.x?i=t.x:e.x+e.width>t.x+t.width&&(i=t.x+t.width-e.width),e.y<t.y?s=t.y:e.y+e.height>t.y+t.height&&(s=t.y+t.height-e.height),{...e,x:i,y:s}}function Pi(e,[t,i],s){let{x:r,y:n,width:a,height:o}=e;if(s.includes("n")){let e=o;o=Math.max(i,o),n=n+e-o}if(s.includes("s")&&(o=Math.max(i,o)),s.includes("w")){let e=a;a=Math.max(t,a),r=r+e-a}return s.includes("e")&&(a=Math.max(t,a)),{x:r,y:n,width:a,height:o}}class Oi extends ie{init$={...this.ctxInit,dragging:!1};constructor(){super(),this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(""===e&&t.height<=Ei&&t.width<=Ei)return!0;let i=t.height<=Ei&&(e.includes("n")||e.includes("s")),s=t.width<=Ei&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e,n=this.ref["svg-el"],a=Ii("mask",{id:"backdrop-mask"}),o=Ii("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),l=Ii("rect",{x:t,y:i,width:s,height:r,fill:"black"});a.appendChild(o),a.appendChild(l);let c=Ii("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(c),n.appendChild(a),this._backdropMask=a,this._backdropMaskInner=l}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame((()=>{this._backdropMask.style.display="block"})))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e;Si(this._backdropMaskInner,{x:t,y:i,width:s,height:r})}_updateFrame(){let e=this.$["*cropBox"];if(e){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:r,groupNode:n}=t,a=""===i,o=2===i.length;if(a){let{x:t,y:i,width:s,height:n}=e,a=[t+s/2,i+n/2];Si(r,{r:Math.min(s,n)/3,cx:a[0],cy:a[1]})}else{let{d:t,center:n}=o?Ui(e,i):Li(e,i);Si(r,{cx:n[0],cy:n[1]}),Si(s,{d:t})}let l=this._shouldThumbBeDisabled(i);n.setAttribute("class",ai("thumb",{"thumb--hidden":l,"thumb--visible":!l}))}Si(this._frameGuides,{x:e.x-.5,y:e.y-.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,r=Ii("g");r.classList.add("thumb"),r.setAttribute("with-effects","");let n=Ii("circle",{r:25.5,fill:"transparent"}),a=Ii("path",{stroke:"currentColor",fill:"none","stroke-width":3});r.appendChild(a),r.appendChild(n),e[s]={direction:s,pathNode:a,interactionNode:n,groupNode:r},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=Ii("svg"),t=Ii("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let t=1;t<=2;t++){let i=Ii("line",{x1:ki*t+"%",y1:"0%",x2:ki*t+"%",y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}for(let t=1;t<=2;t++){let i=Ii("line",{x1:"0%",y1:ki*t+"%",x2:"100%",y2:ki*t+"%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:e}of Object.values(s))t.appendChild(e);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:r,y:n}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-r,o=t.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,o],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),r=e.x-i,n=e.y-s,a=r-this._dragStartPoint[0],o=n-this._dragStartPoint[1],{direction:l}=this._draggingThumb,c=this.$["*imageBox"],h=this._dragStartCrop;""===l?(h=function(e,[t,i]){return{...e,x:e.x+t,y:e.y+i}}(h,[a,o]),h=Ri(h,c)):(h=function(e,[t,i],s){let{x:r,y:n,width:a,height:o}=e;return s.includes("n")&&(n+=i,o-=i),s.includes("s")&&(o+=i),s.includes("w")&&(r+=t,a-=t),s.includes("e")&&(a+=t),{x:r,y:n,width:a,height:o}}(h,[a,o],l),h=function(e,t){let i=Math.max(e.x,t.x),s=Math.min(e.x+e.width,t.x+t.width),r=Math.max(e.y,t.y);return{x:i,y:r,width:s-i,height:Math.min(e.y+e.height,t.y+t.height)-r}}(h,c)),h=Pi(h,[Math.min(c.width,Ei),Math.min(c.height,Ei)],l),Object.values(h).every((e=>Number.isFinite(e)&&e>=0))?this.$["*cropBox"]=h:console.error("CropFrame is trying to create invalid rectangle",{payload:h})}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find((t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let i=t.groupNode.getBoundingClientRect(),s=function(e,[t,i]){return e.x<=t&&t<=e.x+e.width&&e.y<=i&&i<=e.y+e.height}({x:i.x,y:i.y,width:i.width,height:i.height},[e.x,e.y]);return s}));this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;var t;this.ref["svg-el"].style.cursor=e?""===(t=e.direction)?"move":["e","w"].includes(t)?"ew-resize":["n","s"].includes(t)?"ns-resize":["nw","se"].includes(t)?"nwse-resize":"nesw-resize":"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map((({groupNode:e})=>e)).forEach((t=>{t.setAttribute("class",ai("thumb",{"thumb--hidden":!e,"thumb--visible":e}))}))}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",(()=>{this._resizeBackdrop(),window.requestAnimationFrame((()=>{this._render()}))})),this.sub("*cropBox",(e=>{e&&(this._guidesHidden=e.height<=Ei||e.width<=Ei,window.requestAnimationFrame((()=>{this._render()})))})),this.sub("dragging",(e=>{this._frameGuides.setAttribute("class",ai({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))})),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}Oi.template=' <svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class Di extends ie{init$={...this.ctxInit,active:!1,title:"",icon:"","on.click":null};initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.sub("title",(e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")})),this.sub("active",(e=>{this.className=ai({active:e,not_active:!e})})),this.sub("on.click",(e=>{this.onclick=e}))}}Di.template='\n  <div class="before"></div>\n  <lr-icon size="20" set="@name: icon;"></lr-icon>\n  <div class="title" ref="title-el">{{title}}</div>\n';class Mi extends Di{initCallback(){super.initCallback(),this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e)})),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=function(e,t){return"rotate"===e?function(e){let t=e+90;return t=t>=360?0:t,t}(t):["mirror","flip"].includes(e)?!t:null}(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}}const Ni="filter",Vi="color_operation",Bi="original";class Fi extends ie{init$={...this.ctxInit,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}};setOperation(e,t){this._controlType="filter"===e?Ni:Vi,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===Bi?void 0:this.$.value,filter:this._filter===Bi?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=xi[this._operation],[i,s]=e;this.$.min=i,this.$.max=s,this.$.zero=t;let r=this.$["*editorTransformations"][this._operation];if(this._controlType===Ni){let e=s;if(r){let{name:t,amount:i}=r;e=t===this._filter?i:s}this.$.value=e,this.$.defaultValue=e}if(this._controlType===Vi){let e=void 0!==r?r:t;this.$.value=e,this.$.defaultValue=e}}apply(){let e;e=this._controlType===Ni?this._filter===Bi?null:{name:this._filter,amount:this.$.value}:this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",(e=>{this._originalUrl=e})),this.sub("value",(e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t}))}}Fi.template='\n  <lr-slider-ui\n    ref="slider-el"\n    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"\n  ></lr-slider-ui>\n';class zi extends Di{init$={...this.ctxInit,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null};_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s=t>=2?"lightest":"normal",r={...this.$["*editorTransformations"]};return r[this._operation]=this._filter!==Bi?{name:this._filter,amount:100}:void 0,Tt(this._originalUrl,wt(pi,ui(r),`quality/${s}`,`scale_crop/${i}x${i}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let e=this.proxyUrl(this._previewSrc()),i=this.ref["preview-el"],{promise:s,cancel:r}=li(e);this._cancelPreload=r,s.catch((e=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:e})})).finally((()=>{i.style.backgroundImage=`url(${e})`,setTimeout((()=>{i.style.opacity="1"})),t.unobserve(this)}))}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",(e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===Bi,this.$.icon=this.$.isOriginal?"original":"slider"})),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",(e=>{this.$.active=e&&e===this._filter})),this.sub("isOriginal",(e=>{this.$.iconSize=e?40:20})),this.sub("active",(e=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=e?"1":"0";let t=this.ref["preview-el"];e?t.style.opacity="0":t.style.backgroundImage&&(t.style.opacity="1")})),this.sub("*networkProblems",(e=>{if(!e){let e=this.proxyUrl(this._previewSrc()),t=this.ref["preview-el"];t.style.backgroundImage&&(t.style.backgroundImage="none",t.style.backgroundImage=`url(${e})`)}}))}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload&&this._cancelPreload()}}zi.template='\n  <div class="before"></div>\n  <div class="preview" ref="preview-el"></div>\n  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>\n';class ji extends Di{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))})),this.sub("*editorTransformations",(e=>{if(!this._operation)return;let{zero:t}=xi[this._operation],i=e[this._operation],s=void 0!==i&&i!==t;this.$.active=s}))}}const Hi=window.ResizeObserver;function qi(e,t,i){return Math.min(Math.max(e,t),i)}function Ki({width:e,height:t},i){let s=i/90%2!=0;return{width:s?t:e,height:s?e:t}}class Xi extends ie{init$={...this.ctxInit,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}};constructor(){super(),this._commitDebounced=oi(this._commit.bind(this),300),this._handleResizeDebounced=oi(this._handleResize.bind(this),10)}_handleResize(){this.isConnected&&(this._initCanvas(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=function(e,t){let i={};for(let s of t){let t=e[s];(e.hasOwnProperty(s)||void 0!==t)&&(i[s]=t)}return i}(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,r=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*r,e.height=s*r,t.scale(r,r),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,r=this.offsetWidth,n=this.offsetHeight,a=Ki({width:e.naturalWidth,height:e.naturalHeight},s);if(a.width>r-2*t||a.height>n-2*t){let e=a.width/a.height;if(e>r/n){let i=r-2*t,s=i/e,a=0+t,o=t+(n-2*t)/2-s/2;this.$["*imageBox"]={x:a,y:o,width:i,height:s}}else{let i=n-2*t,s=i*e,a=t+(r-2*t)/2-s/2,o=0+t;this.$["*imageBox"]={x:a,y:o,width:s,height:i}}}else{let{width:e,height:i}=a,s=t+(r-2*t)/2-e/2,o=t+(n-2*t)/2-i/2;this.$["*imageBox"]={x:s,y:o,width:e,height:i}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,r=this.$["*editorTransformations"].crop;if(r){let{dimensions:[t,i],coords:[n,a]}=r,{width:o,x:l,y:c}=this.$["*imageBox"],{width:h}=Ki(this._imageSize,s),d=o/h;e={x:l+n*d,y:c+a*d,width:t*d,height:i*d}}else e={x:t.x,y:t.y,width:t.width,height:t.height};e=Pi(e,[Math.min(t.width,Ei),Math.min(t.height,Ei)],"se"),e=Ri(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:r,rotate:n}=i,a=this._ctx,o=Ki({width:t.width,height:t.height},n);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(n*Math.PI*-1/180),a.scale(s?-1:1,r?-1:1),a.drawImage(e,-o.width/2,-o.height/2,o.width,o.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout((()=>{this.className=ai({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})})))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n}=t,{width:a,height:o}=Ki(this._imageSize,s),{width:l,height:c}=e,h=r/a,d=n/o;return[qi(Math.round(l/h),1,a),qi(Math.round(c/d),1,o)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n,x:a,y:o}=t,{width:l,height:c}=Ki(this._imageSize,s),{x:h,y:d}=e,u=r/l,p=n/c,m=this._calculateDimensions(),g={dimensions:m,coords:[qi(Math.round((h-a)/u),0,l-m[0]),qi(Math.round((d-o)/p),0,c-m[1])]};if(function(e){return!e||[({dimensions:e,coords:t})=>[...e,...t].every((e=>Number.isInteger(e)&&Number.isFinite(e))),({dimensions:e,coords:t})=>e.every((e=>e>0))&&t.every((e=>e>=0))].every((t=>t(e)))}(g)){if(m[0]!==l||m[1]!==c)return g}else console.error("Cropper is trying to create invalid crop object",{payload:g})}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,r=this._calculateCrop(),n={...this.$["*editorTransformations"],crop:r,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=n}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(e){console.error("Failed to activate cropper",{error:e})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=ai({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),r=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-r)/s}px, ${(this.offsetHeight/2-n)/s}px)`,this.style.transformOrigin=`${r}px ${n}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=this.proxyUrl($i(e,i,t)),{promise:r,cancel:n,image:a}=li(s),o=this._handleImageLoading(s);return a.addEventListener("load",o,{once:!0}),a.addEventListener("error",o,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,r.then((()=>a)).catch((e=>(console.error("Failed to load image",{error:e}),this.$["*networkProblems"]=!0,Promise.resolve(a))))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new Hi((()=>{this._isActive&&this.$.image&&this._handleResizeDebounced()})),this._observer.observe(this),this.sub("*imageBox",(()=>{this._draw()})),this.sub("*cropBox",(e=>{this.$.image&&this._commitDebounced()})),setTimeout((()=>{this.sub("*networkProblems",(e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})}))}),0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}function Wi(e,t,i){let s=Array(i);for(let r=--i;r>=0;r--)s[r]=Math.ceil((r*t+(i-r)*e)/i);return s}function Gi(e,t){let i=xi[e].keypointsNumber,{range:s,zero:r}=xi[e];return[...new Set([...Wi(s[0],r,i+1),...Wi(r,s[1],i+1),r,t])].sort(((e,t)=>e-t))}Xi.template='\n  <canvas class="canvas" ref="canvas-el"></canvas>\n  <lr-crop-frame ref="frame-el"></lr-crop-frame>\n';class Yi extends ie{initCallback(){super.initCallback(),this.addEventListener("wheel",(e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>1?this.scrollLeft+=i:this.scrollLeft+=t}))}}Yi.template=" <slot></slot> ";class Ji extends ie{constructor(){super(),this.init$={...this.ctxInit,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*editorTransformations":{},"*currentFilter":Bi,"*currentOperation":null,showLoader:!1,tabId:bi,filters:wi,colorOperations:yi,cropOperations:Ci,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=oi(this._showLoader.bind(this),500)}get tabId(){return this.$.tabId}_onSliderClose(){this.$["*showSlider"]=!1,this.$.tabId===fi&&(this.ref["tooltip-el"].className=ai("filter-tooltip",{"filter-tooltip_visible":!1,"filter-tooltip_hidden":!0}))}_createOperationControl(e){let t=ji.is&&new ji;return t.operation=e,t}_createFilterControl(e){let t=zi.is&&new zi;return t.filter=e,t}_createToggleControl(e){let t=Mi.is&&new Mi;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();e===bi?this.$.cropOperations.forEach((e=>{let t=this._createToggleControl(e);i.appendChild(t)})):e===_i?[Bi,...this.$.filters].forEach((e=>{let t=this._createFilterControl(e);i.appendChild(t)})):e===fi&&this.$.colorOperations.forEach((e=>{let t=this._createOperationControl(e);i.appendChild(t)})),i.childNodes.forEach(((e,t)=>{t===i.childNodes.length-1&&e.classList.add("controls-list_last-item")})),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}){this.$.tabId=e,e===bi?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let t of vi){let i=t===e;this.ref[`tab-toggle-${t}`].active=i,i?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(t),this.$[`presence.tabContent.${t}`]=i}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$.tabId}`];this.ref["tabs-indicator"].style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl($i(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:i}=ci([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",(e=>{e&&setTimeout((()=>{this._activateTab(this.$.tabId,{fromViewer:!0})}),0)})),this.sub("*currentFilter",(e=>{this.$["*operationTooltip"]=this.l10n(e||Bi),this.ref["tooltip-el"].className=ai("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e})})),this.sub("*currentOperation",(e=>{this.$.tabId===fi&&(this.$["*operationTooltip"]=e,this.ref["tooltip-el"].className=ai("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e}))})),this.sub("*tabId",(e=>{e===_i&&(this.$["*operationTooltip"]=this.$["*currentFilter"]),this.ref["tooltip-el"].className=ai("filter-tooltip",{"filter-tooltip_visible":e===_i,"filter-tooltip_hidden":e!==_i})})),this.sub("*originalUrl",(e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()})),this.sub("*editorTransformations",(e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)})),this.sub("*loadingOperations",(e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,e]of i.entries())if(e){t=!0;break}}this._debouncedShowLoader(t)})),this.sub("*showSlider",(e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}))}}Ji.template=`\n  <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n  <div class="filter-tooltip_container">\n    <div class="filter-tooltip_wrapper">\n      <div ref="tooltip-el" class="filter-tooltip filter-tooltip_visible">{{*operationTooltip}}</div>\n    </div>\n  </div>\n  <div class="toolbar-container">\n    <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">\n      <div class="tab-content-row">${vi.map((function(e){return`\n    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${e}; styles: presence.tabContentStyles">\n      <lr-editor-scroller hidden-scrollbar>\n        <div class="controls-list_align">\n          <div class="controls-list_inner" ref="controls-list-${e}"></div>\n        </div>\n      </lr-editor-scroller>\n    </lr-presence-toggle>\n  `})).join("")}</div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"> </lr-btn-ui>\n        <div class="tab-toggles">\n          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>\n          ${vi.map((function(e){return`\n    <lr-btn-ui\n      theme="boring"\n      ref="tab-toggle-${e}"\n      data-id="${e}"\n      icon="${e}"\n      tabindex="0"\n      set="onclick: on.clickTab;"\n    >\n    </lr-btn-ui>\n  `})).join("")}\n        </div>\n        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"> </lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n    <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">\n      <div class="slider">\n        <lr-editor-slider ref="slider-el"></lr-editor-slider>\n      </div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"> </lr-btn-ui>\n        <lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"> </lr-btn-ui>\n      </div>\n    </lr-presence-toggle>\n  </div>\n`;class Zi extends ie{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.ctxInit,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}))}_iconCss(){return ai("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",(e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()})),this.sub("theme",(e=>{"custom"!==e&&(this.className=e)})),this.sub("text",(e=>{this._iconSingle=!1})),this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}Zi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),Zi.template='\n  <lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>\n  <div class="text">{{text}}</div>\n';class Qi extends ie{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",(e=>{"boolean"==typeof e&&(e?this._start():this._stop())}))}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}Qi.template='\n  <div class="inner">\n    <div class="line" ref="line-el"></div>\n  </div>\n';const es="transition",ts="visible",is="hidden";class ss extends ie{constructor(){super(),this._visible=!1,this._visibleStyle=ts,this._hiddenStyle=is,this._externalTransitions=!1,this.defineAccessor("styles",(e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)})),this.defineAccessor("visible",(e=>{"boolean"==typeof e&&(this._visible=e,this._handleVisible())}))}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",function(e,...t){let i=ni(...t);for(let t of Object.keys(i))e.classList.toggle(t,i[t])}(this,{[es]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(es),this._handleVisible(),setTimeout((()=>this.removeAttribute("hidden")),0)}}ss.template=" <slot></slot> ";class rs extends ie{init$={...this.ctxInit,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}};constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",(e=>{this.$.disabled=e})),this.defineAccessor("min",(e=>{this.$.min=e})),this.defineAccessor("max",(e=>{this.$.max=e})),this.defineAccessor("defaultValue",(e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)})),this.defineAccessor("zero",(e=>{this._zero=e})),this.defineAccessor("onInput",(e=>{e&&(this.$.onInput=e)})),this.defineAccessor("onChange",(e=>{e&&(this.$.onChange=e)})),this._updateSteps(),this._observer=new Hi((()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)})),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout((()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),0),this.sub("disabled",(e=>{let t=this.ref["input-el"];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}));let e=this.ref["input-el"];e.addEventListener("focus",(()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")})),e.addEventListener("blur",(()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")}))}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this.ref["thumb-el"].style.transform=`translateX(${i}px)`}))}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this._zeroDotEl.style.transform=`translateX(${i}px)`}))}_updateSteps(){let e=this.ref["steps-el"],{width:t}=e.getBoundingClientRect(),i=Math.ceil(t/2),s=Math.ceil(i/15)-2;if(this._stepsCount===s)return;let r=document.createDocumentFragment(),n=document.createElement("div"),a=document.createElement("div");n.className="minor-step",a.className="border-step",r.appendChild(a);for(let e=0;e<s;e++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());for(let e=0;e<s;e++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());let o=document.createElement("div");o.className="zero-dot",r.appendChild(o),this._zeroDotEl=o,e.innerHTML="",e.appendChild(r),this._stepsCount=s}destroyCallback(){this._observer?.disconnect()}}rs.template='\n  <div class="steps" ref="steps-el"></div>\n  <div ref="thumb-el" class="thumb"></div>\n  <input\n    class="input"\n    type="range"\n    ref="input-el"\n    tabindex="0"\n    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"\n  />\n';let ns={};window.addEventListener("message",(e=>{let t;try{t=JSON.parse(e.data)}catch(e){return}if(t?.type in ns){let i=ns[t.type];for(let[s,r]of i)e.source===s&&r(t)}}));function as({textColor:e,backgroundColor:t,linkColor:i,linkColorHover:s,shadeColor:r}){let n=`solid 1px ${r}`;return a={body:{color:e,"background-color":t},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:i},".bread-crumbs a:hover":{color:s},".main-content.loading":{background:`${t} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${r}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:i},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:s},".side-bar-menu a":{color:i},".side-bar-menu a:hover":{color:s},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:s},".source-vk .side-bar-menu a":{color:i},".source-vk .side-bar-menu a:hover":{color:s,background:"none"}},Object.keys(a).reduce(((e,t)=>{let i=a[t],s=Object.keys(i).reduce(((e,t)=>e+`${t}: ${i[t]};`),"");return e+`${t}{${s}}`}),"");var a}class os extends _t{activityType=ae.activities.EXTERNAL;init$={...this.ctxInit,counter:0,onDone:()=>{this.$["*currentActivity"]=ae.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}};_iframe=null;initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;this.set$({"*activityCaption":`${e?.[0].toUpperCase()}${e?.slice(1)}`,"*activityIcon":e}),this.$.counter=0,this.mountIframe()},onClose:()=>this.historyBack()}),this.sub("*currentActivity",(e=>{e!==this.activityType&&this.unmountIframe()}))}sendMessage(e){this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){this.$.counter=this.$.counter+1;let{url:t,filename:i}=e;this.uploadCollection.add({externalUrl:t,fileName:i})}handleIframeLoad(e){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:as(e)})}remoteUrl(){let e=this.getCssData("--cfg-pubkey"),t=(!1).toString(),{externalSourceType:i}=this.activityParams;return`https://social.uploadcare.com/window3/${i}?${function(e){let t=[];for(let[i,s]of Object.entries(e))null==s||"string"==typeof s&&0===s.length||t.push(`${i}=${encodeURIComponent(s)}`);return t.join("&")}({lang:"en",widget_version:"3.11.3",public_key:e,images_only:t,pass_window_open:!1,session_key:this.getCssData("--cfg-remote-tab-session-key")})}`}mountIframe(){let e=X({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});var t,i,s;e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),t="file-selected",i=e.contentWindow,s=this.handleFileSelected.bind(this),t in ns||(ns[t]=[]),ns[t].push([i,s]),this._iframe=e}unmountIframe(){var e,t;this._iframe&&(e="file-selected",t=this._iframe.contentWindow,e in ns&&(ns[e]=ns[e].filter((e=>e[0]!==t)))),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}}os.template='\n  <div ref="iframeWrapper" class="iframe-wrapper"></div>\n  <div class="toolbar">\n    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>\n    <div></div>\n    <div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div>\n    <button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter">\n      <lr-icon name="check"></lr-icon>\n    </button>\n  </div>\n';class ls extends ie{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach((t=>{t.getAttribute("tab-ctx")===e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}));for(let t in this._tabMap)t===e?this._tabMap[t].setAttribute("current",""):this._tabMap[t].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",(e=>{if(!e)return;e.split(",").map((e=>e.trim())).forEach((e=>{let t=X({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(e)}}});t.textContent=this.l10n(e),this.ref.row.appendChild(t),this._tabMap[e]=t}))})),this.defineAccessor("default",(e=>{this.setCurrentTab(e)})),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}ls.bindAttributes({"tab-list":null,default:null}),ls.template='\n  <div ref="row" class="tabs-row"></div>\n  <div ref="context" class="tabs-context">\n    <slot></slot>\n  </div>\n';class cs extends _t{processInnerHtml=!0;init$={...this.ctxInit,output:null,filesData:null};cssInit$={"--cfg-group-output":0};get dict(){return cs.dict}initCallback(){super.initCallback(),this.sub("output",(e=>{e&&(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(this.dict.FORM_VALUE_ATTR)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this._input.hidden=!0,this.appendChild(this._input)),this._input.value=JSON.stringify(e)),this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(e))}),!1),this.sub(this.dict.SRC_CTX_KEY,(async e=>{if(!e)return this.$.output=null,void(this.$.filesData=null);if(this.$.filesData=e,this.getCssData("--cfg-group-output")||this.hasAttribute(this.dict.GROUP_ATTR)){let t=e.map((e=>e.uuid)),i=await ct(t,{...this.getUploadClientOptions()});this.$.output={groupData:i,files:e}}else this.$.output=e}),!1)}}cs.dict={SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_VALUE_ATTR:"form-value"};class hs extends ae{}hs.template=' <div class="caption">{{*activityCaption}}</div> ';class ds extends ae{}ds.template=' <lr-icon set="@name: *activityIcon"></lr-icon> ';class us extends ie{init$={...this.ctxInit,currentText:"",options:[],selectHtml:"",onSelect:e=>{e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find((e=>e.value==this.value))?.text||"",this.dispatchEvent(new Event("change"))}};initCallback(){super.initCallback(),this.sub("options",(e=>{this.$.currentText=e?.[0]?.text||"";let t="";e?.forEach((e=>{t+=`<option value="${e.value}">${e.text}</option>`})),this.$.selectHtml=t}))}}us.template='\n  <button>\n    {{currentText}}\n    <lr-icon name="select"></lr-icon>\n    <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>\n  </button>\n';const ps="play",ms="pause",gs="fullscreen-on",bs="fullscreen-off",fs="unmute",_s="mute",vs="captions",ys="captions-off",ws=e=>{e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()},Cs=()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()};class xs extends ie{togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?Cs():ws(this)}toggleCaptions(){this.$.capIcon===ys?(this.$.capIcon=vs,this._video.textTracks[0].mode="showing",window.localStorage.setItem(xs.is+":captions","1")):(this.$.capIcon=ys,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(xs.is+":captions"))}toggleSound(){this.$.volIcon===fs?(this.$.volIcon=_s,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=fs,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(e){window.localStorage.setItem(xs.is+":volume",e);let t=e?e/100:0;this._video.volume=t}get progress(){return this.ref.progress}init$={...this.ctxInit,src:"",ppIcon:ps,fsIcon:gs,volIcon:fs,capIcon:ys,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:e=>{let t=parseFloat(e.currentTarget.$.value);this.setVolume(t)},progressClicked:e=>{let t=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(e.offsetX/t.width)}};_getUrl(e){return e.includes("/")?e:`https://ucarecdn.com/${e}/`}_desc2attrs(e){let t=[];for(let i in e){let s="src"===i?this._getUrl(e[i]):e[i];t.push(`${i}="${s}"`)}return t.join(" ")}_timeFmt(e){let t=new Date(1e3*Math.round(e));return[t.getMinutes(),t.getSeconds()].map((e=>e<10?"0"+e:e)).join(":")}_initTracks(){[...this._video.textTracks].forEach((e=>{e.mode="hidden"})),window.localStorage.getItem(xs.is+":captions")&&this.toggleCaptions()}_castAttributes(){let e=["autoplay","loop","muted"];[...this.attributes].forEach((t=>{e.includes(t.name)&&this._video.setAttribute(t.name,t.value)}))}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",(()=>{this.$.ppIcon=ms,this.setAttribute("playback","")})),this._video.addEventListener("pause",(()=>{this.$.ppIcon=ps,this.removeAttribute("playback")})),this.addEventListener("fullscreenchange",(e=>{console.log(e),document.fullscreenElement===this?this.$.fsIcon=bs:this.$.fsIcon=gs})),this.sub("src",(e=>{if(!e)return;let t=this._getUrl(e);this._video.src=t})),this.sub("video",(async e=>{if(!e)return;let t=await(await window.fetch(this._getUrl(e))).json();t.poster&&(this._video.poster=this._getUrl(t.poster));let i="";t?.sources.forEach((e=>{i+=`<source ${this._desc2attrs(e)} />`})),t.tracks&&(t.tracks.forEach((e=>{i+=`<track ${this._desc2attrs(e)} />`})),this.$.hasSubtitles=!0),this._video.innerHTML+=i,this._initTracks(),console.log(t)})),this._video.addEventListener("loadedmetadata",(e=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)})),this._video.addEventListener("timeupdate",(e=>{let t=Math.round(this._video.currentTime/this._video.duration*100);this.$.progressCssWidth=t+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)}));let e=window.localStorage.getItem(xs.is+":volume");if(e){let t=parseFloat(e);this.setVolume(t),this.$.volumeValue=t}}}xs.template='\n  <div class="video-wrapper">\n    <video ref="video" preload="metadata" crossorigin="anonymous"></video>\n  </div>\n\n  <div class="toolbar">\n    <div class="progress" ref="progress" set -onclick="progressClicked">\n      <div class="bar" set -style.width="progressCssWidth"></div>\n    </div>\n\n    <div class="tb-block">\n      <button set -onclick="onPP">\n        <lr-icon set -@name="ppIcon"></lr-icon>\n      </button>\n      <div class="timer">{{currentTime}} / {{totalTime}}</div>\n    </div>\n\n    <div class="tb-block">\n      <button set -onclick="onCap" -@hidden="!hasSubtitles">\n        <lr-icon set -@name="capIcon"></lr-icon>\n      </button>\n\n      <button set -onclick="onMute">\n        <lr-icon set -@name="volIcon"></lr-icon>\n      </button>\n\n      <lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"> </lr-range>\n\n      <button set -onclick="onFs">\n        <lr-icon set -@name="fsIcon"></lr-icon>\n      </button>\n    </div>\n  </div>\n',xs.bindAttributes({video:"video",src:"src"});class $s extends ie{pauseRender=!0;shadowReadyCallback(){}initCallback(){super.initCallback();let e=this.getAttribute("css-src");if(e){this.renderShadow=!0,this.attachShadow({mode:"open"});let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,t.onload=()=>{window.requestAnimationFrame((()=>{this.render(),window.setTimeout((()=>{this.shadowReadyCallback()}))}))},this.shadowRoot.appendChild(t)}else this.render(),this.shadowReadyCallback()}}class Ts extends $s{ctxInit=te();ctxOwner=!0}class As extends Ts{}As.template='\n  <lr-simple-btn></lr-simple-btn>\n\n  <lr-modal strokes block-body-scrolling>\n    <lr-activity-icon slot="heading"></lr-activity-icon>\n    <lr-activity-caption slot="heading"></lr-activity-caption>\n    <lr-start-from>\n      <lr-source-list wrap></lr-source-list>\n      <lr-drop-area clickable></lr-drop-area>\n    </lr-start-from>\n    <lr-upload-list></lr-upload-list>\n    <lr-camera-source></lr-camera-source>\n    <lr-url-source></lr-url-source>\n    <lr-external-source></lr-external-source>\n    <lr-upload-details></lr-upload-details>\n    <lr-confirmation-dialog></lr-confirmation-dialog>\n    <lr-cloud-image-editor></lr-cloud-image-editor>\n  </lr-modal>\n\n  <lr-message-box></lr-message-box>\n  <lr-progress-bar-common></lr-progress-bar-common>\n';class ks extends Ts{pauseRender=!0;init$={...this.ctxInit,selectClicked:()=>{this.ref.uBlock.openSystemDialog()}};shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||ae.activities.START_FROM)})),this.sub("*uploadList",(t=>{0===t?.length&&(this.$["*currentActivity"]=e.initActivity||ae.activities.START_FROM)}))}}ks.template='\n  <lr-start-from>\n    <lr-drop-area clickable l10n="drop-files-here"></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list ref="uBlock"></lr-upload-list>\n  <lr-message-box></lr-message-box>\n';class Es extends Ts{init$={...this.ctxInit,dropAreaHidden:!1};shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",(t=>{t||(this.$["*currentActivity"]=e.initActivity||ae.activities.START_FROM)})),window.customElements.whenDefined(e.tagName.toLowerCase()).then((()=>{1!==e.sourceList.length||e.sourceList.includes(_t.sourceTypes.LOCAL)||(this.$.dropAreaHidden=!0)}))}}function Ss(e){for(let t in e){let i=[...t].reduce(((e,t)=>(t.toUpperCase()===t&&(t="-"+t.toLowerCase()),e+t)),"");i.startsWith("-")&&(i=i.replace("-","")),i.startsWith("lr-")||(i="lr-"+i),e[t].reg&&e[t].reg(i)}}Es.template=' <lr-start-from>\n    <lr-source-list wrap></lr-source-list>\n    <lr-drop-area set="@hidden: dropAreaHidden" clickable></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list ref="uBlock"></lr-upload-list>\n  <lr-camera-source></lr-camera-source>\n  <lr-url-source></lr-url-source>\n  <lr-external-source></lr-external-source>\n  <lr-upload-details></lr-upload-details>\n  <lr-confirmation-dialog></lr-confirmation-dialog>\n  <lr-message-box></lr-message-box>\n  <lr-progress-bar></lr-progress-bar>\n  <lr-cloud-image-editor></lr-cloud-image-editor>';const Is="__lr-blocks__";var Us=Object.freeze({__proto__:null,BaseComponent:K,Data:R,Block:ie,ActivityBlock:ae,UploaderBlock:_t,Icon:vt,Img:class extends Lt{initCallback(){super.initCallback(),this.sub$$("src",(()=>{this.init()})),this.sub$$("uuid",(()=>{this.init()})),this.sub$$("lazy",(e=>{this.$$("is-background-for")||(this.img.loading=e?"lazy":"eager")}))}},SimpleBtn:Rt,StartFrom:class extends ae{activityType="start-from";initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.add$({"*activityCaption":this.l10n("select-file-source"),"*activityIcon":"default"},!0)}})}},DropArea:class extends _t{init$={...this.ctxInit,state:Dt.INACTIVE};initCallback(){if(super.initCallback(),this._destroyDropzone=Vt({element:this,onChange:e=>{this.$.state=e},onItems:e=>{e.length&&(this.getCssData("--cfg-multiple")||(e=[e[0]]),e.forEach((e=>{if("string"==typeof e)return void this.uploadCollection.add({externalUrl:e});let t=he(e);this.uploadCollection.add({file:e,isImage:t,mimeType:e.type,fileName:e.name,fileSize:e.size})})),this.uploadCollection.size&&(this.set$({"*currentActivity":ae.activities.UPLOAD_LIST}),this.setForCtxTarget("lr-modal","*modalActive",!0)))}}),this.sub("state",(e=>{const t=Object.entries(Dt).find((([,t])=>t===e))?.[0].toLowerCase();t&&this.setAttribute("drag-state",t)})),this.hasAttribute("clickable")){let e=this.getAttribute("clickable");""!==e&&"true"!==e||(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}}destroyCallback(){super.destroyCallback(),this._destroyDropzone?.(),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}},SourceBtn:Bt,SourceList:class extends ie{cssInit$={"--cfg-source-list":""};initCallback(){super.initCallback(),this.sub("--cfg-source-list",(e=>{if(!e)return;let t=e.split(",").map((e=>e.trim())),i="";t.forEach((e=>{i+=`<lr-source-btn type="${e}"></lr-source-btn>`})),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=i:this.outerHTML=i}))}},FileItem:Kt,Modal:Xt,UploadList:Yt,UrlSource:Jt,CameraSource:Qt,UploadCtxProvider:class extends _t{},UploadDetails:ei,MessageBox:zt,ConfirmationDialog:Gt,ProgressBarCommon:ti,ProgressBar:ii,FilePreview:ri,CloudImageEditor:class extends _t{activityType=ae.activities.CLOUD_IMG_EDIT;init$={...this.ctxInit,uuid:null};initCallback(){super.initCallback(),this.bindCssData("--cfg-pubkey"),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor(),onClose:()=>this.historyBack()}),this.sub("*focusedEntry",(e=>{e&&(this.entry=e,this.entry.subscribe("uuid",(e=>{e&&(this.$.uuid=e)})))}))}handleApply(e){let t=e.detail;this.entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let e=new Ti;e.classList.add("lr-cldtr-common");let t=this.$.uuid;e.setAttribute("uuid",t),e.addEventListener("apply",(e=>this.handleApply(e))),e.addEventListener("cancel",(()=>this.handleCancel())),this.innerHTML="",this.appendChild(e)}unmountEditor(){this.innerHTML=""}},ExternalSource:os,Tabs:ls,DataOutput:cs,ActivityCaption:hs,ActivityIcon:ds,Select:us,Video:xs,ShadowWrapper:$s,FileUploaderRegular:As,FileUploaderMinimal:ks,FileUploaderInline:Es,registerBlocks:Ss,connectBlocksFrom:async function(e,t=!1){return new Promise(((i,s)=>{if("object"!=typeof document)return void i(null);if("object"==typeof window&&window[Is])return void i(window[Is]);let r=document.createElement("script");r.type="module",r.src=e,r.onerror=()=>{s()},r.onload=()=>{let e=window[Is];t&&Ss(e),i(e)},document.head.appendChild(r)}))},CloudEditor:Ti,CropFrame:Oi,EditorCropButtonControl:Mi,EditorFilterControl:zi,EditorOperationControl:ji,EditorImageCropper:Xi,EditorImageFader:class extends ie{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=oi(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame((()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}}))}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let r={...this._transformations};i&&(r[i]=t?{name:t,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl($i(e,n,r))}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find((e=>e.value===i));if(s())return;let r=this._constructKeypoint(e,i),n=new Image;n.src=r.src;let a=this._handleImageLoading(r.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),r.image=n,n.classList.add("fader-image"),n.addEventListener("load",(()=>{if(s())return;let t=this._keypoints,a=t.findIndex((e=>e.value>i)),o=a<t.length?t[a].image:null;!this._container||o&&!this._container.contains(o)||(t.splice(a,0,r),this._container.insertBefore(n,o),this._update(e,i))}),{once:!0}),n.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}set(e){e="string"==typeof e?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=xi[e],s=this._keypoints.map((e=>e.value)),r=function(e,t,i){let s=(r=e,r.reduce(((e,t,i)=>i<r.length-1?[...e,[t,r[i+1]]]:e),[])).find((([e,i])=>e<=t&&t<=i));var r;return e.map((e=>{let r=Math.abs(s[0]-s[1]),n=Math.abs(t-s[0])/r;return s[0]===e?t>i?1:1-n:s[1]===e?t>=i?n:1:0}))}(s,t,i),n=function(e,t){return e.map(((i,s)=>i<t?e.length-s:s))}(s,i);for(let[e,t]of Object.entries(this._keypoints))t.opacity=r[e],t.zIndex=n[e];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map((e=>e.src)),{images:s,promise:r,cancel:n}=ci(i);s.forEach((e=>{let t=this._handleImageLoading(e.src);e.addEventListener("load",t),e.addEventListener("error",t)})),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,o=this._filter;await r,this._isActive&&this._isSame(a,o)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach(((e,t)=>{let i=s[t];i.classList.add("fader-image"),e.image=i,this._container.appendChild(i)})),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let r=Gi(i,s).map((s=>this._imageSrc({url:e,filter:t,operation:i,value:s}))),{cancel:n}=ci(r);this._cancelBatchPreload=n}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e)return t.style.opacity="1",t.style.transform="scale(1)",void(this.className=ai({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}));t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",(()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=ai({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))}),{once:!0}),t.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=r,"number"!=typeof i&&!s){let e=this._imageSrc({operation:t,value:i});return this._setOriginalSrc(e),void(this._container&&this._container.remove())}this._keypoints=Gi(t,i).map((e=>this._constructKeypoint(t,e))),this._update(t,i),this._initNodes()}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=ai({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",(()=>{this._container&&this._container.remove()}),{once:!0})):this._container&&this._container.remove()}},EditorScroller:Yi,EditorSlider:Fi,EditorToolbar:Ji,LrBtnUi:Zi,LineLoaderUi:Qi,PresenceToggle:ss,SliderUi:rs});function Ls(e,t,i){const s=e.slice();return s[2]=t[i],s}function Rs(e){let t,i;return{c(){t=u("img"),l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/-/preview/-/scale_crop/400x400/")||m(t,"src",i),m(t,"width","200"),m(t,"alt","Uploadcare uploaded file")},m(e,i){h(e,t,i)},p(e,s){1&s&&!l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/-/preview/-/scale_crop/400x400/")&&m(t,"src",i)},d(e){e&&d(t)}}}function Ps(t){let i,s,r,n,a,o,l,b,f=t[0],_=[];for(let e=0;e<f.length;e+=1)_[e]=Rs(Ls(t,f,e));return{c(){i=u("div"),s=u("lr-file-uploader-regular"),r=p(),n=u("lr-data-output"),a=p(),o=u("div");for(let e=0;e<_.length;e+=1)_[e].c();g(s,"class","uploader-cfg lr-wgt-common svelte-5i7ef"),g(n,"use-event",""),g(n,"class","uploader-cfg lr-wgt-common svelte-5i7ef"),m(o,"class","output svelte-5i7ef"),m(i,"class","wrapper svelte-5i7ef")},m(e,d){h(e,i,d),c(i,s),c(i,r),c(i,n),c(i,a),c(i,o);for(let e=0;e<_.length;e+=1)_[e].m(o,null);var u,p,m,g;l||(u=n,p="lr-data-output",m=t[1],u.addEventListener(p,m,g),b=()=>u.removeEventListener(p,m,g),l=!0)},p(e,[t]){if(1&t){let i;for(f=e[0],i=0;i<f.length;i+=1){const s=Ls(e,f,i);_[i]?_[i].p(s,t):(_[i]=Rs(s),_[i].c(),_[i].m(o,null))}for(;i<_.length;i+=1)_[i].d(1);_.length=f.length}},i:e,o:e,d(e){e&&d(i),function(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}(_,e),l=!1,b()}}}function Os(e,t,i){Ss(Us);let s=[];return[s,function(e){const{data:t}=e.detail;i(0,s=t)}]}return new class extends class{$destroy(){!function(e,t){const i=e.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),I(this,e,Os,Ps,n,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
