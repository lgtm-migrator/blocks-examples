var app=function(){"use strict";function t(){}function e(t){return t()}function i(){return Object.create(null)}function s(t){t.forEach(e)}function r(t){return"function"==typeof t}function n(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let a,o;function l(t,e){return a||(a=document.createElement("a")),a.href=e,t===a.href}function c(t,e){t.appendChild(e)}function h(t,e,i){t.insertBefore(e,i||null)}function d(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function p(){return t=" ",document.createTextNode(t);var t}function m(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function g(t,e,i){e in t?t[e]="boolean"==typeof t[e]&&""===i||i:m(t,e,i)}function f(t){o=t}const b=[],_=[],v=[],y=[],w=Promise.resolve();let C=!1;function x(t){v.push(t)}const $=new Set;let T=0;function A(){const t=o;do{for(;T<b.length;){const t=b[T];T++,f(t),k(t.$$)}for(f(null),b.length=0,T=0;_.length;)_.pop()();for(let t=0;t<v.length;t+=1){const e=v[t];$.has(e)||($.add(e),e())}v.length=0}while(b.length);for(;y.length;)y.pop()();C=!1,$.clear(),f(t)}function k(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(x)}}const E=new Set;function S(t,e){-1===t.$$.dirty[0]&&(b.push(t),C||(C=!0,w.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function I(n,a,l,c,h,u,p,m=[-1]){const g=o;f(n);const b=n.$$={fragment:null,ctx:null,props:u,update:t,not_equal:h,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(g?g.$$.context:[])),callbacks:i(),dirty:m,skip_bound:!1,root:a.target||g.$$.root};p&&p(b.root);let _=!1;if(b.ctx=l?l(n,a.props||{},((t,e,...i)=>{const s=i.length?i[0]:e;return b.ctx&&h(b.ctx[t],b.ctx[t]=s)&&(!b.skip_bound&&b.bound[t]&&b.bound[t](s),_&&S(n,t)),e})):[],b.update(),_=!0,s(b.before_update),b.fragment=!!c&&c(b.ctx),a.target){if(a.hydrate){const t=function(t){return Array.from(t.childNodes)}(a.target);b.fragment&&b.fragment.l(t),t.forEach(d)}else b.fragment&&b.fragment.c();a.intro&&((v=n.$$.fragment)&&v.i&&(E.delete(v),v.i(y))),function(t,i,n,a){const{fragment:o,on_mount:l,on_destroy:c,after_update:h}=t.$$;o&&o.m(i,n),a||x((()=>{const i=l.map(e).filter(r);c?c.push(...i):s(i),t.$$.on_mount=[]})),h.forEach(x)}(n,a.target,a.anchor,a.customElement),A()}var v,y;f(g)}var U=Object.defineProperty,R=(t,e,i)=>(((t,e,i)=>{e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);var L=class{constructor(t){t.constructor===Object?this.store=function(t){let e=t=>{var i;for(let s in t)(null==(i=t[s])?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}};return e(t)}(t):(this._storeIsProxy=!0,this.store=t),this.callbackMap=Object.create(null)}static warn(t,e){console.warn(`Symbiote Data: cannot ${t}. Prop name: `+e)}read(t){return this._storeIsProxy||this.store.hasOwnProperty(t)?this.store[t]:(L.warn("read",t),null)}has(t){return this._storeIsProxy?void 0!==this.store[t]:this.store.hasOwnProperty(t)}add(t,e,i=!1){i||!Object.keys(this.store).includes(t)?(this.store[t]=e,this.notify(t)):e!==this.store[t]&&this.notify(t)}pub(t,e){this._storeIsProxy||this.store.hasOwnProperty(t)?(this.store[t]=e,this.notify(t)):L.warn("publish",t)}multiPub(t){for(let e in t)this.pub(e,t[e])}notify(t){this.callbackMap[t]&&this.callbackMap[t].forEach((e=>{e(this.store[t])}))}sub(t,e,i=!0){return this._storeIsProxy||this.store.hasOwnProperty(t)?(this.callbackMap[t]||(this.callbackMap[t]=new Set),this.callbackMap[t].add(e),i&&e(this.store[t]),{remove:()=>{this.callbackMap[t].delete(e),this.callbackMap[t].size||delete this.callbackMap[t]},callback:e}):(L.warn("subscribe",t),null)}static registerCtx(t,e=Symbol()){let i=L.globalStore.get(e);return i?console.warn('State: context UID "'+e+'" already in use'):(i=new L(t),L.globalStore.set(e,i)),i}static deleteCtx(t){L.globalStore.delete(t)}static getCtx(t,e=!0){return L.globalStore.get(t)||(e&&console.warn('State: wrong context UID - "'+t+'"'),null)}};L.globalStore=new Map;var P=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template"}),M="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",O=M.length-1,D=class{static generate(t="XXXXXXXXX-XXX"){let e="";for(let i=0;i<t.length;i++)e+="-"===t[i]?t[i]:M.charAt(Math.random()*O);return e}};function N(t,e,i){let s,r=!0,n=e.split(".");return n.forEach(((e,i)=>{i<n.length-1?t=t[e]:s=e})),t?t[s]=i:r=!1,r}var B="{{",V="}}";var z=[function(t,e){[...t.querySelectorAll(`[${P.REPEAT_ATTR}]`)].forEach((t=>{let i,s=t.getAttribute(P.REPEAT_ITEM_TAG_ATTR);if(s&&(i=window.customElements.get(s)),!i){i=class extends e.BaseComponent{constructor(){super(),s||(this.style.display="contents")}};let r=t.innerHTML;i.template=r,i.reg(s)}for(;t.firstChild;)t.firstChild.remove();let r=t.getAttribute(P.REPEAT_ATTR);e.sub(r,(e=>{if(!e){for(;t.firstChild;)t.firstChild.remove();return}let s,r=[...t.children],n=e=>{e.forEach(((t,e)=>{if(r[e])if(r[e].set$)r[e].set$(t);else for(let i in t)r[e][i]=t[i];else{s||(s=new DocumentFragment);let e=new i;Object.assign(e.init$,t),s.appendChild(e)}})),s&&t.appendChild(s);let n=r.slice(e.length,r.length);for(let t of n)t.remove()};if(e.constructor===Array)n(e);else if(e.constructor===Object){let t=[];for(let i in e){let s=e[i];Object.defineProperty(s,"_KEY_",{value:i,enumerable:!0}),t.push(s)}n(t)}else console.warn("Symbiote repeat data type error:"),console.log(e)})),t.removeAttribute(P.REPEAT_ATTR),t.removeAttribute(P.REPEAT_ITEM_TAG_ATTR)}))},function(t,e){if(e.shadowRoot)return;let i=[...t.querySelectorAll("slot")];if(e.initChildren.length&&i.length){let t={};i.forEach((e=>{let i=e.getAttribute("name");i?t[i]={slot:e,fr:document.createDocumentFragment()}:t.__default__={slot:e,fr:document.createDocumentFragment()}})),e.initChildren.forEach((e=>{var i;let s=null==(i=e.getAttribute)?void 0:i.call(e,"slot");s?(e.removeAttribute("slot"),t[s].fr.appendChild(e)):t.__default__&&t.__default__.fr.appendChild(e)})),Object.values(t).forEach((t=>{t.slot.parentNode.insertBefore(t.fr,t.slot),t.slot.remove()}))}},function(t,e){[...t.querySelectorAll(`[${P.EL_REF_ATTR}]`)].forEach((t=>{let i=t.getAttribute(P.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(P.EL_REF_ATTR)}))},function(t,e){[...t.querySelectorAll(`[${P.BIND_ATTR}]`)].forEach((t=>{let i=t.getAttribute(P.BIND_ATTR).split(";");[...t.attributes].forEach((e=>{if(e.name.startsWith("-")&&e.value){let s=e.name.replace("-","").split("-").map(((t,e)=>t&&e?t[0].toUpperCase()+t.slice(1):t)).join("").split("_").map(((t,e)=>t&&e?t.toUpperCase():t)).join("");i.push(s+":"+e.value),t.removeAttribute(e.name)}})),i.forEach((i=>{if(!i)return;let s,r=i.split(":").map((t=>t.trim())),n=r[0];0===n.indexOf(P.ATTR_BIND_PRFX)&&(s=!0,n=n.replace(P.ATTR_BIND_PRFX,""));let a=r[1].split(",").map((t=>t.trim()));for(let i of a){let r;i.startsWith("!!")?(r="double",i=i.replace("!!","")):i.startsWith("!")&&(r="single",i=i.replace("!","")),e.sub(i,(e=>{"double"===r?e=!!e:"single"===r&&(e=!e),s?(null==e?void 0:e.constructor)===Boolean?e?t.setAttribute(n,""):t.removeAttribute(n):t.setAttribute(n,e):N(t,n,e)||(t[P.SET_LATER_KEY]||(t[P.SET_LATER_KEY]=Object.create(null)),t[P.SET_LATER_KEY][n]=e)}))}})),t.removeAttribute(P.BIND_ATTR)}))},function(t,e){(function(t){let e,i=[],s=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:t=>{var e;return!(null==(e=t.parentElement)?void 0:e.hasAttribute("skip-text"))&&t.textContent.includes(B)&&t.textContent.includes(V)&&1}});for(;e=s.nextNode();)i.push(e);return i})(t).forEach((t=>{let i,s=[];for(;t.textContent.includes(V);)t.textContent.startsWith(B)?(i=t.textContent.indexOf(V)+V.length,t.splitText(i),s.push(t)):(i=t.textContent.indexOf(B),t.splitText(i)),t=t.nextSibling;s.forEach((t=>{let i=t.textContent.replace(B,"").replace(V,"");t.textContent="",e.sub(i,(e=>{t.textContent=e}))}))}))}],F=0,j=null,H=null,q=class extends HTMLElement{constructor(){super(),R(this,"updateCssData",(()=>{var t;this.dropCssDataCache(),null==(t=this.__boundCssProps)||t.forEach((t=>{let e=this.getCssData(this.__extractCssName(t),!0);this.$[t]!==e&&(this.$[t]=e)}))})),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return q}initCallback(){}__initCallback(){var t;this.__initialized||(this.__initialized=!0,null==(t=this.initCallback)||t.call(this))}render(t,e=this.renderShadow){let i;if(!e&&!this.constructor.__shadowStylesUrl||this.shadowRoot||this.attachShadow({mode:"open"}),this.allowCustomTemplate){let e=this.getAttribute(P.USE_TPL);if(e){let i=this.getRootNode(),s=(null==i?void 0:i.querySelector(e))||document.querySelector(e);s?t=s.content.cloneNode(!0):console.warn(`Symbiote template "${e}" is not found...`)}}if(this.processInnerHtml)for(let t of this.tplProcessors)t(this,this);if(t||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(null==t?void 0:t.constructor)===DocumentFragment)i=t;else if((null==t?void 0:t.constructor)===String){let e=document.createElement("template");e.innerHTML=t,i=e.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let t of this.tplProcessors)t(i,this)}let s=()=>{i&&(e&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){e=!0;let t=document.createElement("link");t.rel="stylesheet",t.href=this.constructor.__shadowStylesUrl,t.onload=s,this.shadowRoot.prepend(t)}else s()}addTemplateProcessor(t){this.tplProcessors.add(t)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=D.generate(),this.style.setProperty(P.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(P.CSS_CTX_PROP,!0)}get ctxName(){var t;return(null==(t=this.getAttribute(P.CTX_NAME_ATTR))?void 0:t.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=L.registerCtx({},this)),this.__localCtx}get nodeCtx(){return L.getCtx(this.ctxName,!1)||L.registerCtx({},this.ctxName)}static __parseProp(t,e){let i,s;if(t.startsWith(P.EXT_DATA_CTX_PRFX))i=e.nodeCtx,s=t.replace(P.EXT_DATA_CTX_PRFX,"");else if(t.includes(P.NAMED_DATA_CTX_SPLTR)){let e=t.split(P.NAMED_DATA_CTX_SPLTR);i=L.getCtx(e[0]),s=e[1]}else i=e.localCtx,s=t;return{ctx:i,name:s}}sub(t,e,i=!0){let s=t=>{this.isConnected&&e(t)},r=q.__parseProp(t,this);r.ctx.has(t)?this.allSubs.add(r.ctx.sub(r.name,s,i)):window.setTimeout((()=>{this.allSubs.add(r.ctx.sub(r.name,s,i))}))}notify(t){let e=q.__parseProp(t,this);e.ctx.notify(e.name)}has(t){let e=q.__parseProp(t,this);return e.ctx.has(e.name)}add(t,e,i=!1){let s=q.__parseProp(t,this);s.ctx.add(s.name,e,i)}add$(t,e=!1){for(let i in t)this.add(i,t[i],e)}get $(){if(!this.__stateProxy){let t=Object.create(null);this.__stateProxy=new Proxy(t,{set:(t,e,i)=>{let s=q.__parseProp(e,this);return s.ctx.pub(s.name,i),!0},get:(t,e)=>{let i=q.__parseProp(e,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(t,e=!1){for(let i in t){let s=t[i],r=[String,Number,Boolean];(e||!r.includes(null==s?void 0:s.constructor)||this.$[i]!==s)&&(this.$[i]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(P.CTX_OWNER_ATTR)&&"false"!==this.getAttribute(P.CTX_OWNER_ATTR)}__initDataCtx(){let t=this.constructor.__attrDesc;if(t)for(let e of Object.values(t))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let t in this.init$)if(t.startsWith(P.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(P.EXT_DATA_CTX_PRFX,""),this.init$[t],this.__ctxOwner);else if(t.includes(P.NAMED_DATA_CTX_SPLTR)){let e=t.split(P.NAMED_DATA_CTX_SPLTR),i=e[0].trim(),s=e[1].trim();if(i&&s){let e=L.getCtx(i,!1);e||(e=L.registerCtx({},i)),e.add(s,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);for(let t in this.cssInit$)this.bindCssData(t,this.cssInit$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var t;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let e=null==(t=this.getAttribute(P.CTX_NAME_ATTR))?void 0:t.trim();if(e&&this.style.setProperty(P.CSS_CTX_PROP,`'${e}'`),this.__initDataCtx(),this[P.SET_LATER_KEY]){for(let t in this[P.SET_LATER_KEY])N(this,t,this[P.SET_LATER_KEY][t]);delete this[P.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of z)this.addTemplateProcessor(t);this.pauseRender?this.__initCallback():this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let t of this.allSubs)t.remove(),this.allSubs.delete(t);for(let t of this.tplProcessors)this.tplProcessors.delete(t);null==H||H.delete(this.updateCssData),(null==H?void 0:H.size)||(null==j||j.disconnect(),j=null,H=null)}),100)))}static reg(t,e=!1){t||(F++,t=`${P.AUTO_TAG_PRFX}-${F}`),this.__tag=t,window.customElements.get(t)?console.warn(`${t} - is already in "customElements" registry`):window.customElements.define(t,e?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(t){this.observedAttributes=Object.keys(t),this.__attrDesc=t}attributeChangedCallback(t,e,i){var s;if(e===i)return;let r=null==(s=this.constructor.__attrDesc)?void 0:s[t];r?this.__dataCtxInitialized?this.$[r]=i:this.init$[r]=i:this[t]=i}getCssData(t,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(t)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(t).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[t]=JSON.parse(i)}catch(i){!e&&console.warn(`CSS Data error: ${t}`),this.__cssDataCache[t]=null}}return this.__cssDataCache[t]}__extractCssName(t){return t.split("--").map(((t,e)=>0===e?"":t)).join("--")}__initStyleAttrObserver(){H||(H=new Set),H.add(this.updateCssData),j||(j=new MutationObserver((t=>{"attributes"===t[0].type&&H.forEach((t=>{t()}))}))).observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]})}bindCssData(t,e=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(t);let i=this.getCssData(this.__extractCssName(t),!0);null===i&&(i=e),this.add(t,i),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(t,e,i){let s="__"+t;this[s]=this[t],Object.defineProperty(this,t,{set:t=>{this[s]=t,i?window.setTimeout((()=>{null==e||e(t)})):null==e||e(t)},get:()=>this[s]}),this[t]=this[s]}static set shadowStyles(t){let e=new Blob([t],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(e)}},K=q;function X(t,e){for(let i in e)i.includes("-")?t.style.setProperty(i,e[i]):t.style[i]=e[i]}function W(t={tag:"div"}){let e=document.createElement(t.tag);if(t.attributes&&function(t,e){for(let i in e)e[i].constructor===Boolean?e[i]?t.setAttribute(i,""):t.removeAttribute(i):t.setAttribute(i,e[i])}(e,t.attributes),t.styles&&X(e,t.styles),t.properties)for(let i in t.properties)e[i]=t.properties[i];return t.processors&&t.processors.forEach((t=>{t(e)})),t.children&&t.children.forEach((t=>{let i=W(t);e.appendChild(i)})),e}R(K,"template");var G="idb-store-ready",Y=class{static get readyEventName(){return G}static open(t="symbiote-db",e="store"){let i=t+"/"+e;return this._reg[i]||(this._reg[i]=new class{_notifyWhenReady(t=null){window.dispatchEvent(new CustomEvent(G,{detail:{dbName:this.name,storeName:this.storeName,event:t}}))}get _updEventName(){return"symbiote-idb-update_"+this.name}_getUpdateEvent(t){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:t}})}_notifySubscribers(t){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,t),window.dispatchEvent(this._getUpdateEvent(t))}constructor(t,e){this.name=t,this.storeName=e,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(e,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach((async e=>{e(await this.read(t.newValue))}))},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(t){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(t);return new Promise(((i,s)=>{e.onsuccess=e=>{var s;(null==(s=e.target.result)?void 0:s._value)?i(e.target.result._value):(i(null),console.warn(`IDB: cannot read "${t}"`))},e.onerror=t=>{s(t)}}))}write(t,e,i=!1){let s={_key:t,_value:e},r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise(((e,s)=>{r.onsuccess=s=>{i||this._notifySubscribers(t),e(s.target.result)},r.onerror=t=>{s(t)}}))}delete(t,e=!1){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(t);return new Promise(((s,r)=>{i.onsuccess=i=>{e||this._notifySubscribers(t),s(i)},i.onerror=t=>{r(t)}}))}getAll(){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise(((e,i)=>{t.onsuccess=t=>{let i=t.target.result;e(i.map((t=>t._value)))},t.onerror=t=>{i(t)}}))}subscribe(t,e){this._subscriptionsMap[t]||(this._subscriptionsMap[t]=new Set);let i=this._subscriptionsMap[t];return i.add(e),{remove:()=>{i.delete(e),i.size||delete this._subscriptionsMap[t]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,Y.clear(this.name)}}(t,e)),this._reg[i]}static clear(t){window.indexedDB.deleteDatabase(t);for(let e in this._reg)e.split("/")[0]===t&&delete this._reg[e]}};R(Y,"_reg",Object.create(null));const J=t=>t;function Z(t,e,{openToken:i="{{",closeToken:s="}}",transform:r=J}={}){for(let n in e){let a=e[n]?.toString();t=t.replaceAll(i+n+s,"string"==typeof a?r(a):a)}return t}function Q(t,e){[...t.querySelectorAll("[l10n]")].forEach((t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let t=i.split(":");s=t[0],i=t[1]}let r="l10n:"+i;e.__l10nKeys.push(r),e.add(r,i),e.sub(r,(i=>{t[s]=e.l10n(i)})),t.removeAttribute("l10n")}))}const tt={"*ctxTargetsRegistry":new Set},et={...tt,"*currentActivity":"","*currentActivityParams":{},"*history":[],"*activityCaption":"","*activityIcon":""},it={...et,"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null};class st extends K{allowCustomTemplate=!0;ctxInit=tt;init$=this.ctxInit;l10n(t,e={}){return Z(this.getCssData("--l10n-"+t,!0)||t,e)}constructor(){super(),this.activityType=null,this.addTemplateProcessor(Q),this.__l10nKeys=[]}applyL10nKey(t,e){let i="l10n:"+t;this.$[i]=e,this.__l10nKeys.push(t)}checkCtxTarget(t){return this.$["*ctxTargetsRegistry"]?.has(t)}setForCtxTarget(t,e,i){this.checkCtxTarget(t)&&(this.$[e]=i)}connectedCallback(){if(this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){L.getCtx(this.ctxName).store={}}super.connectedCallback()}initCallback(){this.$["*ctxTargetsRegistry"]?.add(this.constructor.is)}fileSizeFmt(t,e=2){let i=["B","KB","MB","GB","TB"],s=t=>this.getCssData("--l10n-unit-"+t.toLowerCase(),!0)||t;if(0===t)return`0 ${s(i[0])}`;let r=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/1024**n).toFixed(r))+" "+s(i[n])}proxyUrl(t){let e=this.getCssData("--cfg-secure-delivery-proxy",!0);return e?Z(e,{previewUrl:t},{transform:t=>window.encodeURIComponent(t)}):t}static reg(t){t?super.reg(t.startsWith("lr-")?t:"lr-"+t):super.reg()}}const rt="active",nt="___ACTIVITY_IS_ACTIVE___";class at extends st{ctxInit=et;initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",(t=>{this.setAttribute("current-activity",t)})),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(t=>{let e=this.ctxName+this.activityType,i=at._activityRegistry[e];if(this.activityType!==t&&this[nt])this[nt]=!1,this.removeAttribute(rt),i?.deactivateCallback?.();else if(this.activityType===t&&!this[nt]){this[nt]=!0,this.setAttribute(rt,""),i?.activateCallback?.();let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),t.push(this.activityType),this.$["*history"]=t)}})))}static _activityRegistry=Object.create(null);get isActivityActive(){return this[nt]}registerActivity(t,e,i){at._activityRegistry||(at._activityRegistry=Object.create(null));let s=this.ctxName+t;at._activityRegistry[s]={activateCallback:e,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let t=this.$["*history"];if(t){t.pop();let e=t.pop();this.$["*currentActivity"]=e,this.$["*history"]=t}}}at.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});const ot=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"];class lt extends Error{constructor(t,e,i,s,r){super(),this.name="UploadClientError",this.message=t,this.code=e,this.request=i,this.response=s,this.headers=r,Object.setPrototypeOf(this,lt.prototype)}}const ct=(t="Request canceled")=>{const e=new lt(t);return e.isCancel=!0,e},ht=(t,e)=>{t&&(t.aborted?Promise.resolve().then(e):t.addEventListener("abort",(()=>e()),{once:!0}))},dt=({method:t,url:e,data:i,headers:s={},signal:r,onProgress:n})=>new Promise(((a,o)=>{const l=new XMLHttpRequest,c=t?.toUpperCase()||"GET";let h=!1;l.open(c,e),s&&Object.entries(s).forEach((t=>{const[e,i]=t;void 0!==i&&!Array.isArray(i)&&l.setRequestHeader(e,i)})),l.responseType="text",ht(r,(()=>{h=!0,l.abort(),o(ct())})),l.onload=()=>{if(200!=l.status)o(new Error(`Error ${l.status}: ${l.statusText}`));else{const t={method:c,url:e,data:i,headers:s||void 0,signal:r,onProgress:n},o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),h={};o.forEach((function(t){const e=t.split(": "),i=e.shift(),s=e.join(": ");i&&void 0!==i&&(h[i]=s)}));const d=l.response,u=l.status;a({request:t,data:d,headers:h,status:u})}},l.onerror=()=>{h||o(new Error("Network error"))},n&&"function"==typeof n&&(l.upload.onprogress=t=>{t.lengthComputable?n({isComputable:!0,value:t.loaded/t.total}):n({isComputable:!1})}),i?l.send(i):l.send()}));const ut=function(t){return t};const pt=t=>void 0!==t&&("undefined"!=typeof Blob&&t instanceof Blob||"undefined"!=typeof File&&t instanceof File||"undefined"!=typeof Buffer&&t instanceof Buffer),mt=t=>{const e=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!pt(t)&&e.test(t)},gt=t=>{const e=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!pt(t)&&e.test(t)};function ft(t,e,i){if((s=i)&&"object"==typeof s&&"data"in s&&pt(s.data)){const{name:s,contentType:r}=i,n=ut(i.data),a=(({name:t})=>t?[t]:[])({name:s,contentType:r});t.push([e,n,...a])}else if((t=>!!t&&"object"==typeof t&&!Array.isArray(t))(i))for(const[s,r]of Object.entries(i))void 0!==r&&t.push([`${e}[${s}]`,String(r)]);else(t=>"string"==typeof t||"number"==typeof t||void 0===t)(i)&&i&&t.push([e,i.toString()]);var s}function bt(t){const e=new FormData,i=function(t){const e=[];for(const[i,s]of Object.entries(t))ft(e,i,s);return e}(t);for(const t of i){const[i,s,...r]=t;e.append(i,s,...r)}return e}const _t=(t,e,i)=>{const s=new URL(t);return s.pathname=e,i&&(s.search=(t=>{const e=new URLSearchParams;for(const[i,s]of Object.entries(t))s&&"object"==typeof s&&!Array.isArray(s)?Object.entries(s).filter((t=>t[1]??!1)).forEach((t=>e.set(`${i}[${t[0]}]`,String(t[1])))):Array.isArray(s)?s.forEach((t=>{e.append(`${i}[]`,t)})):"string"==typeof s&&s?e.set(i,s):"number"==typeof s&&e.set(i,s.toString());return e.toString()})(i)),s.toString()},vt="https://ucarecdn.com",yt="https://upload.uploadcare.com",wt=1,Ct=26214400,xt=5242880,$t=4,Tt=3,At="79ae88bd931ea68464d9",kt="original";function Et(t){return"[object Object]"===Object.prototype.toString.call(t)}const St=/\W|_/g;function It(t){return t.split(St).map(((t,e)=>t.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+t.slice(1))).join("")}function Ut(t,{ignoreKeys:e}={ignoreKeys:[]}){return Array.isArray(t)?t.map((t=>Rt(t,{ignoreKeys:e}))):t}function Rt(t,{ignoreKeys:e}={ignoreKeys:[]}){if(Array.isArray(t))return Ut(t,{ignoreKeys:e});if(!Et(t))return t;const i={};for(const s of Object.keys(t)){let r=t[s];e.includes(s)?i[s]=r:(Et(r)?r=Rt(r,{ignoreKeys:e}):Array.isArray(r)&&(r=Ut(r,{ignoreKeys:e})),i[It(s)]=r)}return i}function Lt({libraryName:t,libraryVersion:e,userAgent:i,publicKey:s="",integration:r=""}){const n="JavaScript";if("string"==typeof i)return i;if("function"==typeof i)return i({publicKey:s,libraryName:t,libraryVersion:e,languageName:n,integration:r});return`${[t,e,s].filter(Boolean).join("/")} (${[n,r].filter(Boolean).join("; ")})`}const Pt={factor:2,time:100};function Mt(t,e=Pt){let i=0;return function t(s){const r=Math.round(e.time*e.factor**i);return s({attempt:i,retry:e=>(t=>new Promise((e=>setTimeout(e,t))))(e??r).then((()=>(i+=1,t(s))))})}(t)}function Ot(t){return Lt({libraryName:"UploadcareUploadClient",libraryVersion:"4.3.0",...t})}function Dt(t,e){return Mt((({attempt:i,retry:s})=>t().catch((t=>{if("response"in t&&"RequestThrottledError"===t?.code&&i<e)return s(function(t){const{headers:e}=t||{};return e&&1e3*Number.parseInt(e["x-throttle-wait-seconds"])||15e3}(t));throw t}))))}function Nt(t){return void 0===t?"auto":t?"1":"0"}var Bt,Vt;!function(t){t.Token="token",t.FileInfo="file_info"}(Bt||(Bt={})),function(t){t.Unknown="unknown",t.Waiting="waiting",t.Progress="progress",t.Error="error",t.Success="success"}(Vt||(Vt={}));function zt(t,{publicKey:e,baseURL:i=yt,signal:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a=wt}={}){return Dt((()=>dt({method:"GET",headers:e?{"X-UC-User-Agent":Ot({publicKey:e,integration:r,userAgent:n})}:void 0,url:_t(i,"/from_url/status/",{jsonerrors:1,token:t}),signal:s}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s&&!(t=>"status"in t&&t.status===Vt.Error)(s))throw new lt(s.error.content,void 0,i,s,e);return s}))),a)}function Ft(t,{publicKey:e,baseURL:i=yt,signal:s,source:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=wt}){return Dt((()=>dt({method:"GET",headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:n,userAgent:a})},url:_t(i,"/info/",{jsonerrors:1,pub_key:e,file_id:t,source:r}),signal:s}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s}))),o)}class jt{constructor(t,{baseCDN:e,fileName:i}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.s3Url=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null,this.contentInfo=null,this.metadata=null,this.s3Bucket=null;const{uuid:s,s3Bucket:r}=t,n=`${e}/${s}/`,a=r?`https://${r}.s3.amazonaws.com/${s}/${t.filename}`:null;this.uuid=s,this.name=i||t.filename,this.size=t.size,this.isStored=t.isStored,this.isImage=t.isImage,this.mimeType=t.mimeType,this.cdnUrl=n,this.originalFilename=t.originalFilename,this.imageInfo=t.imageInfo,this.videoInfo=t.videoInfo,this.contentInfo=t.contentInfo,this.metadata=t.metadata||null,this.s3Bucket=r||null,this.s3Url=a}}const Ht=({check:t,interval:e=500,signal:i})=>new Promise(((s,r)=>{let n;ht(i,(()=>{n&&clearTimeout(n),r(ct("Poll cancelled"))}));const a=()=>{try{Promise.resolve(t(i)).then((t=>{t?s(t):n=setTimeout(a,e)})).catch((t=>r(t)))}catch(t){r(t)}};n=setTimeout(a,0)}));function qt({file:t,publicKey:e,baseURL:i,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a,signal:o,onProgress:l}){return Ht({check:o=>Ft(t,{publicKey:e,baseURL:i,signal:o,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:a}).then((t=>t.isReady?t:(l&&l({isComputable:!0,value:1}),!1))),signal:o})}const Kt=(t,{publicKey:e,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,contentType:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,baseCDN:m,metadata:g})=>function(t,{publicKey:e,fileName:i,contentType:s,baseURL:r=yt,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=wt,metadata:m}){return Dt((()=>dt({method:"POST",url:_t(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:d,userAgent:u})},data:bt({file:{data:t,name:i??t.name??kt,contentType:s},UPLOADCARE_PUB_KEY:e,UPLOADCARE_STORE:Nt(o),signature:n,expire:a,source:h,metadata:m}),signal:l,onProgress:c}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s}))),p)}(t,{publicKey:e,fileName:i,contentType:o,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,metadata:g}).then((({file:t})=>qt({file:t,publicKey:e,baseURL:s,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((t=>new jt(t,{baseCDN:m}))),Xt=(t,{signal:e}={})=>{let i=null,s=null;const r=t.map((()=>new AbortController));return ht(e,(()=>{r.forEach((t=>t.abort()))})),Promise.all(t.map(((t,e)=>{const n=(t=>()=>{s=t,r.forEach(((e,i)=>i!==t&&e.abort()))})(e);return Promise.resolve().then((()=>t({stopRace:n,signal:r[e].signal}))).then((t=>(n(),t))).catch((t=>(i=t,null)))}))).then((t=>{if(null===s)throw i;return t[s]}))};var Wt=window.WebSocket;class Gt{constructor(){this.events=Object.create({})}emit(t,e){this.events[t]?.forEach((t=>t(e)))}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){this.events[t]=e?this.events[t].filter((t=>t!==e)):[]}}class Yt{constructor(t,e=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Gt,this.disconnectTimeoutId=null,this.key=t,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const t=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Wt(t),this.ws.addEventListener("error",(t=>{this.emmitter.emit("error",new Error(t.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((t=>this.send(t.event,t.data))),this.queue=[]})),this.ws.addEventListener("message",(t=>{const e=JSON.parse(t.data.toString());switch(e.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(e.channel,((t,e)=>"success"===t?{status:Vt.Success,...e}:"progress"===t?{status:Vt.Progress,...e}:{status:Vt.Error,...e})(e.event,JSON.parse(e.data)))}}))}}disconnect(){const t=()=>{this.ws?.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{t()}),this.disconnectTime):t()}send(t,e){const i=JSON.stringify({event:t,data:e});this.ws?.send(i)}subscribe(t,e){this.subscribers+=1,this.connect();const i=`task-status-${t}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,e),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(t){this.subscribers-=1;const e=`task-status-${t}`,i={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter((t=>t.data.channel!==e)),0===this.subscribers&&this.disconnect()}onError(t){return this.emmitter.on("error",t),()=>this.emmitter.off("error",t)}}let Jt=null;const Zt=t=>{if(!Jt){const e="undefined"==typeof window?0:3e4;Jt=new Yt(t,e)}return Jt};const Qt=(t,{publicKey:e,fileName:i,baseURL:s,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,onProgress:d,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:f=At,metadata:b})=>{return Promise.resolve((_=f,void Zt(_).connect())).then((()=>function(t,{publicKey:e,baseURL:i=yt,store:s,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=wt,metadata:m}){return Dt((()=>dt({method:"POST",headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:d,userAgent:u})},url:_t(i,"/from_url/",{jsonerrors:1,pub_key:e,source_url:t,store:Nt(s),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c,metadata:m}),signal:h}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s}))),p)}(t,{publicKey:e,fileName:i,baseURL:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,metadata:b}))).catch((t=>(Zt(f)?.disconnect(),Promise.reject(t)))).then((t=>t.type===Bt.FileInfo?t:Xt([({signal:i})=>function({token:t,publicKey:e,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,onProgress:a,signal:o}){return Ht({check:o=>zt(t,{publicKey:e,baseURL:i,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,signal:o}).then((e=>{switch(e.status){case Vt.Error:return new lt(e.error,e.errorCode);case Vt.Waiting:return!1;case Vt.Unknown:return new lt(`Token "${t}" was not found.`);case Vt.Progress:return a&&("unknown"===e.total?a({isComputable:!1}):a({isComputable:!0,value:e.done/e.total})),!1;case Vt.Success:return a&&a({isComputable:!0,value:e.done/e.total}),e;default:throw new Error("Unknown status")}})),signal:o})}({token:t.token,publicKey:e,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:i}),({signal:e})=>(({token:t,pusherKey:e,signal:i,onProgress:s})=>new Promise(((r,n)=>{const a=Zt(e),o=a.onError(n),l=()=>{o(),a.unsubscribe(t)};ht(i,(()=>{l(),n(ct("pusher cancelled"))})),a.subscribe(t,(t=>{switch(t.status){case Vt.Progress:s&&("unknown"===t.total?s({isComputable:!1}):s({isComputable:!0,value:t.done/t.total}));break;case Vt.Success:l(),s&&s({isComputable:!0,value:t.done/t.total}),r(t);break;case Vt.Error:l(),n(new lt(t.msg,t.error_code))}}))})))({token:t.token,pusherKey:f,signal:e,onProgress:d})],{signal:h}))).then((t=>{if(t instanceof lt)throw t;return t})).then((t=>qt({file:t.uuid,publicKey:e,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:h}))).then((t=>new jt(t,{baseCDN:r})));var _},te=t=>t.length||t.size;function ee(t,e,i){return s=>((t,e,i,s)=>{const r=s*e,n=Math.min(r+s,i);return t.slice(r,n)})(t,s,e,i)}const ie=(t,e,{publicKey:i,onProgress:s,signal:r,integration:n,multipartMaxAttempts:a})=>Mt((({attempt:o,retry:l})=>function(t,e,{signal:i,onProgress:s}){return dt({method:"PUT",url:e,data:t,onProgress:s,signal:i}).then((t=>(s&&s({isComputable:!0,value:1}),t))).then((({status:t})=>({code:t})))}(t,e,{publicKey:i,onProgress:s,signal:r,integration:n}).catch((t=>{if(o<a)return l();throw t})))),se=(t,{publicKey:e,fileName:i,fileSize:s,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,contentType:m,multipartChunkSize:g=xt,maxConcurrentRequests:f=$t,multipartMaxAttempts:b=Tt,baseCDN:_,metadata:v})=>{const y=s||te(t);let w;const C=(t,e)=>{if(!c)return;w||(w=Array(t).fill(0));return i=>{var s;i.isComputable&&(w[e]=i.value,c({isComputable:!0,value:(s=w,s.reduce(((t,e)=>t+e),0)/t)}))}};return function(t,{publicKey:e,contentType:i,fileName:s,multipartChunkSize:r=xt,baseURL:n="",secureSignature:a,secureExpire:o,store:l,signal:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=wt,metadata:m}){return Dt((()=>dt({method:"POST",url:_t(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:d,userAgent:u})},data:bt({filename:s??kt,size:t,content_type:i??"application/octet-stream",part_size:r,UPLOADCARE_STORE:Nt(l),UPLOADCARE_PUB_KEY:e,signature:a,expire:o,source:h,metadata:m}),signal:c}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s.parts=Object.keys(s.parts).map((t=>s.parts[t])),s}))),p)}(y,{publicKey:e,contentType:m,fileName:i??t.name,baseURL:r,secureSignature:n,secureExpire:a,store:o,signal:l,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,metadata:v}).then((({uuid:i,parts:s})=>{const r=ee(t,y,g);return Promise.all([i,(n=f,a=s.map(((t,i)=>()=>ie(r(i),t,{publicKey:e,onProgress:C(s.length,i),signal:l,integration:d,multipartMaxAttempts:b}))),new Promise(((t,e)=>{const i=[];let s=!1,r=a.length;const o=[...a],l=()=>{const n=a.length-o.length,c=o.shift();c&&c().then((e=>{s||(i[n]=e,r-=1,r?l():t(i))})).catch((t=>{s=!0,e(t)}))};for(let t=0;t<n;t++)l()})))]);var n,a})).then((([t])=>function(t,{publicKey:e,baseURL:i=yt,source:s="local",signal:r,integration:n,userAgent:a,retryThrottledRequestMaxTimes:o=wt}){return Dt((()=>dt({method:"POST",url:_t(i,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:n,userAgent:a})},data:bt({uuid:t,UPLOADCARE_PUB_KEY:e,source:s}),signal:r}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s}))),o)}(t,{publicKey:e,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p}))).then((t=>t.isReady?t:qt({file:t.uuid,publicKey:e,baseURL:r,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((t=>new jt(t,{baseCDN:_})))};function re(t,{publicKey:e,fileName:i,baseURL:s=yt,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartMinFileSize:m,multipartChunkSize:g,multipartMaxAttempts:f,maxConcurrentRequests:b,baseCDN:_=vt,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y,pusherKey:w,metadata:C}){if(pt(t)){return((t,e=Ct)=>t>=e)(te(t),m)?se(t,{publicKey:e,contentType:p,multipartChunkSize:g,multipartMaxAttempts:f,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,maxConcurrentRequests:b,retryThrottledRequestMaxTimes:u,baseCDN:_,metadata:C}):Kt(t,{publicKey:e,fileName:i,contentType:p,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:_,metadata:C})}if(gt(t))return Qt(t,{publicKey:e,fileName:i,baseURL:s,baseCDN:_,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,pusherKey:w,metadata:C});if(mt(t))return((t,{publicKey:e,fileName:i,baseURL:s,signal:r,onProgress:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,baseCDN:h})=>Ft(t,{publicKey:e,baseURL:s,signal:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c}).then((t=>new jt(t,{baseCDN:h,fileName:i}))).then((t=>(n&&n({isComputable:!0,value:1}),t))))(t,{publicKey:e,fileName:i,baseURL:s,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:_});throw new TypeError(`File uploading from "${t}" is not supported`)}class ne{constructor(t,e){this.storedAt=null,this.uuid=t.id,this.filesCount=t.filesCount,this.totalSize=Object.values(t.files).reduce(((t,e)=>t+e.size),0),this.isStored=!!t.datetimeStored,this.isImage=!!Object.values(t.files).filter((t=>t.isImage)).length,this.cdnUrl=t.cdnUrl,this.files=e,this.createdAt=t.datetimeCreated,this.storedAt=t.datetimeStored}}function ae(t,{publicKey:e,fileName:i,baseURL:s=yt,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartChunkSize:m=xt,baseCDN:g=vt,jsonpCallback:f}){if(!(t=>{for(const e of t)if(!pt(e))return!1;return!0})(t)&&!(t=>{for(const e of t)if(!gt(e))return!1;return!0})(t)&&!(t=>{for(const e of t)if(!mt(e))return!1;return!0})(t))throw new TypeError(`Group uploading from "${t}" is not supported`);let b,_=!0;const v=t.length,y=(t,e)=>{if(!l)return;b||(b=Array(t).fill(0));return i=>{if(!i.isComputable||!_)return _=!1,void l({isComputable:!1});var s;b[e]=i.value,l({isComputable:!0,value:(s=b,s.reduce(((t,e)=>t+e))/t)})}};return Promise.all(t.map(((t,l)=>re(t,{publicKey:e,fileName:i,baseURL:s,secureSignature:r,secureExpire:n,store:a,signal:o,onProgress:y(v,l),source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartChunkSize:m,baseCDN:g})))).then((t=>function(t,{publicKey:e,baseURL:i=yt,jsonpCallback:s,secureSignature:r,secureExpire:n,signal:a,source:o,integration:l,userAgent:c,retryThrottledRequestMaxTimes:h=wt}){return Dt((()=>dt({method:"POST",headers:{"X-UC-User-Agent":Ot({publicKey:e,integration:l,userAgent:c})},url:_t(i,"/group/",{jsonerrors:1,pub_key:e,files:t,callback:s,signature:r,expire:n,source:o}),signal:a}).then((({data:t,headers:e,request:i})=>{const s=Rt(JSON.parse(t));if("error"in s)throw new lt(s.error.content,s.error.errorCode,i,s,e);return s}))),h)}(t.map((t=>t.uuid)),{publicKey:e,baseURL:s,jsonpCallback:f,secureSignature:r,secureExpire:n,signal:o,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u}).then((e=>new ne(e,t))).then((t=>(l&&l({isComputable:!0,value:1}),t)))))}const oe=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:Error,value:null,nullable:!0},uploadErrorMsg:{type:String,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:jt,value:null},isUploading:{type:Boolean,value:!1}});function le(t){return Lt({...t,libraryName:"lr-blocks",libraryVersion:"0.8.0"})}const ce="[Typed State] Wrong property name: ";class he{constructor(t,e){this.__typedSchema=t,this.__ctxId=e||D.generate(),this.__schema=Object.keys(t).reduce(((e,i)=>(e[i]=t[i].value,e)),{}),this.__data=L.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(t,e){if(!this.__typedSchema.hasOwnProperty(t))return void console.warn(ce+t);let i=this.__typedSchema[t];e?.constructor===i.type||i.nullable&&null===e?this.__data.pub(t,e):console.warn("[Typed State] Wrong property type: "+t)}setMultipleValues(t){for(let e in t)this.setValue(e,t[e])}getValue(t){if(this.__typedSchema.hasOwnProperty(t))return this.__data.read(t);console.warn(ce+t)}subscribe(t,e){return this.__data.sub(t,e)}remove(){L.deleteCtx(this.__ctxId)}}class de{constructor(t){this.__typedSchema=t.typedSchema,this.__ctxId=t.ctxName||D.generate(),this.__data=L.registerCtx({},this.__ctxId),this.__watchList=t.watchList||[],this.__handler=t.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let e=Object.create(null);this.__notifyObservers=(t,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[t]||(e[t]=new Set),e[t].add(i),this.__observeTimeout=window.setTimeout((()=>{this.__observers.forEach((t=>{t({...e})})),e=Object.create(null)}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{this.__handler?.([...this.__items])}))}add(t){let e=new he(this.__typedSchema);for(let i in t)e.setValue(i,t[i]);return this.__data.add(e.uid,e),this.__watchList.forEach((t=>{this.__subsMap[e.uid]||(this.__subsMap[e.uid]=[]),this.__subsMap[e.uid].push(e.subscribe(t,(()=>{this.__notifyObservers(t,e.uid)})))})),this.__items.add(e.uid),this.notify(),e}read(t){return this.__data.read(t)}readProp(t,e){return this.read(t).getValue(e)}publishProp(t,e,i){this.read(t).setValue(e,i)}remove(t){this.__items.delete(t),this.notify(),this.__data.pub(t,null),delete this.__subsMap[t]}clearAll(){this.__items.forEach((t=>{this.remove(t)}))}observe(t){this.__observers.add(t)}unobserve(t){this.__observers.delete(t)}findItems(t){let e=[];return this.__items.forEach((i=>{let s=this.read(i);t(s)&&e.push(i)})),e}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){L.deleteCtx(this.__data),this.__observers=null;for(let t in this.__subsMap)this.__subsMap[t].forEach((t=>{t.remove()})),delete this.__subsMap[t]}}const ue={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT"};class pe{constructor(t){this.ctx=t.ctx,this.type=t.type,this.data=t.data}}class me{static eName(t){return"LR_"+t}static _timeoutStore=Object.create(null);static emit(t,e=window,i=!0){let s=()=>{e.dispatchEvent(new CustomEvent(this.eName(t.type),{detail:t}))};if(!i)return void s();let r=t.type+t.ctx;this._timeoutStore[r]&&window.clearTimeout(this._timeoutStore[r]),this._timeoutStore[r]=window.setTimeout((()=>{s(),delete this._timeoutStore[r]}),20)}}class ge extends at{ctxInit=it;__initialUploadMetadata=null;setUploadMetadata(t){this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}initCallback(){super.initCallback(),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFiles(t){t.forEach((t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})}))}openSystemDialog(){let t=((...t)=>t.filter((t=>"string"==typeof t&&t)).join(","))(this.getCssData("--cfg-img-only")&&ot.join(","),this.getCssData("--cfg-accept"));this.getCssData("--cfg-accept")&&this.getCssData("--cfg-img-only")&&console.warn("There could be a mistake.\nBoth `--cfg-accept` and `--cfg-img-only` parameters are set.\nThe value of `--cfg-accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.getCssData("--cfg-multiple"),this.fileInput.accept=t,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=at.activities.UPLOAD_LIST,this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=null;return this.getCssData("--cfg-source-list")&&(t=this.getCssData("--cfg-source-list").split(",").map((t=>t.trim()))),t}initFlow(t=!1){if(this.$["*uploadList"]?.length&&!t)this.set$({"*currentActivity":at.activities.UPLOAD_LIST}),this.setForCtxTarget("lr-modal","*modalActive",!0);else if(1===this.sourceList?.length){let t=this.sourceList[0];"local"===t?(this.$["*currentActivity"]=at.activities.UPLOAD_LIST,this?.openSystemDialog()):(Object.values(Block.extSrcList).includes(t)?this.set$({"*currentActivityParams":{externalSourceType:t},"*currentActivity":at.activities.EXTERNAL}):this.$["*currentActivity"]=t,this.setForCtxTarget("lr-modal","*modalActive",!0))}else this.set$({"*currentActivity":at.activities.START_FROM}),this.setForCtxTarget("lr-modal","*modalActive",!0)}cancelFlow(){1===this.sourceList?.length?(this.$["*currentActivity"]=null,this.setForCtxTarget("lr-modal","*modalActive",!1)):(this.historyBack(),this.$["*currentActivity"]||this.setForCtxTarget("lr-modal","*modalActive",!1))}get uploadCollection(){if(!this.has("*uploadCollection")){let t=new de({typedSchema:oe,watchList:["uploadProgress","uuid","uploadErrorMsg","validationErrorMsg","cdnUrlModifiers"],handler:t=>{this.$["*uploadList"]=t.map((t=>({uid:t})))}});t.observe((e=>{if(e.uploadProgress){let e=0,i=t.findItems((t=>!t.getValue("uploadError")));i.forEach((i=>{e+=t.readProp(i,"uploadProgress")}));let s=Math.round(e/i.length);this.$["*commonProgress"]=s,me.emit(new pe({type:ue.UPLOAD_PROGRESS,ctx:this.ctxName,data:s}),void 0,100===s)}if(e.uuid){let e=t.findItems((t=>!!t.getValue("uuid"))),i=t.findItems((t=>!!t.getValue("uploadErrorMsg")||!!t.getValue("validationErrorMsg")));if(t.size-i.length===e.length){let t=this.getOutputData((t=>!!t.getValue("uuid")));me.emit(new pe({type:ue.UPLOAD_FINISH,ctx:this.ctxName,data:t}))}}if(e.uploadErrorMsg){t.findItems((t=>!!t.getValue("uploadErrorMsg"))).forEach((e=>{me.emit(new pe({type:ue.UPLOAD_ERROR,ctx:this.ctxName,data:t.readProp(e,"uploadErrorMsg")}),void 0,!1)}))}if(e.validationErrorMsg){t.findItems((t=>!!t.getValue("validationErrorMsg"))).forEach((e=>{me.emit(new pe({type:ue.VALIDATION_ERROR,ctx:this.ctxName,data:t.readProp(e,"validationErrorMsg")}),void 0,!1)}))}if(e.cdnUrlModifiers){t.findItems((t=>!!t.getValue("cdnUrlModifiers"))).forEach((e=>{me.emit(new pe({type:ue.CDN_MODIFICATION,ctx:this.ctxName,data:t.readProp(e,"cdnUrlModifiers")}),void 0,!1)}))}})),this.add("*uploadCollection",t)}return this.$["*uploadCollection"]}getUploadClientOptions(){let t={},e=this.getCssData("--cfg-store");null!==e&&(t.store=!!e);let i={...t,publicKey:this.getCssData("--cfg-pubkey"),baseCDN:this.getCssData("--cfg-cdn-cname"),baseURL:this.getCssData("--cfg-base-url"),userAgent:le,integration:this.getCssData("--cfg-user-agent-integration"),secureSignature:this.getCssData("--cfg-secure-signature"),secureExpire:this.getCssData("--cfg-secure-expire"),retryThrottledRequestMaxTimes:this.getCssData("--cfg-retry-throttled-request-max-times"),multipartMinFileSize:this.getCssData("--cfg-multipart-min-file-size"),multipartChunkSize:this.getCssData("--cfg-multipart-chunk-size"),maxConcurrentRequests:this.getCssData("--cfg-max-concurrent-requests"),multipartMaxAttempts:this.getCssData("--cfg-multipart-max-attempts"),checkForUrlDuplicates:!!this.getCssData("--cfg-check-for-url-duplicates"),saveUrlForRecurrentUploads:!!this.getCssData("--cfg-save-url-for-recurrent-uploads"),metadata:this.$["*uploadMetadata"]};return console.log("Upload client options:",i),i}getOutputData(t){let e=[];return this.uploadCollection.findItems(t).forEach((t=>{let i=L.getCtx(t).store,s=i.fileInfo||{name:i.fileName,fileSize:i.fileSize,isImage:i.isImage,mimeType:i.mimeType},r={...s,cdnUrlModifiers:i.cdnUrlModifiers,cdnUrl:i.cdnUrl||s.cdnUrl};e.push(r)})),e}}ge.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...ge.extSrcList}),ge.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),Object.keys(ue).forEach((t=>{let e=me.eName(t);window.addEventListener(e,(t=>{if([ue.UPLOAD_FINISH,ue.REMOVE].includes(t.detail.type)){let e=L.getCtx(t.detail.ctx),i=e.read("uploadCollection"),s=[];i.items().forEach((t=>{let e=L.getCtx(t).store,i=e.fileInfo;if(i){let t={...i,cdnUrlModifiers:e.cdnUrlModifiers,cdnUrl:e.cdnUrl||i.cdnUrl};s.push(t)}})),me.emit(new pe({type:ue.DATA_OUTPUT,ctx:t.detail.ctx,data:s})),e.pub("outputData",s)}}))}));class fe extends st{init$={...this.ctxInit,name:"",path:"",size:"24",viewBox:""};initCallback(){super.initCallback(),this.sub("name",(t=>{if(!t)return;let e=this.getCssData(`--icon-${t}`);e&&(this.$.path=e)})),this.sub("path",(t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path d="${t}"></path>`)})),this.sub("size",(t=>{this.$.viewBox=`0 0 ${t} ${t}`}))}}fe.template='\n<svg\n  ref="svg"\n  xmlns="http://www.w3.org/2000/svg"\n  set="@viewBox: viewBox; @height: size; @width: size">\n</svg>\n',fe.bindAttributes({name:"name",size:"size"});const be=(...t)=>t.filter((t=>"string"==typeof t&&t)).map((t=>(t=>{if("string"!=typeof t||!t)return"";let e=t.trim();return e.startsWith("-/")?e=e.slice(2):e.startsWith("/")&&(e=e.slice(1)),e.endsWith("/")&&(e=e.slice(0,e.length-1)),e})(t))).join("/-/"),_e=(...t)=>{let e=be(...t);return e?`-/${e}/`:""};function ve(t){let e=new URL(t),i=e.pathname+e.search+e.hash,s=i.lastIndexOf("http"),r=i.lastIndexOf("/"),n="";return s>=0?n=i.slice(s):r>=0&&(n=i.slice(r+1)),n}function ye(t){return t.startsWith("http")}function we(t){let e=new URL(t);return{pathname:e.origin+e.pathname||"",search:e.search||"",hash:e.hash||""}}const Ce=(t,e,i)=>{let s=new URL(function(t){let e=new URL(t),i=ve(t),s=ye(i)?we(i).pathname:i;return e.pathname=e.pathname.replace(s,""),e.search="",e.hash="",e.toString()}(t));if(i=i||ve(t),s.pathname.startsWith("//")&&(s.pathname=s.pathname.replace("//","/")),ye(i)){let t=we(i);s.pathname=s.pathname+(e||"")+(t.pathname||""),s.search=t.search,s.hash=t.hash}else s.pathname=s.pathname+(e||"")+(i||"");return s.toString()},xe=(t,e)=>{let i=new URL(t);return i.pathname=e+"/",i.toString()},$e=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}}),Te="--lr-img-",Ae="unresolved",ke=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Ee=Object.create(null);for(let t in $e)Ee[Te+t]=$e[t]?.default||"";class Se extends K{cssInit$=Ee;$$(t){return this.$[Te+t]}set$$(t){for(let e in t)this.$[Te+e]=t[e]}sub$$(t,e){this.sub(Te+t,(t=>{null!==t&&""!==t&&e(t)}))}_fmtAbs(t){return!t.includes("//")&&!ke&&(t=new URL(t,document.baseURI).href),t}_getCdnModifiers(t=""){return _e(t&&`resize/${t}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||$e.format.default}`,`quality/${this.$$("quality")||$e.quality.default}`)}_getUrlBase(t=""){if(ke&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let e=this._getCdnModifiers(t);return this.$$("cdn-cname")&&this.$$("uuid")?this._proxyUrl(Ce(xe(this.$$("cdn-cname"),this.$$("uuid")),e)):this.$$("uuid")?this._proxyUrl(Ce(xe(this.$$["cdn-cname"]||"https://ucarecdn.com",this.$$("uuid")),e)):this.$$("proxy-cname")?this._proxyUrl(Ce(this.$$("proxy-cname"),e,this._fmtAbs(this.$$("src")))):this.$$("pubkey")?this._proxyUrl(Ce(`https://${this.$$("pubkey")}.ucr.io/`,e,this._fmtAbs(this.$$("src")))):void 0}_proxyUrl(t){return this.$$("secure-delivery-proxy")?Z(this.$$("secure-delivery-proxy"),{previewUrl:t},{transform:t=>window.encodeURIComponent(t)}):t}_getElSize(t,e=1,i=!0){let s=t.getBoundingClientRect(),r=e*Math.round(s.width),n=i?"":e*Math.round(s.height);return r||n?`${r||""}x${n||""}`:null}_setupEventProxy(t){let e=t=>{t.stopPropagation();let e=new Event(t.type,t);this.dispatchEvent(e)},i=["load","error"];for(let s of i)t.addEventListener(s,e)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(Ae,""),this.img.onload=()=>{this.img.removeAttribute(Ae)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach((t=>{$e[t.name]||this.img.setAttribute(t.name,t.value)}))}get breakpoints(){if(this.$$("breakpoints")){let t=new Set;return this.$$("breakpoints").split(",").forEach((e=>{t.add(parseFloat(e.trim()))})),t}return null}renderBg(t){let e=new Set;this.breakpoints?this.breakpoints.forEach((t=>{e.add(`url("${this._getUrlBase(t+"x")}") ${t}w`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(2*t+"x")}") ${2*t}w`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(3*t+"x")}") ${3*t}w`)})):(e.add(`url("${this._getUrlBase(this._getElSize(t))}") 1x`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,2))}") 2x`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,3))}") 3x`));let i=`image-set(${[...e].join(", ")})`;t.style.setProperty("background-image",i),t.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let t=new Set;return this.breakpoints?this.breakpoints.forEach((e=>{t.add(this._getUrlBase(e+"x")+` ${e}w`),this.$$("hi-res-support")&&t.add(this._getUrlBase(2*e+"x")+` ${2*e}w`),this.$$("ultra-res-support")&&t.add(this._getUrlBase(3*e+"x")+` ${3*e}w`)})):(t.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&t.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&t.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...t].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach((t=>{this.$$("intersection")?this.initIntersection(t,(()=>{this.renderBg(t)})):this.renderBg(t)})):this.$$("intersection")?this.initIntersection(this.img,(()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()})):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(t,e){this._isnObserver=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(e(),this._isnObserver.unobserve(t))}))}),{root:null,rootMargin:"0px"}),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach((t=>{this._isnObserver.unobserve(t)})),this._isnObserver=null)}static get observedAttributes(){return Object.keys($e)}attributeChangedCallback(t,e,i){window.setTimeout((()=>{this.$[Te+t]=i}))}}class Ie extends ge{init$={...this.ctxInit,"*simpleButtonText":"",onClick:()=>{this.initFlow()}};initCallback(){super.initCallback(),this.bindCssData("--cfg-multiple"),this.sub("--cfg-multiple",(t=>{this.$["*simpleButtonText"]=t?this.l10n("upload-files"):this.l10n("upload-file")}))}}Ie.template='\n<lr-drop-area>\n  <button type="button" set="onclick: onClick">\n    <lr-icon name="upload"></lr-icon>\n    <span>{{*simpleButtonText}}</span>\n    <slot></slot>\n  </button>\n</lr-drop-area>\n';function Ue(t){return new Promise((e=>{"function"!=typeof window.FileReader&&e(!1);try{let i=new FileReader;i.onerror=()=>{e(!0)};let s=t=>{"loadend"!==t.type&&i.abort(),e(!1)};i.onloadend=s,i.onprogress=s,i.readAsDataURL(t)}catch(t){e(!1)}}))}function Re(t){return new Promise(((e,i)=>{let s=0,r=[],n=t=>{t||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),t.isFile?(s++,t.file((t=>{s--,r.push(t),0===s&&e(r)}))):t.isDirectory&&a(t.createReader())},a=t=>{s++,t.readEntries((t=>{s--;for(let e of t)n(e);0===s&&e(r)}))};n(t)}))}let Le=null;const Pe={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let Me=["dragleave","dragexit","dragend","drop","mouseleave","mouseout"],Oe=new Map;function De(t){let e=new Set,i=t=>e.add(t),s=Pe.INACTIVE,r=t=>{s!==t&&e.forEach((e=>e(t))),s=t},n=t=>{let{clientX:e,clientY:i}=t,s=document.body.getBoundingClientRect(),n="drop"===t.type,a=["dragleave","dragexit","dragend"].includes(t.type)&&0===e&&0===i,o=["mouseleave","mouseout"].includes(t.type)&&(e<0||e>s.width||i<0||i>s.height);(n||a||o)&&r(Pe.INACTIVE),t.preventDefault()};i((e=>t.onChange(e))),i((t=>{t===Pe.ACTIVE&&Me.forEach((t=>{window.addEventListener(t,n,!1)}))})),i((t=>{t===Pe.INACTIVE&&Me.forEach((t=>{window.removeEventListener(t,n,!1)}))}));let a=e=>{e.preventDefault(),s===Pe.INACTIVE&&r(Pe.ACTIVE);let i=[e.x,e.y],n=t.element.getBoundingClientRect(),a=Math.floor(function(t,e){let i=Math.max(Math.min(t[0],e.x+e.width),e.x),s=Math.max(Math.min(t[1],e.y+e.height),e.y);return Math.sqrt((t[0]-i)*(t[0]-i)+(t[1]-s)*(t[1]-s))}(i,n)),o=a<100,l=e.composedPath().includes(t.element);Oe.set(t.element,a);let c=Math.min(...Oe.values())===a;r(l&&c?Pe.OVER:o&&c?Pe.NEAR:Pe.ACTIVE)};window.addEventListener("dragover",a,!1);let o=async e=>{if(e.preventDefault(),Le)return t.onImgElement.bind(t.element)(Le),Le=null,void r(Pe.INACTIVE);let i=await function(t){let e=[],i=[];for(let s=0;s<t.items.length;s++){let r=t.items[s];if(r&&"file"===r.kind){if("function"==typeof r.webkitGetAsEntry||"function"==typeof r.getAsEntry){let t="function"==typeof r.webkitGetAsEntry?r.webkitGetAsEntry():r.getAsEntry();i.push(Re(t).then((t=>{e.push(...t)})));continue}let t=r.getAsFile();i.push(Ue(t).then((i=>{i||e.push(t)})))}}return Promise.all(i).then((()=>e))}(e.dataTransfer);t.onFiles(i),r(Pe.INACTIVE)};return t.element.addEventListener("drop",o),window.addEventListener("dragstart",(t=>{Le=t.target.constructor===HTMLImageElement?t.target.src:null})),()=>{Oe.delete(t.element),window.removeEventListener("dragover",a,!1),t.element.removeEventListener("drop",o),Me.forEach((t=>{window.removeEventListener(t,n,!1),Le=null}))}}class Ne{caption="";text="";iconName="";isError=!1}class Be extends st{init$={...this.ctxInit,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}};initCallback(){super.initCallback(),this.sub("*message",(t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption||"",msgTxt:t.text||"",iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")}))}}Be.template='\n<div class="heading">\n  <lr-icon set="@name: iconName"></lr-icon>\n  <div class="caption">{{captionTxt}}</div>\n  <button type="button" set="onclick: onClose">\n    <lr-icon name="close"></lr-icon>\n  </button>\n</div>\n<div class="msg">{{msgTxt}}</div>\n';class Ve extends ge{_registeredTypes={};init$={...this.ctxInit,iconName:"default"};initTypes(){this.registerType({type:ge.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:ge.sourceTypes.URL,activity:at.activities.URL,textKey:"from-url"}),this.registerType({type:ge.sourceTypes.CAMERA,activity:at.activities.CAMERA}),this.registerType({type:"draw",activity:at.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(ge.extSrcList))this.registerType({type:t,activity:at.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",(t=>{t&&this.applyType(t)}))}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){const e=this._registeredTypes[t];if(!e)return void console.warn("Unsupported source type: "+t);const{textKey:i=t,icon:s=t,activity:r,onClick:n,activityParams:a={}}=e;this.applyL10nKey("src-type",`src-type-${i}`),this.$.iconName=s,this.onclick=t=>{r&&this.set$({"*currentActivityParams":a,"*currentActivity":r}),n&&n(t)}}}Ve.template='\n<lr-icon set="@name: iconName"></lr-icon>\n<div class="txt" l10n="src-type"></div>\n',Ve.bindAttributes({type:null});function ze(t){let e=new Blob([t],{type:"image/svg+xml"});return URL.createObjectURL(e)}function Fe(t="hsl(0, 0%, 100%)",e=36,i=36){return ze(`\n  <svg width="${e}" height="${i}" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z" fill="black" fill-opacity="0.06"/>\n    <path d="M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z" fill="black" fill-opacity="0.06"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="${t}"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="url(#paint0_linear_2735_2136)"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z" fill="url(#paint1_radial_2735_2136)"/>\n    <path d="M21 8L26 13V14H20V8H21Z" fill="black" fill-opacity="0.03"/>\n    <path d="M21 8L26 13V13.5H20.5V8H21Z" fill="black" fill-opacity="0.08"/>\n    <path d="M21 8L26 13H21V8Z" fill="${t}"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint2_linear_2735_2136)"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint3_linear_2735_2136)"/>\n    <path d="M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z" fill="url(#paint4_linear_2735_2136)"/>\n    <defs>\n      <linearGradient id="paint0_linear_2735_2136" x1="18" y1="8" x2="18" y2="28.0027" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.06"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n      <radialGradient id="paint1_radial_2735_2136" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10 11) rotate(53.7462) scale(18.6011 18.0323)">\n        <stop stop-color="white" stop-opacity="0.12"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </radialGradient>\n      <linearGradient id="paint2_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop offset="0.40625" stop-opacity="0"/>\n        <stop offset="1" stop-opacity="0.04"/>\n      </linearGradient>\n      <linearGradient id="paint3_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.16"/>\n        <stop offset="1" stop-color="white" stop-opacity="0.06"/>\n      </linearGradient>\n      <linearGradient id="paint4_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.15"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n    </defs>\n</svg>\n  `)}class je extends ge{pauseRender=!0;init$={...this.ctxInit,uid:"",itemName:"",thumb:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,notImage:!0,badgeIcon:"check","*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this.entry,"*currentActivity":at.activities.DETAILS})},onRemove:()=>{let t=this.entry.getValue("uuid");if(t){let e=this.getOutputData((e=>e.getValue("uuid")===t));me.emit(new pe({type:ue.REMOVE,ctx:this.ctxName,data:e}))}this.uploadCollection.remove(this.uid)},onUpload:()=>{this.upload()}};_observerCallback(t){let[e]=t;e.isIntersecting&&!this.innerHTML&&(this.render(),this._observer?.unobserve(this)),0===e.intersectionRatio?(clearTimeout(this._thumbTimeoutId),this._thumbTimeoutId=void 0):this._thumbTimeoutId||(this._thumbTimeoutId=window.setTimeout((()=>this._generateThumbnail()),100))}_generateThumbnail(){if(!this.$.thumbUrl)if(this.file?.type.includes("image"))(function(t,e=40){let i=document.createElement("canvas"),s=i.getContext("2d"),r=new Image,n=new Promise(((t,n)=>{r.onload=()=>{let n=r.height/r.width;n>1?(i.width=e,i.height=e*n):(i.height=e,i.width=e/n),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(r,0,0,i.width,i.height),i.toBlob((e=>{let i=URL.createObjectURL(e);t(i)}),"image/png")},r.onerror=t=>{console.warn("Resize error..."),n(t)}}));return r.src=URL.createObjectURL(t),n})(this.file,this.getCssData("--cfg-thumb-size")||76).then((t=>{this.$.thumbUrl=`url(${t})`}));else{let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");this.$.thumbUrl=`url(${Fe(t)})`}}_revokeThumbUrl(){this.$.thumbUrl?.startsWith("blob:")&&URL.revokeObjectURL(this.$.thumbUrl)}_showMessage(t,e,i){let s=new Ne;s.caption=e,s.text=i,s.isError="error"===t,this.set$({badgeIcon:`badge-${t}`,"*message":s})}initCallback(){super.initCallback(),this.sub("uid",(t=>{t&&t!==this.uid&&(this.uid=t,this.entry=this.uploadCollection?.read(t),this.entry&&(this.entry.subscribe("validationErrorMsg",(t=>{if(!t)return;this.setAttribute("error","");let e=this.l10n("validation-error")+": "+(this.file?.name||this.externalUrl);this._showMessage("error",e,t)})),this.entry.subscribe("uploadErrorMsg",(t=>{if(!t)return;let e=this.l10n("upload-error")+": "+(this.file?.name||this.externalUrl);this._showMessage("error",e,t)})),this.entry.subscribe("isUploading",(t=>{this.$.progressVisible=t})),this.entry.subscribe("uploadProgress",(t=>{this.$.progressValue=t})),this.entry.subscribe("fileName",(t=>{this.$.itemName=t||this.externalUrl||this.l10n("file-no-name")})),this.entry.subscribe("fileSize",(t=>{let e=this.getCssData("--cfg-max-local-file-size-bytes");e&&t&&t>e&&this.entry.setValue("validationErrorMsg",this.l10n("files-max-size-limit-error",{maxFileSize:e}))})),this.entry.subscribe("externalUrl",(t=>{this.$.itemName=this.entry.getValue("fileName")||t||this.l10n("file-no-name")})),this.entry.subscribe("uuid",(t=>{if(t&&(this.setAttribute("loaded",""),this.entry.getValue("isImage"))){this._revokeThumbUrl();let e=this.getCssData("--cfg-thumb-size")||76,i=this.proxyUrl(Ce(xe(this.getCssData("--cfg-cdn-cname"),t),_e(`scale_crop/${e}x${e}/center`)));this.$.thumbUrl=`url(${i})`}})),this.entry.subscribe("cdnUrl",(t=>{if(t&&this.entry.getValue("isImage")){this._revokeThumbUrl();let e=this.getCssData("--cfg-thumb-size")||76,i=this.proxyUrl(Ce(t,_e(`scale_crop/${e}x${e}/center`)));this.$.thumbUrl=`url(${i})`}})),this.file=this.entry.getValue("file"),this.externalUrl=this.entry.getValue("externalUrl"),this.getCssData("--cfg-confirm-upload")||this.upload(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)))})),this.onclick=()=>{je.activeInstances.forEach((t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")}))},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",(t=>{t&&this.isConnected&&this.upload()})),je.activeInstances.add(this)}destroyCallback(){super.destroyCallback(),je.activeInstances.delete(this),this._observer?.disconnect(),clearTimeout(this._thumbTimeoutId)}async upload(){if(this.hasAttribute("loaded")||this.entry.getValue("uuid"))return;let t=this.getOutputData((t=>!t.getValue("uuid")));me.emit(new pe({type:ue.UPLOAD_START,ctx:this.ctxName,data:t})),this.entry.setValue("isUploading",!0),this.entry.setValue("uploadError",null),this.removeAttribute("focused"),this.removeAttribute("error"),this.setAttribute("uploading",""),!this.file&&this.externalUrl&&(this.$.progressUnknown=!0);try{let t=await re(this.file||this.externalUrl,{...this.getUploadClientOptions(),fileName:this.entry.getValue("fileName"),onProgress:t=>{if(t.isComputable){let e=100*t.value;this.entry.setValue("uploadProgress",e)}this.$.progressUnknown=!t.isComputable}});this.entry.setValue("isUploading",!1),this.setAttribute("loaded",""),this.removeAttribute("uploading"),this.$.badgeIcon="badge-success",this.entry.setMultipleValues({fileInfo:t,uploadProgress:100,fileName:t.name,fileSize:t.size,isImage:t.isImage,mimeType:t.mimeType,uuid:t.uuid,cdnUrl:t.cdnUrl})}catch(t){this.$.badgeIcon="badge-error",this.entry.setValue("isUploading",!1),this.$.progressValue=0,this.setAttribute("error",""),this.removeAttribute("uploading"),this.entry.setValue("uploadProgress",0),this.entry.setValue("uploadErrorMsg",t?.toString()||"Upload error")}}}je.template='\n<div\n  class="thumb"\n  set="style.backgroundImage: thumbUrl">\n  <div class="badge">\n    <lr-icon set="@name: badgeIcon"></lr-icon>\n  </div>\n</div>\n<div class="file-name-wrapper">\n  <span class="file-name" set="@title: itemName">{{itemName}}</span>\n</div>\n<button type="button" class="edit-btn" set="onclick: onEdit;">\n  <lr-icon name="edit-file"></lr-icon>\n</button>\n<button type="button" class="remove-btn" set="onclick: onRemove;">\n  <lr-icon name="remove-file"></lr-icon>\n</button>\n<button type="button" class="upload-btn" set="onclick: onUpload;">\n  <lr-icon name="upload"></lr-icon>\n</button>\n<lr-progress-bar\n  class="progress-bar"\n  set="value: progressValue; visible: progressVisible; unknown: progressUnknown">\n</lr-progress-bar>\n',je.activeInstances=new Set;class He extends st{init$={...this.ctxInit,"*modalActive":!1,"*modalHeaderHidden":!1,closeClicked:()=>{this.set$({"*modalActive":!1,"*currentActivity":""})}};initCallback(){super.initCallback(),this.sub("*modalActive",(t=>{t?this.setAttribute("active",""):this.removeAttribute("active"),t&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null})),this.getCssData("--cfg-modal-backdrop-strokes")&&(this.style.backgroundImage=`url(${function(t="rgba(0, 0, 0, .1)"){return ze(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n    <line x1="0" y1="10" x2="10" y2="0" stroke="${t}" />\n  </svg>`)}()})`)}}He.template='\n<div class="dialog">\n  <div class="heading" set="@hidden: *modalHeaderHidden">\n    <slot name="heading"></slot>\n    <button\n      type="button"\n      class="close-btn"\n      set="onclick: closeClicked">\n      <lr-icon name="close"></lr-icon>\n    </button>\n  </div>\n  <div class="content">\n    <slot></slot>\n  </div>\n</div>\n';class qe{captionL10nStr="confirm-your-action";messageL10Str="are-you-sure";confirmL10nStr="yes";denyL10nStr="no";confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class Ke extends at{activityType=at.activities.CONFIRMATION;_defaults=new qe;init$={...this.ctxInit,messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)};initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",(t=>{t&&this.set$({"*modalHeaderHidden":!0,"*currentActivity":at.activities.CONFIRMATION,"*activityCaption":this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,t.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,t.confirmAction()}})}))}}Ke.template='\n<div class="message">{{messageTxt}}</div>\n<div class="toolbar">\n  <button\n    type="button"\n    class="deny-btn secondary-btn"\n    set="onclick: onDeny">{{denyBtnTxt}}</button>\n  <button\n    type="button"\n    class="confirm-btn primary-btn"\n    set="onclick: onConfirm">{{confirmBtnTxt}}</button>\n</div>\n';class Xe extends ge{activityType=at.activities.UPLOAD_LIST;init$={...this.ctxInit,doneBtnHidden:!1,doneBtnDisabled:!1,uploadBtnHidden:!1,uploadBtnDisabled:!1,addMoreBtnHidden:!1,addMoreBtnDisabled:!1,hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.set$({uploadBtnHidden:!1,doneBtnHidden:!0,uploadBtnDisabled:!0,"*uploadTrigger":{}})},onDone:()=>{this.set$({"*currentActivity":this.doneActivity||""}),this.setForCtxTarget("lr-modal","*modalActive",!1)},onCancel:()=>{let t=new qe;t.confirmAction=()=>{let t=this.getOutputData((t=>!!t.getValue("uuid")));me.emit(new pe({type:ue.REMOVE,ctx:this.ctxName,data:t})),this.cancelFlow(),this.uploadCollection.clearAll()},t.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=t}};cssInit$={"--cfg-show-empty-list":0,"--cfg-multiple":1,"--cfg-multiple-min":0,"--cfg-multiple-max":0,"--cfg-confirm-upload":1,"--cfg-source-list":""};_renderMap=Object.create(null);_validateFilesCount(){let t=!!this.getCssData("--cfg-multiple"),e=t?this.getCssData("--cfg-multiple-min")??0:1,i=t?this.getCssData("--cfg-multiple-max")??0:1,s=this.uploadCollection.size,r=!!e&&s<e,n=!!i&&s>i;return{passed:!r&&!n,tooFew:r,tooMany:n,min:e,max:i,exact:i===s}}_updateCountLimitMessage(){let t=this.uploadCollection.size,e=this._validateFilesCount();if(t&&!e.passed){let i=new Ne,s=e.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";i.caption=this.l10n("files-count-limit-error-title"),i.text=this.l10n(s,{min:e.min,max:e.max,total:t}),i.isError=!0,this.set$({"*message":i})}}_handleCollectionUpdate(){this._updateUploadsState(),this._updateCountLimitMessage()}_updateUploadsState(){let t=this.uploadCollection.items(),e={total:t.length,uploaded:0,uploading:0,validationFailed:0};for(let i of t){let t=this.uploadCollection.read(i);t.getValue("uuid")?e.uploaded+=1:t.getValue("isUploading")&&(e.uploading+=1),t.getValue("validationErrorMsg")&&(e.validationFailed+=1)}let i=e.total===e.uploaded,{passed:s,tooMany:r,exact:n}=this._validateFilesCount(),a=0===e.validationFailed;this.set$({doneBtnHidden:!i,doneBtnDisabled:!s||!a,uploadBtnHidden:i,uploadBtnDisabled:e.uploading>0||!s||!a,addMoreBtnDisabled:r||n,addMoreBtnHidden:n&&!this.getCssData("--cfg-multiple")}),!this.getCssData("--cfg-confirm-upload")&&s&&i&&this.$.onDone()}initCallback(){super.initCallback(),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("selected"),"*activityIcon":"local"})})),this.sub("--cfg-multiple",(()=>this._handleCollectionUpdate())),this.sub("--cfg-multiple-min",(()=>this._handleCollectionUpdate())),this.sub("--cfg-multiple-max",(()=>this._handleCollectionUpdate())),this.uploadCollection.observe((()=>{this._handleCollectionUpdate()})),this.sub("*uploadList",(t=>{0!==t?.length||this.getCssData("--cfg-show-empty-list")?(this._handleCollectionUpdate(),this.set$({hasFiles:t.length>0}),this.setForCtxTarget("lr-modal","*modalActive",!0)):this.cancelFlow()}))}}Xe.template='\n<div class="no-files" set="@hidden: hasFiles">\n  <slot name="empty"><span l10n="no-files"></span></slot>\n</div>\n\n<div \n  class="files" \n  repeat="*uploadList"\n  repeat-item-tag="lr-file-item"></div>\n\n<div class="toolbar">\n  <button\n    type="button"\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel;"\n    l10n="clear"></button>\n  <div class="toolbar-spacer"></div>\n  <button\n    type="button"\n    class="add-more-btn secondary-btn"\n    set="onclick: onAdd; @disabled: addMoreBtnDisabled; @hidden: addMoreBtnHidden"\n    l10n="add-more"></button>\n  <button\n    type="button"\n    class="upload-btn primary-btn"\n    set="@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled"\n    l10n="upload"></button>\n  <button\n    type="button"\n    class="done-btn primary-btn"\n    set="@hidden: doneBtnHidden; onclick: onDone;  @disabled: doneBtnDisabled"\n    l10n="done"></button>\n</div>\n';class We extends ge{activityType=at.activities.URL;init$={...this.ctxInit,importDisabled:!0,onUpload:()=>{let t=this.ref.input.value;this.uploadCollection.add({externalUrl:t}),this.$["*currentActivity"]=at.activities.UPLOAD_LIST},onCancel:()=>{this.cancelFlow()},onInput:t=>{let e=t.target.value;this.set$({importDisabled:!e})}};initCallback(){super.initCallback(),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("caption-from-url"),"*activityIcon":"url"})}))}}We.template='\n<input placeholder="https://..." .url-input type="text" ref="input" set="oninput: onInput"/>\n<button\n  type="button"\n  class="url-upload-btn primary-btn"\n  set="onclick: onUpload; @disabled: importDisabled">\n</button>\n<button\n  type="button"\n  class="cancel-btn secondary-btn"\n  set="onclick: onCancel"\n  l10n="cancel">\n</button>\n';const Ge=()=>void 0!==navigator.permissions;class Ye extends ge{activityType=at.activities.CAMERA;_unsubPermissions=null;init$={...this.ctxInit,video:null,videoTransformCss:null,shotBtnDisabled:!1,videoHidden:!1,messageHidden:!0,requestBtnHidden:Ge(),l10nMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:t=>{this._selectedCameraId=t.target.value,this._capture()},onCancel:()=>{this.cancelFlow()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}};cssInit$={"--cfg-camera-mirror":1};_onActivate=()=>{this.set$({"*activityCaption":this.l10n("caption-camera"),"*activityIcon":"camera"}),Ge()&&this._subscribePermissions(),this._capture()};_onDeactivate=()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()};_handlePermissionsChange=()=>{this._capture()};_setPermissionsState=function(t,e){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>t(...s)),e)};return s.cancel=()=>{clearTimeout(i)},s}((t=>{"granted"===t?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):"prompt"===t?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())}),300);async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(t){console.log("Failed to use permissions API. Fallback to manual request mode.",t),this._capture()}}async _capture(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(t.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let e=await navigator.mediaDevices.getUserMedia(t);e.addEventListener("inactive",(()=>{this._setPermissionsState("denied")})),this.$.video=e,this._capturing=!0,this._setPermissionsState("granted")}catch(t){this._setPermissionsState("denied")}}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),e=`camera-${t}.png`;this._canvas.toBlob((i=>{let s=new File([i],e,{lastModified:t,type:"image/png"});this.uploadCollection.add({file:s,fileName:e,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":at.activities.UPLOAD_LIST})}))}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,this._onActivate,this._onDeactivate),this.sub("--cfg-camera-mirror",(t=>{this.$.videoTransformCss=t?"scaleX(-1)":null}));let t=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"videoinput"===t.kind)).map(((t,e)=>({text:t.label.trim()||`${this.l10n("caption-camera")} ${e+1}`,value:t.deviceId})));t.length>1&&(this.$.cameraSelectOptions=t,this.$.cameraSelectHidden=!1)}}Ye.template='\n<div class="content">\n  <video\n    autoplay\n    playsinline\n    set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"\n    ref="video">\n  </video>\n  <div class="message-box" set="@hidden: messageHidden">\n    <span>{{l10nMessage}}</span>\n    <button type="button" set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request"></button>\n  </div>\n</div>\n\n<div class="toolbar">\n  <button\n    type="button"\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <lr-select \n    set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange">\n  </lr-select>\n  <button\n    type="button"\n    class="shot-btn primary-btn"\n    set="onclick: onShot; @disabled: shotBtnDisabled"\n    l10n="camera-shot">\n  </button>\n</div>\n';class Je extends ge{activityType=at.activities.DETAILS;pauseRender=!0;init$={...this.ctxInit,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=at.activities.CLOUD_IMG_EDIT)}};cssInit$={"--cfg-use-cloud-image-editor":0,"--cfg-use-local-image-editor":0};showNonImageThumb(){let t=Fe(window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),108,108);this.eCanvas.setImageUrl(t),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("caption-edit-file")})})),this.eCanvas=this.ref.canvas,this.sub("*focusedEntry",(t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach((t=>{this._entrySubs.delete(t),t.remove()})):this._entrySubs=new Set,this.entry=t;let e=t.getValue("file");if(this.eCanvas.clear(),e){this._file=e;let i=this._file.type.includes("image");i&&!t.getValue("cdnUrl")&&(this.eCanvas.setImageFile(this._file),this.set$({checkerboard:!0})),i||this.showNonImageThumb()}let i=(t,e)=>{this._entrySubs.add(this.entry.subscribe(t,e))};i("fileName",(t=>{this.$.fileName=t,this.$.onNameInput=()=>{let t=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:t}),this.entry.setValue("fileName",t)}})),i("fileSize",(t=>{this.$.fileSize=Number.isFinite(t)?this.fileSizeFmt(t):this.l10n("file-size-unknown")})),i("uploadError",(t=>{this.$.errorTxt=t?.message})),i("externalUrl",(t=>{t&&(this.entry.getValue("uuid")||this.showNonImageThumb())})),i("cdnUrl",(t=>{const e=this.$["--cfg-use-cloud-image-editor"]&&t&&this.entry.getValue("isImage");if(this.eCanvas.clear(),this.set$({cdnUrl:t,cloudEditBtnHidden:!e}),t&&this.entry.getValue("isImage")){let e=Ce(t,_e("format/auto","preview"));this.eCanvas.setImageUrl(this.proxyUrl(e))}}))}))}}Je.template='\n<lr-tabs\n  tab-list="tab-view, tab-details">\n\n  <div\n    tab-ctx="tab-details"\n    class="details">\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="file-name"></div>\n      <input\n        name="name-input"\n        ref="file_name_input"\n        set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl"\n        type="text" />\n    </div>\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="file-size"></div>\n      <div>{{fileSize}}</div>\n    </div>\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="cdn-url"></div>\n      <a\n        class="cdn-link"\n        target="_blank"\n        set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a>\n    </div>\n\n    <div>{{errorTxt}}</div>\n\n  </div>\n\n  <lr-editable-canvas\n    tab-ctx="tab-view"\n    set="@disabled: !--cfg-use-local-image-editor; @checkerboard: checkerboard;"\n    ref="canvas">\n  </lr-editable-canvas>\n</lr-tabs>\n\n<div class="toolbar" set="@edit-disabled: cloudEditBtnHidden">\n  <button\n    type="button"\n    class="edit-btn secondary-btn"\n    set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;">\n    <lr-icon name="edit"></lr-icon>\n    <span l10n="edit-image"></span>\n  </button>\n  <button\n    type="button"\n    class="remove-btn secondary-btn"\n    set="onclick: onRemove">\n    <lr-icon name="remove"></lr-icon>\n    <span l10n="remove-from-list"></span>\n  </button>\n  <div></div>\n  <button\n    type="button"\n    class="back-btn primary-btn"\n    set="onclick: onBack">\n    <span l10n="ok"></span>\n  </button>\n</div>\n';class Ze extends ge{init$={...this.ctxInit,visible:!1,unknown:!1,value:0,"*commonProgress":0};initCallback(){super.initCallback(),this.uploadCollection.observe((()=>{let t=this.uploadCollection.items().some((t=>this.uploadCollection.read(t).getValue("isUploading")));this.$.visible=t})),this.sub("visible",(t=>{t?this.setAttribute("active",""):this.removeAttribute("active")})),this.sub("*commonProgress",(t=>{this.$.value=t}))}}Ze.template='\n<lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>\n';class Qe extends st{_value=0;_unknownMode=!1;init$={...this.ctxInit,width:0,opacity:0};initCallback(){super.initCallback(),this.defineAccessor("value",(t=>{void 0!==t&&(this._value=t,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))})),this.defineAccessor("visible",(t=>{this.ref.line.classList.toggle("progress--hidden",!t)})),this.defineAccessor("unknown",(t=>{this._unknownMode=t,this.ref.line.classList.toggle("progress--unknown",t)}))}}Qe.template='\n<div\n  ref="line"\n  class="progress">\n</div>\n';class ti extends st{init$={...this.ctxInit,refMap:null,disabled:!0,toolbarHidden:!0,checkerboard:!1};constructor(){super(),X(this,{display:"flex",justifyContent:"center",alignItems:"center"})}initCallback(){super.initCallback(),this.sub("disabled",(()=>{this.$.toolbarHidden=this.hasAttribute("disabled")&&"false"!==this.getAttribute("disabled")})),this.sub("checkerboard",(()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${function(t="#fff",e="rgba(0, 0, 0, .1)"){return ze(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="0" y="0" width="20" height="20" fill="${t}" />\n    <rect x="0" y="0" width="10" height="10" fill="${e}" />\n    <rect x="10" y="10" width="10" height="10" fill="${e}" />\n  </svg>`)}()})`:"unset"})),this.canvas=this.ref.cvs,this.canvCtx=this.canvas.getContext("2d"),this.$.refMap={parent:this,canvas:this.canvas,canvCtx:this.canvCtx,svg:this.ref.svg,svgGroup:this.ref.svg_g,svgImg:this.ref.svg_img}}setImage(t){t.height&&t.width?(this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)):(this.clear(),t.onload=()=>{this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)})}setImageFile(t){let e=new Image,i=URL.createObjectURL(t);e.src=i,this.setImage(e)}setImageUrl(t){let e=new Image;e.src=t,this.setImage(e)}clear(){this.canvCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}}function ei(...t){return t.reduce(((t,e)=>{if("string"==typeof e)return t[e]=!0,t;for(let i of Object.keys(e))t[i]=e[i];return t}),{})}function ii(...t){let e=ei(...t);return Object.keys(e).reduce(((t,i)=>(e[i]&&t.push(i),t)),[]).join(" ")}function si(t,e){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>t(...s)),e)};return s.cancel=()=>{clearTimeout(i)},s}ti.template='\n<canvas class="img-view" ref="cvs"></canvas>\n<svg class="img-view" xmlns="http://www.w3.org/2000/svg" ref="svg">\n  <g ref="svg_g">\n    <image ref="svg_img" x="0" y="0"></image>\n  </g>\n</svg>\n<editable-canvas-toolbar\n  set="refMap: refMap; @hidden: toolbarHidden">\n</editable-canvas-toolbar>\n',ti.bindAttributes({disabled:"disabled",checkerboard:"checkerboard"});const ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function ni(t){let e=new Image;return{promise:new Promise(((i,s)=>{e.src=t,e.onload=i,e.onerror=s})),image:e,cancel:()=>{0===e.naturalWidth&&(e.src=ri)}}}function ai(t){let e=[];for(let i of t){let t=ni(i);e.push(t)}let i=e.map((t=>t.image));return{promise:Promise.allSettled(e.map((t=>t.promise))),images:i,cancel:()=>{e.forEach((t=>{t.cancel()}))}}}const oi={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};const li=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function ci(t){return be(...li.filter((e=>void 0!==t[e]&&null!==t[e])).map((e=>function(t,e){if("number"==typeof e)return oi[t]!==e?`${t}/${e}`:"";if("boolean"==typeof e)return e&&oi[t]!==e?`${t}`:"";if("filter"===t){if(!e||oi[t]===e.amount)return"";let{name:i,amount:s}=e;return`${t}/${i}/${s}`}if("crop"===t){if(!e)return"";let{dimensions:i,coords:s}=e;return`${t}/${i.join("x")}/${s.join(",")}`}return""}(e,t[e]))).filter((t=>!!t)))}const hi=be("format/auto","progressive/yes");function di(t){return{"*originalUrl":null,"*tabId":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:ri,fileType:"",showLoader:!1,uuid:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=t.querySelectorAll("img");for(let t of e){let e=t.src;t.src=ri,t.src=e}t.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let i=t.$["*originalUrl"],s=_e(ci(e)),r={originalUrl:i,cdnUrlModifiers:s,cdnUrl:Ce(i,_e(s,"preview")),transformations:e};t.dispatchEvent(new CustomEvent("apply",{detail:r})),t.remove()},"*on.cancel":()=>{t.remove(),t.dispatchEvent(new CustomEvent("cancel"))}}}const ui=`\n<div class="wrapper wrapper_desktop">\n  <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">\n    <div class="network_problems_content">\n      <div class="network_problems_icon">\n        <lr-icon size="20" name="sad"></lr-icon>\n      </div>\n      <div class="network_problems_text">\n        Network error\n      </div>\n    </div>\n    <div class="network_problems_footer">\n      <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>\n    </div>\n  </lr-presence-toggle>\n  <div class="viewport">\n    <div class="file_type_outer">\n      <div class="file_type">{{fileType}}</div>\n    </div>\n    <div class="image_container" ref="img-container-el">\n      <img src="${ri}" class="image image_visible_from_editor" ref="img-el">\n      <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>\n      <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>\n    </div>\n    <div class="info_pan">{{msg}}</div>\n  </div>\n  <div class="toolbar">\n    <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n    <div class="toolbar_content toolbar_content__editor">\n      <lr-editor-toolbar></lr-editor-toolbar>\n    </div>\n  </div>\n</div>\n`,pi="crop",mi="sliders",gi="filters",fi=[pi,mi,gi],bi=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],_i=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],vi=["rotate","mirror","flip"],yi={brightness:{zero:oi.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:oi.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:oi.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:oi.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:oi.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:oi.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:oi.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:oi.enhance,range:[0,100],keypointsNumber:1},filter:{zero:oi.filter,range:[0,100],keypointsNumber:1}};function wi(t,e,i){let s=window.devicePixelRatio,r=Math.min(Math.ceil(e*s),3e3),n=s>=2?"lightest":"normal";return Ce(t,_e(hi,ci(i),`quality/${n}`,`stretch/off/-/resize/${r}x`))}class Ci extends st{get ctxName(){return this.autoCtxName}init$={...this.ctxInit,...di(this)};_debouncedShowLoader=si(this._showLoader.bind(this),300);_showLoader(t){this.$.showLoader=t}_loadImageFromCdn(){this._debouncedShowLoader(!0);let t=this._imageSrc(),{promise:e,cancel:i}=ni(t);e.then((()=>{this.$.src=t})).catch((e=>{this.$["*networkProblems"]=!0,this._debouncedShowLoader(!1),this.$.src=t})),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=i}_imageSrc(){let{width:t}=this.ref["img-container-el"].getBoundingClientRect();return this.proxyUrl(wi(this.$["*originalUrl"],t,{}))}_waitForSize(){return new Promise(((t,e)=>{let i=Date.now(),s=()=>{if(!this.isConnected)return clearInterval(r),void e();if(Date.now()-i>300)return clearInterval(r),void e(new Error("[cloud-image-editor] timout waiting for non-zero container size"));let{width:s,height:n}=this.getBoundingClientRect();s>0&&n>0&&(clearInterval(r),t())},r=setInterval(s,50);s()}))}cssInit$={"--cfg-cdn-cname":"https://ucarecdn.com"};async initCallback(){this.$["*originalUrl"]=xe(this.localCtx.read("--cfg-cdn-cname"),this.$.uuid),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.classList.add("editor_ON"),this.sub("*networkProblems",(t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t})),this.ref["img-el"].addEventListener("load",(t=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==ri&&(this.$["*networkProblems"]=!1)})),this.ref["img-el"].addEventListener("error",(t=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0})),this.sub("src",(t=>{let e=this.ref["img-el"];e.src!==t&&(this._imgLoading=!0,e.src=t||ri)})),this.sub("*tabId",(t=>{this.ref["img-el"].className=ii("image",{image_hidden_to_cropper:t===pi,image_hidden_effects:t!==pi})}));try{fetch(Ce(this.$["*originalUrl"],_e("json"))).then((t=>t.json())).then((({width:t,height:e})=>{this.$["*imageSize"]={width:t,height:e}})),await this._waitForSize(),this._loadImageFromCdn()}catch(t){t&&console.error("Failed to load image info",t)}}}Ci.template=ui,Ci.bindAttributes({uuid:"uuid"});const xi=1.5,$i=100/3,Ti=82;function Ai(t,e){for(let i in e)t.setAttributeNS(null,i,e[i].toString())}function ki(t,e={}){let i=document.createElementNS("http://www.w3.org/2000/svg",t);return Ai(i,e),i}function Ei(t,e){let{x:i,y:s,width:r,height:n}=t,a=e.includes("w")?0:1,o=e.includes("n")?0:1,l=[-1,1][a],c=[-1,1][o],h=[i+a*r+xi*l,s+o*n+xi*c-24*c],d=[i+a*r+xi*l,s+o*n+xi*c],u=[i+a*r-24*l+xi*l,s+o*n+xi*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,center:d}}function Si(t,e){let i,s,{x:r,y:n,width:a,height:o}=t,l=["n","s"].includes(e)?.5:{w:0,e:1}[e],c=["w","e"].includes(e)?.5:{n:0,s:1}[e],h=[-1,1][l],d=[-1,1][c];return["n","s"].includes(e)?(i=[r+l*a-17,n+c*o+xi*d],s=[r+l*a+17,n+c*o+xi*d]):(i=[r+l*a+xi*h,n+c*o-17],s=[r+l*a+xi*h,n+c*o+17]),{d:`M ${i[0]} ${i[1]} L ${s[0]} ${s[1]}`,center:[s[0]-(s[0]-i[0])/2,s[1]-(s[1]-i[1])/2]}}function Ii(t,e){let{x:i}=t,{y:s}=t;return t.x<e.x?i=e.x:t.x+t.width>e.x+e.width&&(i=e.x+e.width-t.width),t.y<e.y?s=e.y:t.y+t.height>e.y+e.height&&(s=e.y+e.height-t.height),{...t,x:i,y:s}}function Ui(t,[e,i],s){let{x:r,y:n,width:a,height:o}=t;if(s.includes("n")){let t=o;o=Math.max(i,o),n=n+t-o}if(s.includes("s")&&(o=Math.max(i,o)),s.includes("w")){let t=a;a=Math.max(e,a),r=r+t-a}return s.includes("e")&&(a=Math.max(e,a)),{x:r,y:n,width:a,height:o}}class Ri extends st{init$={...this.ctxInit,dragging:!1};constructor(){super(),this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(t){let e=this.$["*imageBox"];if(!e)return;if(""===t&&e.height<=Ti&&e.width<=Ti)return!0;let i=e.height<=Ti&&(t.includes("n")||t.includes("s")),s=e.width<=Ti&&(t.includes("e")||t.includes("w"));return i||s}_createBackdrop(){let t=this.$["*cropBox"];if(!t)return;let{x:e,y:i,width:s,height:r}=t,n=this.ref["svg-el"],a=ki("mask",{id:"backdrop-mask"}),o=ki("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),l=ki("rect",{x:e,y:i,width:s,height:r,fill:"black"});a.appendChild(o),a.appendChild(l);let c=ki("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(c),n.appendChild(a),this._backdropMask=a,this._backdropMaskInner=l}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame((()=>{this._backdropMask.style.display="block"})))}_updateBackdrop(){let t=this.$["*cropBox"];if(!t)return;let{x:e,y:i,width:s,height:r}=t;Ai(this._backdropMaskInner,{x:e,y:i,width:s,height:r})}_updateFrame(){let t=this.$["*cropBox"];if(t){for(let e of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:r,groupNode:n}=e,a=""===i,o=2===i.length;if(a){let{x:e,y:i,width:s,height:n}=t,a=[e+s/2,i+n/2];Ai(r,{r:Math.min(s,n)/3,cx:a[0],cy:a[1]})}else{let{d:e,center:n}=o?Ei(t,i):Si(t,i);Ai(r,{cx:n[0],cy:n[1]}),Ai(s,{d:e})}let l=this._shouldThumbBeDisabled(i);n.setAttribute("class",ii("thumb",{"thumb--hidden":l,"thumb--visible":!l}))}Ai(this._frameGuides,{x:t.x-.5,y:t.y-.5,width:t.width+1,height:t.height+1})}}_createThumbs(){let t={};for(let e=0;e<3;e++)for(let i=0;i<3;i++){let s=`${["n","","s"][e]}${["w","","e"][i]}`,r=ki("g");r.classList.add("thumb"),r.setAttribute("with-effects","");let n=ki("circle",{r:25.5,fill:"transparent"}),a=ki("path",{stroke:"currentColor",fill:"none","stroke-width":3});r.appendChild(a),r.appendChild(n),t[s]={direction:s,pathNode:a,interactionNode:n,groupNode:r},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return t}_createGuides(){let t=ki("svg"),e=ki("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});t.appendChild(e);for(let e=1;e<=2;e++){let i=ki("line",{x1:$i*e+"%",y1:"0%",x2:$i*e+"%",y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});t.appendChild(i)}for(let e=1;e<=2;e++){let i=ki("line",{x1:"0%",y1:$i*e+"%",x2:"100%",y2:$i*e+"%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});t.appendChild(i)}return t.classList.add("guides","guides--semi-hidden"),t}_createFrame(){let t=this.ref["svg-el"],e=document.createDocumentFragment(),i=this._createGuides();e.appendChild(i);let s=this._createThumbs();for(let{groupNode:t}of Object.values(s))e.appendChild(t);t.appendChild(e),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(t,e){let i=this._frameThumbs[t];if(this._shouldThumbBeDisabled(t))return;let s=this.$["*cropBox"],{x:r,y:n}=this.ref["svg-el"].getBoundingClientRect(),a=e.x-r,o=e.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,o],this._dragStartCrop={...s}}_handlePointerUp_(t){this._updateCursor(),this.$.dragging&&(t.stopPropagation(),t.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(t){if(!this.$.dragging)return;t.stopPropagation(),t.preventDefault();let e=this.ref["svg-el"],{x:i,y:s}=e.getBoundingClientRect(),r=t.x-i,n=t.y-s,a=r-this._dragStartPoint[0],o=n-this._dragStartPoint[1],{direction:l}=this._draggingThumb,c=this.$["*imageBox"],h=this._dragStartCrop;""===l?(h=function(t,[e,i]){return{...t,x:t.x+e,y:t.y+i}}(h,[a,o]),h=Ii(h,c)):(h=function(t,[e,i],s){let{x:r,y:n,width:a,height:o}=t;return s.includes("n")&&(n+=i,o-=i),s.includes("s")&&(o+=i),s.includes("w")&&(r+=e,a-=e),s.includes("e")&&(a+=e),{x:r,y:n,width:a,height:o}}(h,[a,o],l),h=function(t,e){let i=Math.max(t.x,e.x),s=Math.min(t.x+t.width,e.x+e.width),r=Math.max(t.y,e.y);return{x:i,y:r,width:s-i,height:Math.min(t.y+t.height,e.y+e.height)-r}}(h,c)),h=Ui(h,[Math.min(c.width,Ti),Math.min(c.height,Ti)],l),Object.values(h).every((t=>Number.isFinite(t)&&t>=0))?this.$["*cropBox"]=h:console.error("CropFrame is trying to create invalid rectangle",{payload:h})}_handleSvgPointerMove_(t){let e=Object.values(this._frameThumbs).find((e=>{if(this._shouldThumbBeDisabled(e.direction))return!1;let i=e.groupNode.getBoundingClientRect(),s=function(t,[e,i]){return t.x<=e&&e<=t.x+t.width&&t.y<=i&&i<=t.y+t.height}({x:i.x,y:i.y,width:i.width,height:i.height},[t.x,t.y]);return s}));this._hoverThumb=e,this._updateCursor()}_updateCursor(){let t=this._hoverThumb;var e;this.ref["svg-el"].style.cursor=t?""===(e=t.direction)?"move":["e","w"].includes(e)?"ew-resize":["n","s"].includes(e)?"ns-resize":["nw","se"].includes(e)?"nwse-resize":"nesw-resize":"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(t){Object.values(this._frameThumbs).map((({groupNode:t})=>t)).forEach((e=>{e.setAttribute("class",ii("thumb",{"thumb--hidden":!t,"thumb--visible":t}))}))}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",(()=>{this._resizeBackdrop(),window.requestAnimationFrame((()=>{this._render()}))})),this.sub("*cropBox",(t=>{t&&(this._guidesHidden=t.height<=Ti||t.width<=Ti,window.requestAnimationFrame((()=>{this._render()})))})),this.sub("dragging",(t=>{this._frameGuides.setAttribute("class",ii({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&t,"guides--semi-hidden":!this._guidesHidden&&!t}))})),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}Ri.template="\n  <svg class='svg' ref='svg-el' xmlns=\"http://www.w3.org/2000/svg\">\n  </svg>\n";class Li extends st{init$={...this.ctxInit,active:!1,title:"",icon:"","on.click":null};initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.sub("title",(t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")})),this.sub("active",(t=>{this.className=ii({active:t,not_active:!t})})),this.sub("on.click",(t=>{this.onclick=t}))}}Li.template='\n  <div class="before"></div>\n  <lr-icon size="20" set="@name: icon;"></lr-icon>\n  <div class="title" ref="title-el">{{title}}</div>\n';class Pi extends Li{initCallback(){super.initCallback(),this.defineAccessor("operation",(t=>{t&&(this._operation=t,this.$.icon=t)})),this.$["on.click"]=t=>{let e=this.$["*cropperEl"].getValue(this._operation),i=function(t,e){return"rotate"===t?function(t){let e=t+90;return e=e>=360?0:e,e}(e):["mirror","flip"].includes(t)?!e:null}(this._operation,e);this.$["*cropperEl"].setValue(this._operation,i)}}}const Mi="filter",Oi="color_operation",Di="original";class Ni extends st{init$={...this.ctxInit,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}};setOperation(t,e){this._controlType="filter"===t?Mi:Oi,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=e,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===Di?void 0:this.$.value,filter:this._filter===Di?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:e}=yi[this._operation],[i,s]=t;this.$.min=i,this.$.max=s,this.$.zero=e;let r=this.$["*editorTransformations"][this._operation];if(this._controlType===Mi){let t=s;if(r){let{name:e,amount:i}=r;t=e===this._filter?i:s}this.$.value=t,this.$.defaultValue=t}if(this._controlType===Oi){let t=void 0!==r?r:e;this.$.value=t,this.$.defaultValue=t}}apply(){let t;t=this._controlType===Mi?this._filter===Di?null:{name:this._filter,amount:this.$.value}:this.$.value;let e={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=e}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",(t=>{this._originalUrl=t})),this.sub("value",(t=>{let e=`${this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=e}))}}Ni.template='\n<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"></lr-slider-ui>\n';class Bi extends Li{init$={...this.ctxInit,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null};_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),e=window.devicePixelRatio,i=Math.ceil(e*t),s=e>=2?"lightest":"normal",r={...this.$["*editorTransformations"]};return r[this._operation]=this._filter!==Di?{name:this._filter,amount:100}:void 0,Ce(this._originalUrl,_e(hi,ci(r),`quality/${s}`,`scale_crop/${i}x${i}/center`))}_observerCallback(t,e){if(t[0].isIntersecting){let t=this.proxyUrl(this._previewSrc()),i=this.ref["preview-el"],{promise:s,cancel:r}=ni(t);this._cancelPreload=r,s.catch((t=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:t})})).finally((()=>{i.style.backgroundImage=`url(${t})`,setTimeout((()=>{i.style.opacity="1"})),e.unobserve(this)}))}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",(t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===Di,this.$.icon=this.$.isOriginal?"original":"slider"})),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",(t=>{this.$.active=t&&t===this._filter})),this.sub("isOriginal",(t=>{this.$.iconSize=t?40:20})),this.sub("active",(t=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=t?"1":"0";let e=this.ref["preview-el"];t?e.style.opacity="0":e.style.backgroundImage&&(e.style.opacity="1")})),this.sub("*networkProblems",(t=>{if(!t){let t=this.proxyUrl(this._previewSrc()),e=this.ref["preview-el"];e.style.backgroundImage&&(e.style.backgroundImage="none",e.style.backgroundImage=`url(${t})`)}}))}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload&&this._cancelPreload()}}Bi.template='\n  <div class="before"></div>\n  <div class="preview" ref="preview-el"></div>\n  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>\n';class Vi extends Li{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",(t=>{t&&(this._operation=t,this.$.icon=t,this.$.title=this.l10n(t))})),this.sub("*editorTransformations",(t=>{if(!this._operation)return;let{zero:e}=yi[this._operation],i=t[this._operation],s=void 0!==i&&i!==e;this.$.active=s}))}}const zi=window.ResizeObserver;function Fi(t,e,i){return Math.min(Math.max(t,e),i)}function ji({width:t,height:e},i){let s=i/90%2!=0;return{width:s?e:t,height:s?t:e}}class Hi extends st{init$={...this.ctxInit,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}};constructor(){super(),this._commitDebounced=si(this._commit.bind(this),300),this._handleResizeDebounced=si(this._handleResize.bind(this),10)}_handleResize(){this._initCanvas(),this._alignImage(),this._alignCrop(),this._draw()}_syncTransformations(){let t=function(t,e){let i={};for(let s of e){let e=t[s];(t.hasOwnProperty(s)||void 0!==e)&&(i[s]=e)}return i}(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),e={...this.$["*operations"],...t};this.$["*operations"]=e}_initCanvas(){let t=this.ref["canvas-el"],e=t.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,r=window.devicePixelRatio;t.style.width=`${i}px`,t.style.height=`${s}px`,t.width=i*r,t.height=s*r,e.scale(r,r),this._canvas=t,this._ctx=e}_alignImage(){if(!this._isActive||!this.$.image)return;let t=this.$.image,e=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,r=this.offsetWidth,n=this.offsetHeight,a=ji({width:t.naturalWidth,height:t.naturalHeight},s);if(a.width>r-2*e||a.height>n-2*e){let t=a.width/a.height;if(t>r/n){let i=r-2*e,s=i/t,a=0+e,o=e+(n-2*e)/2-s/2;this.$["*imageBox"]={x:a,y:o,width:i,height:s}}else{let i=n-2*e,s=i*t,a=e+(r-2*e)/2-s/2,o=0+e;this.$["*imageBox"]={x:a,y:o,width:s,height:i}}}else{let{width:t,height:i}=a,s=e+(r-2*e)/2-t/2,o=e+(n-2*e)/2-i/2;this.$["*imageBox"]={x:s,y:o,width:t,height:i}}}_alignCrop(){let t=this.$["*cropBox"],e=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,r=this.$["*editorTransformations"].crop;if(r){let{dimensions:[e,i],coords:[n,a]}=r,{width:o,x:l,y:c}=this.$["*imageBox"],{width:h}=ji(this._imageSize,s),d=o/h;t={x:l+n*d,y:c+a*d,width:e*d,height:i*d}}else t={x:e.x,y:e.y,width:e.width,height:e.height};t=Ui(t,[Math.min(e.width,Ti),Math.min(e.height,Ti)],"se"),t=Ii(t,e),this.$["*cropBox"]=t}_drawImage(){let t=this.$.image,e=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:r,rotate:n}=i,a=this._ctx,o=ji({width:e.width,height:e.height},n);a.save(),a.translate(e.x+e.width/2,e.y+e.height/2),a.rotate(n*Math.PI*-1/180),a.scale(s?-1:1,r?-1:1),a.drawImage(t,-o.width/2,-o.height/2,o.width,o.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let t=this._canvas;this._ctx.clearRect(0,0,t.width,t.height),this._drawImage()}_animateIn({fromViewer:t}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout((()=>{this.className=ii({active_from_viewer:t,active_from_editor:!t,inactive_to_editor:!1})})))}_calculateDimensions(){let t=this.$["*cropBox"],e=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n}=e,{width:a,height:o}=ji(this._imageSize,s),{width:l,height:c}=t,h=r/a,d=n/o;return[Fi(Math.round(l/h),1,a),Fi(Math.round(c/d),1,o)]}_calculateCrop(){let t=this.$["*cropBox"],e=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n,x:a,y:o}=e,{width:l,height:c}=ji(this._imageSize,s),{x:h,y:d}=t,u=r/l,p=n/c,m=this._calculateDimensions(),g={dimensions:m,coords:[Fi(Math.round((h-a)/u),0,l-m[0]),Fi(Math.round((d-o)/p),0,c-m[1])]};if(function(t){return!t||[({dimensions:t,coords:e})=>[...t,...e].every((t=>Number.isInteger(t)&&Number.isFinite(t))),({dimensions:t,coords:e})=>t.every((t=>t>0))&&e.every((t=>t>=0))].every((e=>e(t)))}(g)){if(m[0]!==l||m[1]!==c)return g}else console.error("Cropper is trying to create invalid crop object",{payload:g})}_commit(){let t=this.$["*operations"],{rotate:e,mirror:i,flip:s}=t,r=this._calculateCrop(),n={...this.$["*editorTransformations"],crop:r,rotate:e,mirror:i,flip:s};this.$["*editorTransformations"]=n}setValue(t,e){console.log(`Apply cropper operation [${t}=${e}]`),this.$["*operations"]={...this.$["*operations"],[t]:e},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(t){return this.$["*operations"][t]}async activate(t,{fromViewer:e}){if(!this._isActive){this._isActive=!0,this._imageSize=t,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:e})}catch(t){console.error("Failed to activate cropper",{error:t})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=ii({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let t=this._calculateDimensions(),e=Math.min(this.offsetWidth,t[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight,t[1])/this.$["*cropBox"].height,s=Math.min(e,i),r=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-r)/s}px, ${(this.offsetHeight/2-n)/s}px)`,this.style.transformOrigin=`${r}px ${n}px`}_transitionToImage(){let t=this.$["*cropBox"].x+this.$["*cropBox"].width/2,e=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${t}px ${e}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(t,e){let i=this.offsetWidth;e={...e,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=this.proxyUrl(wi(t,i,e)),{promise:r,cancel:n,image:a}=ni(s),o=this._handleImageLoading(s);return a.addEventListener("load",o,{once:!0}),a.addEventListener("error",o,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,r.then((()=>a)).catch((t=>(console.error("Failed to load image",{error:t}),this.$["*networkProblems"]=!0,Promise.resolve(a))))}_handleImageLoading(t){let e="crop",i=this.$["*loadingOperations"];return i.get(e)||i.set(e,new Map),i.get(e).get(t)||(i.set(e,i.get(e).set(t,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(e)?.has(t)&&(i.get(e).delete(t),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new zi((()=>{this._isActive&&this.$.image&&this._handleResizeDebounced()})),this._observer.observe(this),this.sub("*imageBox",(()=>{this._draw()})),this.sub("*cropBox",(t=>{this.$.image&&this._commitDebounced()})),setTimeout((()=>{this.sub("*networkProblems",(t=>{t||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})}))}),0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}}function qi(t,e,i){let s=Array(i);for(let r=--i;r>=0;r--)s[r]=Math.ceil((r*e+(i-r)*t)/i);return s}function Ki(t,e){let i=yi[t].keypointsNumber,{range:s,zero:r}=yi[t];return[...new Set([...qi(s[0],r,i+1),...qi(r,s[1],i+1),r,e])].sort(((t,e)=>t-e))}Hi.template="\n  <canvas class='canvas' ref='canvas-el'></canvas>\n  <lr-crop-frame ref='frame-el'></lr-crop-frame>\n";class Xi extends st{initCallback(){super.initCallback(),this.addEventListener("wheel",(t=>{t.preventDefault();let{deltaY:e,deltaX:i}=t;Math.abs(i)>1?this.scrollLeft+=i:this.scrollLeft+=e}))}}Xi.template="\n<slot></slot>\n";class Wi extends st{constructor(){super(),this.init$={...this.ctxInit,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*editorTransformations":{},"*currentFilter":Di,"*currentOperation":null,showLoader:!1,tabId:pi,filters:_i,colorOperations:bi,cropOperations:vi,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":t=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":t=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":t=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":t=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let e=t.currentTarget.getAttribute("data-id");this._activateTab(e,{fromViewer:!1})}},this._debouncedShowLoader=si(this._showLoader.bind(this),500)}get tabId(){return this.$.tabId}_onSliderClose(){this.$["*showSlider"]=!1,this.$.tabId===mi&&(this.ref["tooltip-el"].className=ii("filter-tooltip",{"filter-tooltip_visible":!1,"filter-tooltip_hidden":!0}))}_createOperationControl(t){let e=Vi.is&&new Vi;return e.operation=t,e}_createFilterControl(t){let e=Bi.is&&new Bi;return e.filter=t,e}_createToggleControl(t){let e=Pi.is&&new Pi;return e.operation=t,e}_renderControlsList(t){let e=this.ref[`controls-list-${t}`],i=document.createDocumentFragment();t===pi?this.$.cropOperations.forEach((t=>{let e=this._createToggleControl(t);i.appendChild(e)})):t===gi?[Di,...this.$.filters].forEach((t=>{let e=this._createFilterControl(t);i.appendChild(e)})):t===mi&&this.$.colorOperations.forEach((t=>{let e=this._createOperationControl(t);i.appendChild(e)})),i.childNodes.forEach(((t,e)=>{e===i.childNodes.length-1&&t.classList.add("controls-list_last-item")})),e.innerHTML="",e.appendChild(i)}_activateTab(t,{fromViewer:e}){this.$.tabId=t,t===pi?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:e})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:e}),this.$["*cropperEl"].deactivate());for(let e of fi){let i=e===t;this.ref[`tab-toggle-${e}`].active=i,i?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(e),this.$[`presence.tabContent.${e}`]=i}}_unmountTabControls(t){let e=this.ref[`controls-list-${t}`];e&&(e.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$.tabId}`];this.ref["tabs-indicator"].style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,e=this.proxyUrl(wi(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:i}=ai([e]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",(t=>{t&&setTimeout((()=>{this._activateTab(this.$.tabId,{fromViewer:!0})}),0)})),this.sub("*currentFilter",(t=>{this.$["*operationTooltip"]=this.l10n(t||Di),this.ref["tooltip-el"].className=ii("filter-tooltip",{"filter-tooltip_visible":t,"filter-tooltip_hidden":!t})})),this.sub("*currentOperation",(t=>{this.$.tabId===mi&&(this.$["*operationTooltip"]=t,this.ref["tooltip-el"].className=ii("filter-tooltip",{"filter-tooltip_visible":t,"filter-tooltip_hidden":!t}))})),this.sub("*tabId",(t=>{t===gi&&(this.$["*operationTooltip"]=this.$["*currentFilter"]),this.ref["tooltip-el"].className=ii("filter-tooltip",{"filter-tooltip_visible":t===gi,"filter-tooltip_hidden":t!==gi})})),this.sub("*originalUrl",(t=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()})),this.sub("*editorTransformations",(t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)})),this.sub("*loadingOperations",(t=>{let e=!1;for(let[,i]of t.entries()){if(e)break;for(let[,t]of i.entries())if(t){e=!0;break}}this._debouncedShowLoader(e)})),this.sub("*showSlider",(t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}))}}Wi.template=`\n<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>\n<div class="filter-tooltip_container">\n  <div class="filter-tooltip_wrapper">\n    <div ref="tooltip-el" class="filter-tooltip filter-tooltip_visible">\n      {{*operationTooltip}}\n    </div>\n  </div>\n</div>\n<div class="toolbar-container">\n  <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">\n      <div class="tab-content-row">\n      ${fi.map((function(t){return`\n    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${t}; styles: presence.tabContentStyles">\n        <lr-editor-scroller hidden-scrollbar>\n          <div class="controls-list_align">\n            <div class="controls-list_inner" ref="controls-list-${t}">\n            </div>\n          </div>\n        </lr-editor-scroller>\n    </lr-presence-toggle>\n  `})).join("")}\n      </div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel">\n        </lr-btn-ui>\n        <div class="tab-toggles">\n          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>\n          ${fi.map((function(t){return`\n    <lr-btn-ui theme="boring" ref="tab-toggle-${t}" data-id="${t}" icon="${t}" tabindex="0" set="onclick: on.clickTab;">\n    </lr-btn-ui>\n  `})).join("")}\n        </div>\n        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply">\n        </lr-btn-ui>\n      </div>\n  </lr-presence-toggle>\n  <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">\n      <div class="slider">\n        <lr-editor-slider ref="slider-el"></lr-editor-slider>\n      </div>\n      <div class="controls-row">\n        <lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;">\n        </lr-btn-ui>\n        <lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;">\n        </lr-btn-ui>\n      </div>\n  </lr-presence-toggle>\n</div>\n`;class Gi extends st{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.ctxInit,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",(t=>{t?this.setAttribute("active",""):this.removeAttribute("active")}))}_iconCss(){return ii("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",(t=>{this._iconSingle=!this.$.text,this._iconHidden=!t,this.$.iconCss=this._iconCss()})),this.sub("theme",(t=>{"custom"!==t&&(this.className=t)})),this.sub("text",(t=>{this._iconSingle=!1})),this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(t){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}Gi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),Gi.template='\n<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>\n<div class="text">{{text}}</div>\n';class Yi extends st{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let t=this.ref["line-el"];t.style.transition="initial",t.style.opacity="0",t.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",(t=>{"boolean"==typeof t&&(t?this._start():this._stop())}))}_start(){this._active=!0;let{width:t}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${t}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}Yi.template='\n  <div class="inner">\n    <div class="line" ref="line-el"></div>\n  </div>\n';const Ji="transition",Zi="visible",Qi="hidden";class ts extends st{constructor(){super(),this._visible=!1,this._visibleStyle=Zi,this._hiddenStyle=Qi,this._externalTransitions=!1,this.defineAccessor("styles",(t=>{t&&(this._externalTransitions=!0,this._visibleStyle=t.visible,this._hiddenStyle=t.hidden)})),this.defineAccessor("visible",(t=>{"boolean"==typeof t&&(this._visible=t,this._handleVisible())}))}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",function(t,...e){let i=ei(...e);for(let e of Object.keys(i))t.classList.toggle(e,i[e])}(this,{[Ji]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Ji),this._handleVisible(),setTimeout((()=>this.removeAttribute("hidden")),0)}}ts.template="\n<slot></slot>\n";class es extends st{init$={...this.ctxInit,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}};constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",(t=>{this.$.disabled=t})),this.defineAccessor("min",(t=>{this.$.min=t})),this.defineAccessor("max",(t=>{this.$.max=t})),this.defineAccessor("defaultValue",(t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)})),this.defineAccessor("zero",(t=>{this._zero=t})),this.defineAccessor("onInput",(t=>{t&&(this.$.onInput=t)})),this.defineAccessor("onChange",(t=>{t&&(this.$.onChange=t)})),this._updateSteps(),this._observer=new zi((()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)})),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout((()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),0),this.sub("disabled",(t=>{let e=this.ref["input-el"];t?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}));let t=this.ref["input-el"];t.addEventListener("focus",(()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")})),t.addEventListener("blur",(()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")}))}_updateValue(t){this._updateZeroDot(t);let{width:e}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(t-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame((()=>{this.ref["thumb-el"].style.transform=`translateX(${i}px)`}))}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:e}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame((()=>{this._zeroDotEl.style.transform=`translateX(${i}px)`}))}_updateSteps(){let t=this.ref["steps-el"],{width:e}=t.getBoundingClientRect(),i=Math.ceil(e/2),s=Math.ceil(i/15)-2;if(this._stepsCount===s)return;let r=document.createDocumentFragment(),n=document.createElement("div"),a=document.createElement("div");n.className="minor-step",a.className="border-step",r.appendChild(a);for(let t=0;t<s;t++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());for(let t=0;t<s;t++)r.appendChild(n.cloneNode());r.appendChild(a.cloneNode());let o=document.createElement("div");o.className="zero-dot",r.appendChild(o),this._zeroDotEl=o,t.innerHTML="",t.appendChild(r),this._stepsCount=s}destroyCallback(){this._observer?.disconnect()}}es.template='\n  <div class="steps" ref="steps-el">\n  </div>\n  <div ref="thumb-el" class="thumb"></div>\n  <input class="input" type=\'range\' ref=\'input-el\' tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;">\n';let is={};window.addEventListener("message",(t=>{let e;try{e=JSON.parse(t.data)}catch(t){return}if(e?.type in is){let i=is[e.type];for(let[s,r]of i)t.source===s&&r(e)}}));function ss({textColor:t,backgroundColor:e,linkColor:i,linkColorHover:s,shadeColor:r}){let n=`solid 1px ${r}`;return a={body:{color:t,"background-color":e},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:i},".bread-crumbs a:hover":{color:s},".main-content.loading":{background:`${e} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${r}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:i},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:s},".side-bar-menu a":{color:i},".side-bar-menu a:hover":{color:s},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:s},".source-vk .side-bar-menu a":{color:i},".source-vk .side-bar-menu a:hover":{color:s,background:"none"}},Object.keys(a).reduce(((t,e)=>{let i=a[e],s=Object.keys(i).reduce(((t,e)=>t+`${e}: ${i[e]};`),"");return t+`${e}{${s}}`}),"");var a}class rs extends ge{activityType=at.activities.EXTERNAL;init$={...this.ctxInit,counter:0,onDone:()=>{this.$["*currentActivity"]=at.activities.UPLOAD_LIST},onCancel:()=>{this.cancelFlow()}};_iframe=null;initCallback(){super.initCallback(),this.registerActivity(this.activityType,(()=>{let{externalSourceType:t}=this.activityParams;this.set$({"*activityCaption":`${t?.[0].toUpperCase()}${t?.slice(1)}`,"*activityIcon":t}),this.$.counter=0,this.mountIframe()})),this.sub("*currentActivity",(t=>{t!==this.activityType&&this.unmountIframe()}))}sendMessage(t){this._iframe.contentWindow.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){this.$.counter=this.$.counter+1;let{url:e,filename:i}=t;this.uploadCollection.add({externalUrl:e,fileName:i})}handleIframeLoad(t){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:ss(t)})}remoteUrl(){let t=this.getCssData("--cfg-pubkey"),e=(!1).toString(),{externalSourceType:i}=this.activityParams;return`https://social.uploadcare.com/window3/${i}?${function(t){let e=[];for(let[i,s]of Object.entries(t))null==s||"string"==typeof s&&0===s.length||e.push(`${i}=${encodeURIComponent(s)}`);return e.join("&")}({lang:"en",widget_version:"3.11.3",public_key:t,images_only:e,pass_window_open:!1,session_key:this.getCssData("--cfg-remote-tab-session-key")})}`}mountIframe(){let t=W({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});var e,i,s;t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),e="file-selected",i=t.contentWindow,s=this.handleFileSelected.bind(this),e in is||(is[e]=[]),is[e].push([i,s]),this._iframe=t}unmountIframe(){var t,e;this._iframe&&(t="file-selected",e=this._iframe.contentWindow,t in is&&(is[t]=is[t].filter((t=>t[0]!==e)))),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}}rs.template='\n<div\n  ref="iframeWrapper"\n  class="iframe-wrapper">\n</div>\n<div class="toolbar">\n  <button type="button"\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <div></div>\n  <div class="selected-counter">\n    <span l10n="selected-count"></span>{{counter}}</div>\n  <button type="button" class="done-btn primary-btn" set="onclick: onDone">\n    <lr-icon name="check"></lr-icon>\n  </button>\n</div>\n';class ns extends st{setCurrentTab(t){if(!t)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach((e=>{e.getAttribute("tab-ctx")===t?e.removeAttribute("hidden"):e.setAttribute("hidden","")}));for(let e in this._tabMap)e===t?this._tabMap[e].setAttribute("current",""):this._tabMap[e].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",(t=>{if(!t)return;t.split(",").map((t=>t.trim())).forEach((t=>{let e=W({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(t)}}});e.textContent=this.l10n(t),this.ref.row.appendChild(e),this._tabMap[t]=e}))})),this.defineAccessor("default",(t=>{this.setCurrentTab(t)})),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}ns.bindAttributes({"tab-list":null,default:null}),ns.template='\n<div ref="row" class="tabs-row"></div>\n<div ref="context" class="tabs-context">\n  <slot></slot>\n</div>\n';class as extends ge{processInnerHtml=!0;init$={...this.ctxInit,output:null,filesData:null};cssInit$={"--cfg-group-output":0};get dict(){return as.dict}initCallback(){super.initCallback(),this.sub("output",(t=>{t&&(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(this.dict.FORM_VALUE_ATTR)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this._input.hidden=!0,this.appendChild(this._input)),this._input.value=JSON.stringify(t)),this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(t))}),!1),this.sub(this.dict.SRC_CTX_KEY,(async t=>{if(!t)return this.$.output=null,void(this.$.filesData=null);if(this.$.filesData=t,this.getCssData("--cfg-group-output")||this.hasAttribute(this.dict.GROUP_ATTR)){let e=t.map((t=>t.uuid)),i=await ae(e,{...this.getUploadClientOptions()});this.$.output={groupData:i,files:t}}else this.$.output=t}),!1)}}as.dict={SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_VALUE_ATTR:"form-value"};class os extends at{}os.template='\n<div class="caption">{{*activityCaption}}</div>\n';class ls extends at{}ls.template='\n<lr-icon set="@name: *activityIcon"></lr-icon>\n';class cs extends st{init$={...this.ctxInit,currentText:"",options:[],selectHtml:"",onSelect:t=>{t.preventDefault(),t.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=this.$.options.find((t=>t.value==this.value))?.text||"",this.dispatchEvent(new Event("change"))}};initCallback(){super.initCallback(),this.sub("options",(t=>{this.$.currentText=t?.[0]?.text||"";let e="";t?.forEach((t=>{e+=`<option value="${t.value}">${t.text}</option>`})),this.$.selectHtml=e}))}}cs.template='\n<button>\n  {{currentText}}\n  <lr-icon name="select"></lr-icon>\n  <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>\n</button>\n';class hs extends st{pauseRender=!0;shadowReadyCallback(){}initCallback(){super.initCallback();let t=this.getAttribute("css-src");if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,e.onload=()=>{window.requestAnimationFrame((()=>{this.render(),window.setTimeout((()=>{this.shadowReadyCallback()}))}))},this.shadowRoot.appendChild(e)}else this.render(),this.shadowReadyCallback()}}class ds extends hs{}ds.template='\n<lr-simple-btn></lr-simple-btn>\n\n<lr-modal strokes block-body-scrolling>\n  <lr-activity-icon slot="heading"></lr-activity-icon>\n  <lr-activity-caption slot="heading"></lr-activity-caption>\n  <lr-start-from>\n    <lr-source-list wrap></lr-source-list>\n    <lr-drop-area clickable></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list></lr-upload-list>\n  <lr-camera-source></lr-camera-source>\n  <lr-url-source></lr-url-source>\n  <lr-external-source></lr-external-source>\n  <lr-upload-details></lr-upload-details>\n  <lr-confirmation-dialog></lr-confirmation-dialog>\n  <lr-cloud-image-editor></lr-cloud-image-editor>\n</lr-modal>\n\n<lr-message-box></lr-message-box>\n<lr-progress-bar-common></lr-progress-bar-common>\n';class us extends hs{ctxInit=it;ctxOwner=!0}class ps extends us{pauseRender=!0;init$={...this.ctxInit,selectClicked:()=>{this.ref.uBlock.openSystemDialog()}};shadowReadyCallback(){const t=this.ref.uBlock;this.sub("*currentActivity",(e=>{e||(this.$["*currentActivity"]=t.initActivity||at.activities.START_FROM)}))}}ps.template='\n  <lr-start-from>\n    <lr-drop-area clickable l10n="drop-files-here"></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list ref="uBlock"></lr-upload-list>\n  <lr-message-box></lr-message-box>\n';class ms extends hs{init$={...this.ctxInit,dropAreaHidden:!1};shadowReadyCallback(){const t=this.ref.uBlock;this.sub("*currentActivity",(e=>{e||(this.$["*currentActivity"]=t.initActivity||at.activities.START_FROM)})),window.customElements.whenDefined(t.tagName.toLowerCase()).then((()=>{1!==t.sourceList.length||t.sourceList.includes(ge.sourceTypes.LOCAL)||(this.$.dropAreaHidden=!0)}))}}function gs(t){for(let e in t){let i=[...e].reduce(((t,e)=>(e.toUpperCase()===e&&(e="-"+e.toLowerCase()),t+e)),"");i.startsWith("-")&&(i=i.replace("-","")),i.startsWith("lr-")||(i="lr-"+i),t[e].reg?.(i)}}ms.template='\n<lr-start-from>\n  <lr-source-list wrap></lr-source-list>\n  <lr-drop-area set="@hidden: dropAreaHidden" clickable></lr-drop-area>\n</lr-start-from>\n<lr-upload-list ref="uBlock"></lr-upload-list>\n<lr-camera-source></lr-camera-source>\n<lr-url-source></lr-url-source>\n<lr-external-source></lr-external-source>\n<lr-upload-details></lr-upload-details>\n<lr-confirmation-dialog></lr-confirmation-dialog>\n<lr-message-box></lr-message-box>\n<lr-progress-bar></lr-progress-bar>\n<lr-cloud-image-editor></lr-cloud-image-editor>';const fs="__lr-blocks__";var bs=Object.freeze({__proto__:null,BaseComponent:K,Data:L,Block:st,ActivityBlock:at,UploaderBlock:ge,Icon:fe,Img:class extends Se{initCallback(){super.initCallback(),this.sub$$("src",(()=>{this.init()})),this.sub$$("uuid",(()=>{this.init()})),this.sub$$("lazy",(t=>{this.$$("is-background-for")||(this.img.loading=t?"lazy":"eager")}))}},SimpleBtn:Ie,StartFrom:class extends at{activityType="start-from";initCallback(){super.initCallback(),this.registerActivity(this.activityType,(()=>{this.add$({"*activityCaption":this.l10n("select-file-source"),"*activityIcon":"default"},!0)}))}},DropArea:class extends ge{init$={...this.ctxInit,state:Pe.INACTIVE};initCallback(){if(super.initCallback(),this._destroyDropzone=De({element:this,onChange:t=>{this.$.state=t},onFiles:t=>{t.length&&(this.getCssData("--cfg-multiple")||(t=[t[0]]),t.forEach((t=>{let e=!1,i=t.type.includes("image");if(this.getCssData("--cfg-img-only")&&!i?e=!0:this.uploadCollection.add({file:t,isImage:i,mimeType:t.type,fileName:t.name,fileSize:t.size}),e){let t=new Ne;t.caption="Error",t.text=this.l10n("has-validation-errors"),t.isError=!0,this.$["*message"]=t}})),this.set$({"*currentActivity":at.activities.UPLOAD_LIST}))},onImgElement(t){this.uploadCollection.add({externalUrl:t}),this.set$({"*currentActivity":at.activities.UPLOAD_LIST})}}),this.sub("state",(t=>{const e=Object.entries(Pe).find((([,e])=>e===t))?.[0].toLowerCase();e&&this.setAttribute("drag-state",e)})),this.hasAttribute("clickable")){let t=this.getAttribute("clickable");""!==t&&"true"!==t||(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}}destroyCallback(){super.destroyCallback(),this._destroyDropzone?.(),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}},SourceBtn:Ve,SourceList:class extends st{cssInit$={"--cfg-source-list":""};initCallback(){super.initCallback(),this.sub("--cfg-source-list",(t=>{if(!t)return;let e=t.split(",").map((t=>t.trim())),i="";e.forEach((t=>{i+=`<lr-source-btn type="${t}"></lr-source-btn>`})),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=i:this.outerHTML=i}))}},FileItem:je,Modal:He,UploadList:Xe,UrlSource:We,CameraSource:Ye,UploadCtxProvider:class extends ge{},UploadDetails:Je,MessageBox:Be,ConfirmationDialog:Ke,ProgressBarCommon:Ze,ProgressBar:Qe,EditableCanvas:ti,CloudImageEditor:class extends ge{activityType=at.activities.CLOUD_IMG_EDIT;init$={...this.ctxInit,uuid:null};initCallback(){super.initCallback(),this.bindCssData("--cfg-pubkey"),this.sub("*currentActivity",(t=>{t===at.activities.CLOUD_IMG_EDIT?this.mountEditor():this.unmountEditor()})),this.sub("*focusedEntry",(t=>{t&&(this.entry=t,this.entry.subscribe("uuid",(t=>{t&&(this.$.uuid=t)})))}))}handleApply(t){let e=t.detail;this.entry.setMultipleValues({cdnUrl:e.cdnUrl,cdnUrlModifiers:e.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new Ci;t.classList.add("lr-cldtr-common");let e=this.$.uuid;t.setAttribute("uuid",e),t.addEventListener("apply",(t=>this.handleApply(t))),t.addEventListener("cancel",(()=>this.handleCancel())),this.innerHTML="",this.appendChild(t)}unmountEditor(){this.innerHTML=""}},ExternalSource:rs,Tabs:ns,DataOutput:as,ActivityCaption:os,ActivityIcon:ls,Select:cs,FileUploaderRegular:ds,FileUploaderMinimal:ps,FileUploaderInline:ms,registerBlocks:gs,connectBlocksFrom:async function(t){return new Promise(((e,i)=>{if("object"!=typeof document)return void e(null);if("object"==typeof window&&window?.[fs])return void e(window[fs]);let s=document.createElement("script");s.type="module",s.src=t,s.onerror=()=>{i()},s.onload=()=>{let t=window[fs];gs(t),e(t)},document.head.appendChild(s)}))},CloudEditor:Ci,CropFrame:Ri,EditorCropButtonControl:Pi,EditorFilterControl:Bi,EditorOperationControl:Vi,EditorImageCropper:Hi,EditorImageFader:class extends st{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=si(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(t){let e=this._operation,i=this.$["*loadingOperations"];return i.get(e)||i.set(e,new Map),i.get(e).get(t)||(i.set(e,i.get(e).set(t,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(e)?.has(t)&&(i.get(e).delete(t),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame((()=>{for(let t of this._keypoints){let{image:e}=t;e&&(e.style.opacity=t.opacity.toString(),e.style.zIndex=t.zIndex.toString())}}))}_imageSrc({url:t=this._url,filter:e=this._filter,operation:i,value:s}={}){let r={...this._transformations};i&&(r[i]=e?{name:e,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl(wi(t,n,r))}_constructKeypoint(t,e){return{src:this._imageSrc({operation:t,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(t,e){return this._operation===t&&this._filter===e}_addKeypoint(t,e,i){let s=()=>!this._isSame(t,e)||this._value!==i||!!this._keypoints.find((t=>t.value===i));if(s())return;let r=this._constructKeypoint(t,i),n=new Image;n.src=r.src;let a=this._handleImageLoading(r.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),r.image=n,n.classList.add("fader-image"),n.addEventListener("load",(()=>{if(s())return;let e=this._keypoints,a=e.findIndex((t=>t.value>i)),o=a<e.length?e[a].image:null;!this._container||o&&!this._container.contains(o)||(e.splice(a,0,r),this._container.insertBefore(n,o),this._update(t,i))}),{once:!0}),n.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}set(t){t="string"==typeof t?parseInt(t,10):t,this._update(this._operation,t),this._addKeypointDebounced(this._operation,this._filter,t)}_update(t,e){this._operation=t,this._value=e;let{zero:i}=yi[t],s=this._keypoints.map((t=>t.value)),r=function(t,e,i){let s=(r=t,r.reduce(((t,e,i)=>i<r.length-1?[...t,[e,r[i+1]]]:t),[])).find((([t,i])=>t<=e&&e<=i));var r;return t.map((t=>{let r=Math.abs(s[0]-s[1]),n=Math.abs(e-s[0])/r;return s[0]===t?e>i?1:1-n:s[1]===t?e>=i?n:1:0}))}(s,e,i),n=function(t,e){return t.map(((i,s)=>i<e?t.length-s:s))}(s,i);for(let[t,e]of Object.entries(this._keypoints))e.opacity=r[t],e.zIndex=n[t];this._flush()}_createPreviewImage(){let t=new Image;return t.classList.add("fader-image","fader-image--preview"),t.style.opacity="0",t}async _initNodes(){let t=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&t.appendChild(this._previewImage);let e=document.createElement("div");t.appendChild(e);let i=this._keypoints.map((t=>t.src)),{images:s,promise:r,cancel:n}=ai(i);s.forEach((t=>{let e=this._handleImageLoading(t.src);t.addEventListener("load",e),t.addEventListener("error",e)})),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,o=this._filter;await r,this._isActive&&this._isSame(a,o)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach(((t,e)=>{let i=s[e];i.classList.add("fader-image"),t.image=i,this._container.appendChild(i)})),this.appendChild(t),this._flush())}setTransformations(t){if(this._transformations=t,this._previewImage){let t=this._imageSrc(),e=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",e,{once:!0}),this._previewImage.addEventListener("error",e,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}}preload({url:t,filter:e,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let r=Ki(i,s).map((s=>this._imageSrc({url:t,filter:e,operation:i,value:s}))),{cancel:n}=ai(r);this._cancelBatchPreload=n}_setOriginalSrc(t){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===t)return e.style.opacity="1",e.style.transform="scale(1)",void(this.className=ii({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}));e.style.opacity="0";let i=this._handleImageLoading(t);e.addEventListener("error",i,{once:!0}),e.src=t,e.addEventListener("load",(()=>{i(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=ii({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))}),{once:!0}),e.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}activate({url:t,operation:e,value:i,filter:s,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=t,this._operation=e||"initial",this._value=i,this._filter=s,this._fromViewer=r,"number"!=typeof i&&!s){let t=this._imageSrc({operation:e,value:i});return this._setOriginalSrc(t),void(this._container&&this._container.remove())}this._keypoints=Ki(e,i).map((t=>this._constructKeypoint(e,t))),this._update(e,i),this._initNodes()}deactivate({hide:t=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),t&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=ii({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",(()=>{this._container&&this._container.remove()}),{once:!0})):this._container&&this._container.remove()}},EditorScroller:Xi,EditorSlider:Ni,EditorToolbar:Wi,LrBtnUi:Gi,LineLoaderUi:Yi,PresenceToggle:ts,SliderUi:es});function _s(t,e,i){const s=t.slice();return s[2]=e[i],s}function vs(t){let e,i;return{c(){e=u("img"),l(e.src,i="https://ucarecdn.com/"+t[2].uuid+"/-/preview/-/scale_crop/400x400/")||m(e,"src",i),m(e,"width","200"),m(e,"alt","Uploadcare uploaded file")},m(t,i){h(t,e,i)},p(t,s){1&s&&!l(e.src,i="https://ucarecdn.com/"+t[2].uuid+"/-/preview/-/scale_crop/400x400/")&&m(e,"src",i)},d(t){t&&d(e)}}}function ys(e){let i,s,r,n,a,o,l,f,b=e[0],_=[];for(let t=0;t<b.length;t+=1)_[t]=vs(_s(e,b,t));return{c(){i=u("div"),s=u("lr-file-uploader-regular"),r=p(),n=u("lr-data-output"),a=p(),o=u("div");for(let t=0;t<_.length;t+=1)_[t].c();g(s,"class","uploader-cfg lr-wgt-common svelte-5i7ef"),g(n,"use-event",""),g(n,"class","uploader-cfg lr-wgt-common svelte-5i7ef"),m(o,"class","output svelte-5i7ef"),m(i,"class","wrapper svelte-5i7ef")},m(t,d){h(t,i,d),c(i,s),c(i,r),c(i,n),c(i,a),c(i,o);for(let t=0;t<_.length;t+=1)_[t].m(o,null);var u,p,m,g;l||(u=n,p="lr-data-output",m=e[1],u.addEventListener(p,m,g),f=()=>u.removeEventListener(p,m,g),l=!0)},p(t,[e]){if(1&e){let i;for(b=t[0],i=0;i<b.length;i+=1){const s=_s(t,b,i);_[i]?_[i].p(s,e):(_[i]=vs(s),_[i].c(),_[i].m(o,null))}for(;i<_.length;i+=1)_[i].d(1);_.length=b.length}},i:t,o:t,d(t){t&&d(i),function(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}(_,t),l=!1,f()}}}function ws(t,e,i){gs(bs);let s=[];return[s,function(t){const{data:e}=t.detail;i(0,s=e)}]}return new class extends class{$destroy(){!function(t,e){const i=t.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}(this,1),this.$destroy=t}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}{constructor(t){super(),I(this,t,ws,ys,n,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
