var app=function(){"use strict";function e(){}function t(e){return e()}function i(){return Object.create(null)}function s(e){e.forEach(t)}function n(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a,o;function l(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function c(e,t){e.appendChild(t)}function h(e,t,i){e.insertBefore(t,i||null)}function d(e){e.parentNode.removeChild(e)}function u(e){return document.createElement(e)}function p(){return e=" ",document.createTextNode(e);var e}function m(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function g(e,t,i){t in e?e[t]="boolean"==typeof e[t]&&""===i||i:m(e,t,i)}function b(e){o=e}const f=[],_=[],v=[],y=[],w=Promise.resolve();let $=!1;function C(e){v.push(e)}const x=new Set;let T=0;function A(){const e=o;do{for(;T<f.length;){const e=f[T];T++,b(e),k(e.$$)}for(b(null),f.length=0,T=0;_.length;)_.pop()();for(let e=0;e<v.length;e+=1){const t=v[e];x.has(t)||(x.add(t),t())}v.length=0}while(f.length);for(;y.length;)y.pop()();$=!1,x.clear(),b(e)}function k(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(C)}}const E=new Set;function S(e,t){-1===e.$$.dirty[0]&&(f.push(e),$||($=!0,w.then(A)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function I(r,a,l,c,h,u,p,m=[-1]){const g=o;b(r);const f=r.$$={fragment:null,ctx:null,props:u,update:e,not_equal:h,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(g?g.$$.context:[])),callbacks:i(),dirty:m,skip_bound:!1,root:a.target||g.$$.root};p&&p(f.root);let _=!1;if(f.ctx=l?l(r,a.props||{},((e,t,...i)=>{const s=i.length?i[0]:t;return f.ctx&&h(f.ctx[e],f.ctx[e]=s)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](s),_&&S(r,e)),t})):[],f.update(),_=!0,s(f.before_update),f.fragment=!!c&&c(f.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);f.fragment&&f.fragment.l(e),e.forEach(d)}else f.fragment&&f.fragment.c();a.intro&&((v=r.$$.fragment)&&v.i&&(E.delete(v),v.i(y))),function(e,i,r,a){const{fragment:o,on_mount:l,on_destroy:c,after_update:h}=e.$$;o&&o.m(i,r),a||C((()=>{const i=l.map(t).filter(n);c?c.push(...i):s(i),e.$$.on_mount=[]})),h.forEach(C)}(r,a.target,a.anchor,a.customElement),A()}var v,y;b(g)}class L{constructor(e){this.uid=Symbol(),this.name=e.name||null,e.schema.constructor===Object?this.store=function(e){let t=e=>{for(let i in e)e[i]?.constructor===Object&&(e[i]=t(e[i]));return{...e}};return t(e)}(e.schema):(this._storeIsProxy=!0,this.store=e.schema),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return this._storeIsProxy||this.store.hasOwnProperty(e)?this.store[e]:(L.warn("read",e),null)}has(e){return this._storeIsProxy?void 0!==this.store[e]:this.store.hasOwnProperty(e)}add(e,t,i=!0){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.callbackMap[e]&&this.callbackMap[e].forEach((t=>{t(this.store[e])})))}pub(e,t){this._storeIsProxy||this.store.hasOwnProperty(e)?this.add(e,t):L.warn("publish",e)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach((t=>{t(this.store[e])}))}sub(e,t,i=!0){return this._storeIsProxy||this.store.hasOwnProperty(e)?(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t}):(L.warn("subscribe",e),null)}remove(){delete L.globalStore[this.uid]}static registerLocalCtx(e){let t=new L({schema:e});return L.globalStore[t.uid]=t,t}static registerNamedCtx(e,t){let i=L.globalStore[e];return i?console.warn('State: context name "'+e+'" already in use'):(i=new L({name:e,schema:t}),L.globalStore[e]=i),i}static clearNamedCtx(e){delete L.globalStore[e]}static getNamedCtx(e,t=!0){return L.globalStore[e]||(t&&console.warn('State: wrong context name - "'+e+'"'),null)}}L.globalStore=Object.create(null);const P=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"}),U="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",R=U.length-1;class N{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+="-"===e[i]?e[i]:U.charAt(Math.random()*R);return t}}const M="{{",D="}}";var O=[function(e,t){if(t.shadowRoot)return;let i=[...e.querySelectorAll("slot")];if(t.initChildren.length&&i.length){let e={};i.forEach((t=>{let i=t.getAttribute("name");i?e[i]={slot:t,fr:document.createDocumentFragment()}:e.__default__={slot:t,fr:document.createDocumentFragment()}})),t.initChildren.forEach((t=>{let i=t.getAttribute?.("slot");i?(t.removeAttribute("slot"),e[i].fr.appendChild(t)):e.__default__&&e.__default__.fr.appendChild(t)})),Object.values(e).forEach((e=>{e.slot.parentNode.insertBefore(e.fr,e.slot),e.slot.remove()}))}},function(e,t){[...e.querySelectorAll(`[${P.EL_REF_ATTR}]`)].forEach((e=>{let i=e.getAttribute(P.EL_REF_ATTR);t.ref[i]=e,e.removeAttribute(P.EL_REF_ATTR)}))},function(e,t){[...e.querySelectorAll(`[${P.BIND_ATTR}]`)].forEach((e=>{e.getAttribute(P.BIND_ATTR).split(";").forEach((i=>{if(!i)return;let s,n=i.split(":").map((e=>e.trim())),r=n[0];0===r.indexOf(P.ATTR_BIND_PRFX)&&(s=!0,r=r.replace(P.ATTR_BIND_PRFX,""));let a,o,l,c,h=n[1].split(",").map((e=>e.trim()));if(r.includes(".")){a=!0;let t=r.split(".");c=()=>{o=e,t.forEach(((e,i)=>{i<t.length-1?o=o[e]:l=e}))},c()}for(let i of h)t.sub(i,(t=>{s?t?.constructor===Boolean?t?e.setAttribute(r,""):e.removeAttribute(r):e.setAttribute(r,t):a?o?o[l]=t:window.setTimeout((()=>{c(),o[l]=t})):e[r]=t}))})),e.removeAttribute(P.BIND_ATTR)}))},function(e,t){(function(e){let t,i=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>!e.parentElement?.hasAttribute("skip-text")&&e.textContent.includes(M)&&e.textContent.includes(D)&&1});for(;t=s.nextNode();)i.push(t);return i})(e).forEach((e=>{let i,s=[];for(;e.textContent.includes(D);)e.textContent.startsWith(M)?(i=e.textContent.indexOf(D)+D.length,e.splitText(i),s.push(e)):(i=e.textContent.indexOf(M),e.splitText(i)),e=e.nextSibling;s.forEach((e=>{let i=e.textContent.replace(M,"").replace(D,"");t.sub(i,(t=>{e.textContent=t}))}))}))}];let B=0;class z extends HTMLElement{initCallback(){}__initCallback(){this.__initialized||(this.__initialized=!0,this.initCallback?.())}static template;render(e,t=this.renderShadow){let i;if(!t&&!this.constructor.__shadowStylesUrl||this.shadowRoot||this.attachShadow({mode:"open"}),this.processInnerHtml)for(let e of this.tplProcessors)e(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),e?.constructor===DocumentFragment)i=e;else if(e?.constructor===String){let t=document.createElement("template");t.innerHTML=e,i=t.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let e of this.tplProcessors)e(i,this)}let s=()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let e=document.createElement("link");e.rel="stylesheet",e.href=this.constructor.__shadowStylesUrl,e.onload=s,this.shadowRoot.prepend(e)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}constructor(){super(),this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=N.generate(),this.style.setProperty(P.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(P.CSS_CTX_PROP,!0)}get ctxName(){return this.getAttribute(P.CTX_NAME_ATTR)?.trim()||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=L.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return L.getNamedCtx(this.ctxName,!1)||L.registerNamedCtx(this.ctxName,{})}static __parseProp(e,t){let i,s;if(e.startsWith(P.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(P.EXT_DATA_CTX_PRFX,"");else if(e.includes(P.NAMED_DATA_CTX_SPLTR)){let t=e.split(P.NAMED_DATA_CTX_SPLTR);i=L.getNamedCtx(t[0]),s=t[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t){let i=z.__parseProp(e,this);this.allSubs.add(i.ctx.sub(i.name,t))}notify(e){let t=z.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=z.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t){let i=z.__parseProp(e,this);i.ctx.add(i.name,t,!1)}add$(e){for(let t in e)this.add(t,e[t])}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(e,t,i)=>{let s=z.__parseProp(t,this);return s.ctx.pub(s.name,i),!0},get:(e,t)=>{let i=z.__parseProp(t,this);return i.ctx.read(i.name)}})}return this.__stateProxy}set$(e){for(let t in e)this.$[t]=e[t]}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let e in this.init$)if(e.startsWith(P.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(P.EXT_DATA_CTX_PRFX,""),this.init$[e]);else if(e.includes(P.NAMED_DATA_CTX_SPLTR)){let t=e.split(P.NAMED_DATA_CTX_SPLTR),i=t[0].trim(),s=t[1].trim();if(i&&s){let t=L.getNamedCtx(i,!1);t||(t=L.registerNamedCtx(i,{})),t.add(s,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);this.__dataCtxInitialized=!0}connectedCallback(){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let e=this.getAttribute(P.CTX_NAME_ATTR)?.trim();e&&this.style.setProperty(P.CSS_CTX_PROP,`'${e}'`),this.__initDataCtx(),this.initChildren=[...this.childNodes];for(let e of O)this.addTemplateProcessor(e);this.pauseRender?this.__initCallback():this.render()}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout((()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e)}),100))}static reg(e,t=!1){e||(B++,e=`${P.AUTO_TAG_PRFX}-${B}`),this.__tag=e,window.customElements.get(e)?console.warn(`${e} - is already in "customElements" registry`):window.customElements.define(e,t?class extends(this){}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){if(t===i)return;let s=this.constructor.__attrDesc[e];s?this.__dataCtxInitialized?this.$[s]=i:this.init$[s]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[e]=JSON.parse(i)}catch(i){!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}bindCssData(e,t=!0){let i=(t?P.EXT_DATA_CTX_PRFX:"")+e;return this.add(i,this.getCssData(e,!0)),i}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:e=>{this[s]=e,i?window.setTimeout((()=>{t?.(e)})):t?.(e)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}}const V="[Typed State] Wrong property name: ";class F{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||N.generate(),this.__schema=Object.keys(e).reduce(((t,i)=>(t[i]=e[i].value,t)),{}),this.__data=L.registerNamedCtx(this.__ctxId,this.__schema)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e))return void console.warn(V+e);let i=this.__typedSchema[e];t?.constructor===i.type||i.nullable&&null===t?this.__data.pub(e,t):console.warn("[Typed State] Wrong property type: "+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(this.__typedSchema.hasOwnProperty(e))return this.__data.read(e);console.warn(V+e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){this.__data.remove()}}class j{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||N.generate(),this.__data=L.registerNamedCtx(this.__ctxId,{}),this.__watchList=e.watchList||[],this.__handler=e.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let t=Object.create(null);this.__notifyObservers=(e,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(i),this.__observeTimeout=window.setTimeout((()=>{this.__observers.forEach((e=>{e({...t})})),t=Object.create(null)}))}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout((()=>{this.__handler?.([...this.__items])}))}add(e){let t=new F(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__watchList.forEach((e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,(()=>{this.__notifyObservers(e,t.uid)})))})),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach((e=>{this.remove(e)}))}observe(e){this.__observers.add(e)}unobserve(e){this.__observers.delete(e)}findItems(e){let t=[];return this.__items.forEach((i=>{let s=this.read(i);e(s)&&t.push(i)})),t}items(){return[...this.__items]}destroy(){this.__data.remove(),this.__observers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach((e=>{e.remove()})),delete this.__subsMap[e]}}function H(e,t){for(let i in t)i.includes("-")?e.style.setProperty(i,t[i]):e.style[i]=t[i]}function q(e={tag:"div"}){let t=document.createElement(e.tag);if(e.attributes&&function(e,t){for(let i in t)t[i].constructor===Boolean?t[i]?e.setAttribute(i,""):e.removeAttribute(i):e.setAttribute(i,t[i])}(t,e.attributes),e.styles&&H(t,e.styles),e.properties)for(let i in e.properties)t[i]=e.properties[i];return e.processors&&e.processors.forEach((e=>{e(t)})),e.children&&e.children.forEach((e=>{let i=q(e);t.appendChild(i)})),t}function K(e,t){[...e.querySelectorAll("[l10n]")].forEach((e=>{let i=e.getAttribute("l10n"),s="textContent";if(i.includes(":")){let e=i.split(":");s=e[0],i=e[1]}let n="l10n:"+i;t.__l10nKeys.push(n),t.add(n,i),t.sub(n,(i=>{e[s]=t.l10n(i)})),e.removeAttribute("l10n")}))}class X extends Error{constructor(e,t,i,s,n){super(),this.name="UploadClientError",this.message=e,this.code=t,this.request=i,this.response=s,this.headers=n,Object.setPrototypeOf(this,X.prototype)}}const W=(e="Request canceled")=>{const t=new X(e);return t.isCancel=!0,t},G=(e,t)=>{e&&(e.aborted?Promise.resolve().then(t):e.addEventListener("abort",(()=>t()),{once:!0}))},J=({method:e,url:t,data:i,headers:s={},signal:n,onProgress:r})=>new Promise(((a,o)=>{const l=new XMLHttpRequest,c=(null==e?void 0:e.toUpperCase())||"GET";let h=!1;l.open(c,t),s&&Object.entries(s).forEach((e=>{const[t,i]=e;void 0!==i&&!Array.isArray(i)&&l.setRequestHeader(t,i)})),l.responseType="text",G(n,(()=>{h=!0,l.abort(),o(W())})),l.onload=()=>{if(200!=l.status)o(new Error(`Error ${l.status}: ${l.statusText}`));else{const e={method:c,url:t,data:i,headers:s||void 0,signal:n,onProgress:r},o=l.getAllResponseHeaders().trim().split(/[\r\n]+/),h={};o.forEach((function(e){const t=e.split(": "),i=t.shift(),s=t.join(": ");i&&void 0!==i&&(h[i]=s)}));const d=l.response,u=l.status;a({request:e,data:d,headers:h,status:u})}},l.onerror=()=>{h||o(new Error("Network error"))},r&&"function"==typeof r&&(l.upload.onprogress=e=>{e.lengthComputable?r({isComputable:!0,value:e.loaded/e.total}):r({isComputable:!1})}),i?l.send(i):l.send()}));const Z=function(e){return e};const Y=e=>"file"===e[0];function Q(e){const t=new FormData;for(const i of e)if(Array.isArray(i[1]))i[1].forEach((e=>e&&t.append(i[0]+"[]",`${e}`)));else if(Y(i)){const e=i[2],s=Z(i[1]);t.append(i[0],s,e)}else null!=i[1]&&t.append(i[0],`${i[1]}`);return t}const ee=(e,t)=>void 0!==t?`${e}=${encodeURIComponent(t)}`:null,te=e=>Object.entries(e).reduce(((e,[t,i])=>e.concat(Array.isArray(i)?i.map((e=>ee(`${t}[]`,e))):ee(t,i))),[]).filter((e=>!!e)).join("&"),ie=(e,t,i)=>[e,t,i&&Object.keys(i).length>0?"?":"",i&&te(i)].filter(Boolean).join(""),se="https://ucarecdn.com",ne="https://upload.uploadcare.com",re=1,ae=26214400,oe=5242880,le=4,ce=3,he="79ae88bd931ea68464d9",de="original";function ue({userAgent:e,publicKey:t="",integration:i=""}={}){const s="UploadcareUploadClient",n="3.0.0",r="JavaScript";if("string"==typeof e)return e;if("function"==typeof e)return e({publicKey:t,libraryName:s,libraryVersion:n,languageName:r,integration:i});return`${[s,n,t].filter(Boolean).join("/")} (${[r,i].filter(Boolean).join("; ")})`}const pe=/\W|_/g;function me(e){return e&&"object"==typeof e?Object.keys(e).reduce(((t,i)=>(t[function(e){return e.split(pe).map(((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1))).join("")}(i)]="object"==typeof e[i]?me(e[i]):e[i],t)),{}):e}const ge={factor:2,time:100};function be(e,t=ge){let i=0;return function e(s){const n=Math.round(t.time*Math.pow(t.factor,i));return s({attempt:i,retry:t=>(e=>new Promise((t=>setTimeout(t,e))))(null!=t?t:n).then((()=>(i+=1,e(s))))})}(e)}function fe(e,t){return be((({attempt:i,retry:s})=>e().catch((e=>{if("response"in e&&"RequestThrottledError"===(null==e?void 0:e.code)&&i<t)return s(function(e){const{headers:t}=e||{};return t&&1e3*Number.parseInt(t["x-throttle-wait-seconds"])||15e3}(e));throw e}))))}var _e,ve;!function(e){e.Token="token",e.FileInfo="file_info"}(_e||(_e={})),function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"}(ve||(ve={}));function ye(e,{publicKey:t,baseURL:i=ne,signal:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a=re}={}){return fe((()=>J({method:"GET",headers:t?{"X-UC-User-Agent":ue({publicKey:t,integration:n,userAgent:r})}:void 0,url:ie(i,"/from_url/status/",{jsonerrors:1,token:e}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s&&!(e=>"status"in e&&e.status===ve.Error)(s))throw new X(s.error.content,void 0,i,s,t);return s}))),a)}function we(e,{publicKey:t,baseURL:i=ne,signal:s,source:n,integration:r,userAgent:a,retryThrottledRequestMaxTimes:o=re}){return fe((()=>J({method:"GET",headers:{"X-UC-User-Agent":ue({publicKey:t,integration:r,userAgent:a})},url:ie(i,"/info/",{jsonerrors:1,pub_key:t,file_id:e,source:n}),signal:s}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s)throw new X(s.error.content,s.error.errorCode,i,s,t);return s}))),o)}class $e{constructor(e,{baseCDN:t,defaultEffects:i,fileName:s}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.cdnUrlModifiers=null,this.originalUrl=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null;const{uuid:n,s3Bucket:r}=e,a=r?`https://${r}.s3.amazonaws.com/${n}/${e.filename}`:`${t}/${n}/`,o=i?`-/${i}`:null,l=`${a}${o||""}`,c=n?a:null;this.uuid=n,this.name=s||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=l,this.cdnUrlModifiers=o,this.originalUrl=c,this.originalFilename=e.originalFilename,this.imageInfo=me(e.imageInfo),this.videoInfo=me(e.videoInfo)}}const Ce=({check:e,interval:t=500,signal:i})=>new Promise(((s,n)=>{let r;G(i,(()=>{r&&clearTimeout(r),n(W("Poll cancelled"))}));const a=()=>{try{Promise.resolve(e(i)).then((e=>{e?s(e):r=setTimeout(a,t)})).catch((e=>n(e)))}catch(e){n(e)}};r=setTimeout(a,0)}));function xe({file:e,publicKey:t,baseURL:i,source:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a,signal:o,onProgress:l}){return Ce({check:o=>we(e,{publicKey:t,baseURL:i,signal:o,source:s,integration:n,userAgent:r,retryThrottledRequestMaxTimes:a}).then((e=>e.isReady?e:(l&&l({isComputable:!0,value:1}),!1))),signal:o})}const Te=(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:p})=>function(e,{publicKey:t,fileName:i,baseURL:s=ne,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c="local",integration:h,userAgent:d,retryThrottledRequestMaxTimes:u=re}){return fe((()=>{var u;return J({method:"POST",url:ie(s,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ue({publicKey:t,integration:h,userAgent:d})},data:Q([["file",e,null!==(u=null!=i?i:e.name)&&void 0!==u?u:de],["UPLOADCARE_PUB_KEY",t],["UPLOADCARE_STORE",void 0===a?"auto":a?1:0],["signature",n],["expire",r],["source",c]]),signal:o,onProgress:l}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s)throw new X(s.error.content,s.error.errorCode,i,s,t);return s}))}),u)}(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u}).then((({file:e})=>xe({file:e,publicKey:t,baseURL:s,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,onProgress:l,signal:o}))).then((e=>new $e(e,{baseCDN:p}))),{AbortController:Ae,AbortSignal:ke}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0,Ee=(e,{signal:t}={})=>{let i=null,s=null;const n=e.map((()=>new Ae));return G(t,(()=>{n.forEach((e=>e.abort()))})),Promise.all(e.map(((e,t)=>{const r=(e=>()=>{s=e,n.forEach(((t,i)=>i!==e&&t.abort()))})(t);return Promise.resolve().then((()=>e({stopRace:r,signal:n[t].signal}))).then((e=>(r(),e))).catch((e=>(i=e,null)))}))).then((e=>{if(null===s)throw i;return e[s]}))};var Se=window.WebSocket;class Ie{constructor(){this.events=Object.create({})}emit(e,t){var i;null===(i=this.events[e])||void 0===i||i.forEach((e=>e(t)))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){this.events[e]=t?this.events[e].filter((e=>e!==t)):[]}}class Le{constructor(e,t=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Ie,this.disconnectTimeoutId=null,this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Se(e),this.ws.addEventListener("error",(e=>{this.emmitter.emit("error",new Error(e.message))})),this.emmitter.on("connected",(()=>{this.isConnected=!0,this.queue.forEach((e=>this.send(e.event,e.data))),this.queue=[]})),this.ws.addEventListener("message",(e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":this.emmitter.emit("connected",void 0);break;case"pusher:ping":this.send("pusher:pong",{});break;case"progress":case"success":case"fail":this.emmitter.emit(t.channel,((e,t)=>"success"===e?Object.assign({status:ve.Success},t):"progress"===e?Object.assign({status:ve.Progress},t):Object.assign({status:ve.Error},t))(t.event,JSON.parse(t.data)))}}))}}disconnect(){const e=()=>{var e;null===(e=this.ws)||void 0===e||e.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout((()=>{e()}),this.disconnectTime):e()}send(e,t){var i;const s=JSON.stringify({event:e,data:t});null===(i=this.ws)||void 0===i||i.send(s)}subscribe(e,t){this.subscribers+=1,this.connect();const i=`task-status-${e}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(e){this.subscribers-=1;const t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter((e=>e.data.channel!==t)),0===this.subscribers&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}}let Pe=null;const Ue=e=>{if(!Pe){const t="undefined"==typeof window?0:3e4;Pe=new Le(e,t)}return Pe};const Re=(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:n,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,onProgress:d,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,pusherKey:b=he})=>{return Promise.resolve((f=b,void Ue(f).connect())).then((()=>function(e,{publicKey:t,baseURL:i=ne,store:s,fileName:n,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,source:c="url",signal:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=re}){return fe((()=>J({method:"POST",headers:{"X-UC-User-Agent":ue({publicKey:t,integration:d,userAgent:u})},url:ie(i,"/from_url/",{jsonerrors:1,pub_key:t,source_url:e,store:void 0===s?"auto":s?1:void 0,filename:n,check_URL_duplicates:r?1:void 0,save_URL_duplicates:a?1:void 0,signature:o,expire:l,source:c}),signal:h}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s)throw new X(s.error.content,s.error.errorCode,i,s,t);return s}))),p)}(e,{publicKey:t,fileName:i,baseURL:s,checkForUrlDuplicates:r,saveUrlForRecurrentUploads:a,secureSignature:o,secureExpire:l,store:c,signal:h,source:u,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g}))).catch((e=>{const t=Ue(b);return null==t||t.disconnect(),Promise.reject(e)})).then((e=>e.type===_e.FileInfo?e:Ee([({signal:i})=>function({token:e,publicKey:t,baseURL:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:r,onProgress:a,signal:o}){return Ce({check:o=>ye(e,{publicKey:t,baseURL:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:r,signal:o}).then((t=>{switch(t.status){case ve.Error:return new X(t.error,t.errorCode);case ve.Waiting:return!1;case ve.Unknown:return new X(`Token "${e}" was not found.`);case ve.Progress:return a&&("unknown"===t.total?a({isComputable:!1}):a({isComputable:!0,value:t.done/t.total})),!1;case ve.Success:return a&&a({isComputable:!0,value:t.done/t.total}),t;default:throw new Error("Unknown status")}})),signal:o})}({token:e.token,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:i}),({signal:t})=>(({token:e,pusherKey:t,signal:i,onProgress:s})=>new Promise(((n,r)=>{const a=Ue(t),o=a.onError(r),l=()=>{o(),a.unsubscribe(e)};G(i,(()=>{l(),r(W("pusher cancelled"))})),a.subscribe(e,(e=>{switch(e.status){case ve.Progress:s&&("unknown"===e.total?s({isComputable:!1}):s({isComputable:!0,value:e.done/e.total}));break;case ve.Success:l(),s&&s({isComputable:!0,value:e.done/e.total}),n(e);break;case ve.Error:l(),r(new X(e.msg,e.error_code))}}))})))({token:e.token,pusherKey:b,signal:t,onProgress:d})],{signal:h}))).then((e=>{if(e instanceof X)throw e;return e})).then((e=>xe({file:e.uuid,publicKey:t,baseURL:s,integration:p,userAgent:m,retryThrottledRequestMaxTimes:g,onProgress:d,signal:h}))).then((e=>new $e(e,{baseCDN:n})));var f},Ne=e=>void 0!==e&&("undefined"!=typeof Blob&&e instanceof Blob||"undefined"!=typeof File&&e instanceof File||"undefined"!=typeof Buffer&&e instanceof Buffer),Me=e=>e.length||e.size;function De(e,t,i){return s=>((e,t,i,s)=>{const n=s*t,r=Math.min(n+s,i);return e.slice(n,r)})(e,s,t,i)}const Oe=(e,t,{publicKey:i,onProgress:s,signal:n,integration:r,multipartMaxAttempts:a})=>be((({attempt:o,retry:l})=>function(e,t,{signal:i,onProgress:s}){return J({method:"PUT",url:t,data:e,onProgress:s,signal:i}).then((e=>(s&&s({isComputable:!0,value:1}),e))).then((({status:e})=>({code:e})))}(e,t,{publicKey:i,onProgress:s,signal:n,integration:r}).catch((e=>{if(o<a)return l();throw e})))),Be=(e,{publicKey:t,fileName:i,fileSize:s,baseURL:n,secureSignature:r,secureExpire:a,store:o,signal:l,onProgress:c,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,contentType:m,multipartChunkSize:g=oe,maxConcurrentRequests:b=le,multipartMaxAttempts:f=ce,baseCDN:_})=>{const v=s||Me(e);let y;const w=(e,t)=>{if(!c)return;y||(y=Array(e).fill(0));return i=>{var s;i.isComputable&&(y[t]=i.value,c({isComputable:!0,value:(s=y,s.reduce(((e,t)=>e+t),0)/e)}))}};return function(e,{publicKey:t,contentType:i,fileName:s,multipartChunkSize:n=oe,baseURL:r="",secureSignature:a,secureExpire:o,store:l,signal:c,source:h="local",integration:d,userAgent:u,retryThrottledRequestMaxTimes:p=re}){return fe((()=>J({method:"POST",url:ie(r,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ue({publicKey:t,integration:d,userAgent:u})},data:Q([["filename",null!=s?s:de],["size",e],["content_type",null!=i?i:"application/octet-stream"],["part_size",n],["UPLOADCARE_STORE",l?"":"auto"],["UPLOADCARE_PUB_KEY",t],["signature",a],["expire",o],["source",h]]),signal:c}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s)throw new X(s.error.content,s.error.errorCode,i,s,t);return s.parts=Object.keys(s.parts).map((e=>s.parts[e])),s}))),p)}(v,{publicKey:t,contentType:m,fileName:null!=i?i:e.name,baseURL:n,secureSignature:r,secureExpire:a,store:o,signal:l,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p}).then((({uuid:i,parts:s})=>{const n=De(e,v,g);return Promise.all([i,(r=b,a=s.map(((e,i)=>()=>Oe(n(i),e,{publicKey:t,onProgress:w(s.length,i),signal:l,integration:d,multipartMaxAttempts:f}))),new Promise(((e,t)=>{const i=[];let s=!1,n=a.length;const o=[...a],l=()=>{const r=a.length-o.length,c=o.shift();c&&c().then((t=>{s||(i[r]=t,n-=1,n?l():e(i))})).catch((e=>{s=!0,t(e)}))};for(let e=0;e<r;e++)l()})))]);var r,a})).then((([e])=>function(e,{publicKey:t,baseURL:i=ne,source:s="local",signal:n,integration:r,userAgent:a,retryThrottledRequestMaxTimes:o=re}){return fe((()=>J({method:"POST",url:ie(i,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ue({publicKey:t,integration:r,userAgent:a})},data:Q([["uuid",e],["UPLOADCARE_PUB_KEY",t],["source",s]]),signal:n}).then((({data:e,headers:t,request:i})=>{const s=me(JSON.parse(e));if("error"in s)throw new X(s.error.content,s.error.errorCode,i,s,t);return s}))),o)}(e,{publicKey:t,baseURL:n,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p}))).then((e=>e.isReady?e:xe({file:e.uuid,publicKey:t,baseURL:n,source:h,integration:d,userAgent:u,retryThrottledRequestMaxTimes:p,onProgress:c,signal:l}))).then((e=>new $e(e,{baseCDN:_})))};function ze(e,{publicKey:t,fileName:i,baseURL:s=ne,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,contentType:p,multipartChunkSize:m,multipartMaxAttempts:g,maxConcurrentRequests:b,baseCDN:f=se,checkForUrlDuplicates:_,saveUrlForRecurrentUploads:v,pusherKey:y}){if(Ne(e)){return((e,t=ae)=>e>=t)(Me(e))?Be(e,{publicKey:t,contentType:p,multipartChunkSize:m,multipartMaxAttempts:g,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,maxConcurrentRequests:b,retryThrottledRequestMaxTimes:u,baseCDN:f}):Te(e,{publicKey:t,fileName:i,baseURL:s,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:f})}if((e=>{const t=new RegExp("^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$");return!Ne(e)&&t.test(e)})(e))return Re(e,{publicKey:t,fileName:i,baseURL:s,baseCDN:f,checkForUrlDuplicates:_,saveUrlForRecurrentUploads:v,secureSignature:n,secureExpire:r,store:a,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,pusherKey:y});if((e=>{const t=new RegExp("[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}");return!Ne(e)&&t.test(e)})(e))return((e,{publicKey:t,fileName:i,baseURL:s,signal:n,onProgress:r,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c,baseCDN:h})=>we(e,{publicKey:t,baseURL:s,signal:n,source:a,integration:o,userAgent:l,retryThrottledRequestMaxTimes:c}).then((e=>new $e(e,{baseCDN:h,fileName:i}))).then((e=>(r&&r({isComputable:!0,value:1}),e))))(e,{publicKey:t,fileName:i,baseURL:s,signal:o,onProgress:l,source:c,integration:h,userAgent:d,retryThrottledRequestMaxTimes:u,baseCDN:f});throw new TypeError(`File uploading from "${e}" is not supported`)}const Ve=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:X,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},transformationsUrl:{type:String,value:null},fileInfo:{type:$e,value:null},isUploading:{type:Boolean,value:!1}}),Fe="active",je="___ACTIVITY_IS_ACTIVE___";let He="complete"===document.readyState;He||window.addEventListener("load",(()=>{He=!0}));class qe extends z{l10n(e){return this.getCssData("--l10n-"+e,!0)||e}constructor(){super(),this.activityType=null,this.addTemplateProcessor(K),this.__l10nKeys=[],this.__l10nUpdate=()=>{this.dropCssDataCache();for(let e of this.__l10nKeys)this.notify(e)},window.addEventListener("uc-l10n-update",this.__l10nUpdate)}applyL10nKey(e,t){this.$["l10n:"+e]=t}historyBack(){let e=this.$["*history"];e.pop();let t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e}addFiles(e){e.forEach((e=>{this.uploadCollection.add({file:e,isImage:e.type.includes("image"),mimeType:e.type,fileName:e.name,fileSize:e.size})}))}connectedCallback(){let e=()=>{He?this.connected():window.addEventListener("load",(()=>{this.connected()}))},t=this.getAttribute("css-src");if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame((()=>{e()}))},this.shadowRoot.appendChild(i)}else e()}__bindBasicCssData(){if(!qe._cssDataBindingsList.includes(this.ctxName)){["pubkey","store","multiple","max-files","accept","confirm-upload","init-activity","done-activity"].forEach((e=>{this.bindCssData(`--cfg-${e}`)}),!0),qe._cssDataBindingsList.push(this.ctxName)}}initCallback(){this.__bindBasicCssData()}connected(){this.__connectedOnce?super.connectedCallback():(qe._ctxConnectionsList.includes(this.ctxName)||(this.add$({"*ctxTargetsRegistry":new Set,"*currentActivity":"","*currentActivityParams":{},"*history":[],"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null}),qe._ctxConnectionsList.push(this.ctxName)),this.$["*ctxTargetsRegistry"].add(this.constructor.is),super.connectedCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",(e=>{let t=this.ctxName+this.activityType,i=qe._activityRegistry[t];if(this.activityType!==e&&this[je])this[je]=!1,this.removeAttribute(Fe),i?.deactivateCallback?.();else if(this.activityType===e&&!this[je]){this[je]=!0,this.setAttribute(Fe,""),i?.activateCallback?.();let e=this.$["*history"];e.length>10&&(e=e.slice(e.length-11,e.length-1)),e.push(this.activityType),this.$["*history"]=e}}))),this.__connectedOnce=!0)}openSystemDialog(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.$["*--cfg-multiple"],this.fileInput.max=this.$["*--cfg-max-files"],this.fileInput.accept=this.$["*--cfg-accept"],this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=qe.activities.UPLOAD_LIST,this.fileInput.value="",this.fileInput=null}}get sourceList(){let e=null;return this.$["*--cfg-source-list"]&&(e=this.$["*--cfg-source-list"].split(",").map((e=>e.trim()))),e}get initActivity(){return this.$["*--cfg-init-activity"]}get doneActivity(){return this.$["*--cfg-done-activity"]}get isActivityActive(){return this[je]}initFlow(e=!1){if(this.$["*uploadList"]?.length&&!e)this.set$({"*currentActivity":qe.activities.UPLOAD_LIST}),this.setForCtxTarget("uc-modal","*modalActive",!0);else if(1===this.sourceList?.length){let e=this.sourceList[0];"local"===e?(this.$["*currentActivity"]=qe.activities.UPLOAD_LIST,this.openSystemDialog()):(Object.values(qe.extSrcList).includes(e)?this.set$({"*currentActivityParams":{externalSourceType:e},"*currentActivity":qe.activities.EXTERNAL}):this.$["*currentActivity"]=e,this.setForCtxTarget("uc-modal","*modalActive",!0))}else this.set$({"*currentActivity":qe.activities.START_FROM}),this.setForCtxTarget("uc-modal","*modalActive",!0)}cancelFlow(){1===this.sourceList?.length?(this.$["*currentActivity"]=null,this.setForCtxTarget("uc-modal","*modalActive",!1)):(this.historyBack(),this.$["*currentActivity"]||this.setForCtxTarget("uc-modal","*modalActive",!1))}checkCtxTarget(e){return this.$["*ctxTargetsRegistry"].has(e)}setForCtxTarget(e,t,i){this.checkCtxTarget(e)&&(this.$[t]=i)}registerActivity(e,t,i){qe._activityRegistry||(qe._activityRegistry=Object.create(null));let s=this.ctxName+e;qe._activityRegistry[s]={activateCallback:t,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get uploadCollection(){if(!this.has("*uploadCollection")){let e=new j({typedSchema:Ve,watchList:["uploadProgress","uuid"],handler:e=>{this.$["*uploadList"]=e}});e.observe((t=>{if(t.uploadProgress){let t=0,i=e.findItems((e=>!e.getValue("uploadError")));i.forEach((i=>{t+=e.readProp(i,"uploadProgress")})),this.$["*commonProgress"]=t/i.length}})),this.add("*uploadCollection",e)}return this.$["*uploadCollection"]}fileSizeFmt(e,t=2){let i=["B","KB","MB","GB","TB"],s=e=>this.getCssData("--l10n-unit-"+e.toLowerCase(),!0)||e;if(0===e)return`0 ${s(i[0])}`;let n=t<0?0:t,r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/1024**r).toFixed(n))+" "+s(i[r])}output(){let e=[];this.uploadCollection.items().forEach((t=>{let i=L.getNamedCtx(t).store.fileInfo;e.push(i)})),this.$["*outputData"]=e}destroyCallback(){window.removeEventListener("uc-l10n-update",this.__l10nUpdate),this.__l10nKeys=null}static reg(e){e?super.reg(e.startsWith("uc-")?e:"uc-"+e):super.reg()}static _activityRegistry=Object.create(null);static _ctxConnectionsList=[];static _cssDataBindingsList=[]}qe.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"}),qe.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),qe.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...qe.extSrcList});class Ke extends qe{init$={name:"",path:"",size:"24",viewBox:""};initCallback(){super.initCallback(),this.sub("name",(e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)})),this.sub("path",(e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path d="${e}"></path>`)})),this.sub("size",(e=>{this.$.viewBox=`0 0 ${e} ${e}`}))}}Ke.template='\n<svg\n  ref="svg"\n  xmlns="http://www.w3.org/2000/svg"\n  set="@viewBox: viewBox; @height: size; @width: size">\n</svg>\n',Ke.bindAttributes({name:"name",size:"size"});const Xe={"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{},"proxy-cname":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}},We="--uc-img-",Ge="unresolved",Je=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost");function Ze(...e){return e.map((e=>(e?.trim()&&!e.endsWith("/")&&(e+="/"),e))).join("")}class Ye extends z{$$(e){return this.$[We+e]}set$$(e){for(let t in e)this.$[We+t]=e[t]}sub$$(e,t){this.sub(We+e,(e=>{null!==e&&""!==e&&t(e)}))}_fmtAbs(e){return!e.includes("//")&&!Je&&(e=new URL(e,document.baseURI).href),e}_getOps(e=""){return Ze(e?"-/resize/"+e:"",this.$$("cdn-operations")?"-/"+this.$$("cdn-operations"):"","-/format/"+this.$$("format"),"-/quality/"+this.$$("quality"))}_getUrlBase(e=""){if(Je&&this.$$("src")&&!this.$$("src").includes("//"))return this.$$("src");let t=this._getOps(e);if(this.$$("cdn-cname")&&this.$$("uuid"))return Ze(this.$$("cdn-cname"),this.$$("uuid"),t);if(this.$$("uuid"))return Ze("https://ucarecdn.com/",this.$$("uuid"),t);if(this.$$("proxy-cname")){return Ze(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src")))+this._fmtAbs(this.$$("src"))}if(this.$$("pubkey")){return Ze(`https://${this.$$("pubkey")}.ucr.io/`,t)+this._fmtAbs(this.$$("src"))}}_getElSize(e,t=1,i=!0){let s=e.getBoundingClientRect(),n=t*Math.round(s.width),r=i?"":t*Math.round(s.height);return`${n||""}x${r||""}`}initCallback(){for(let e in Xe){let t=We+e;this.bindCssData(t,!1),null===this.$$(e)&&Xe[e].hasOwnProperty("default")&&this.set$$({[e]:Xe[e].default})}}get img(){return this._img||(this._img=new Image,this._img.setAttribute(Ge,""),this.img.onload=()=>{this.img.removeAttribute(Ge)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach((e=>{Xe[e.name]||this.img.setAttribute(e.name,e.value)}))}get breakpoints(){return this.$$("breakpoints")?this.$$("breakpoints").split(",").map((e=>parseFloat(e.trim()))):null}renderBg(e){let t=[];this.breakpoints?this.breakpoints.forEach((e=>{t.push(`url("${this._getUrlBase(e+"x")}") ${e}w`),this.$$("hi-res-support")&&t.push(`url("${this._getUrlBase(2*e+"x")}") ${2*e}w`),this.$$("ultra-res-support")&&t.push(`url("${this._getUrlBase(3*e+"x")}") ${3*e}w`)})):(t.push(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.push(`url("${this._getUrlBase(this._getElSize(e,2))}") 2x`),this.$$("ultra-res-support")&&t.push(`url("${this._getUrlBase(this._getElSize(e,3))}") 3x`));let i=`image-set(${t.join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=[];return this.breakpoints?this.breakpoints.forEach((t=>{e.push(this._getUrlBase(t+"x")+` ${t}w`),this.$$("hi-res-support")&&e.push(this._getUrlBase(2*t+"x")+` ${2*t}w`),this.$$("ultra-res-support")&&e.push(this._getUrlBase(3*t+"x")+` ${3*t}w`)})):(e.push(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.push(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.push(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),e.join()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach((e=>{this.$$("intersection")?this.initIntersection(e,(()=>{this.renderBg(e)})):this.renderBg(e)})):this.$$("intersection")?this.initIntersection(this.img,(()=>{this.img.srcset=this.getSrcset()})):this.img.srcset=this.getSrcset()}initIntersection(e,t){this._isnObserver=new IntersectionObserver((i=>{i.forEach((i=>{i.isIntersecting&&(t(),this._isnObserver.unobserve(e))}))}),{root:null,rootMargin:"0px"}),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){this._isnObserver&&(this._observed.forEach((e=>{this._isnObserver.unobserve(e)})),this._isnObserver=null)}static get observedAttributes(){return Object.keys(Xe)}attributeChangedCallback(e,t,i){window.setTimeout((()=>{this.$[We+e]=i}))}}class Qe extends qe{init$={"*simpleButtonText":"",onClick:()=>{this.initFlow()}};initCallback(){super.initCallback();let e=this.bindCssData("--cfg-multiple");this.sub(e,(e=>{this.$["*simpleButtonText"]=e?this.l10n("upload-files"):this.l10n("upload-file")}))}}Qe.template='\n<uc-drop-area>\n  <button set="onclick: onClick">\n    <uc-icon name="upload"></uc-icon>\n    <span>{{*simpleButtonText}}</span>\n    <slot></slot>\n  </button>\n</uc-drop-area>\n';function et(e){return new Promise((t=>{"function"!=typeof window.FileReader&&t(!1);try{let i=new FileReader;i.onerror=()=>{t(!0)};let s=e=>{"loadend"!==e.type&&i.abort(),t(!1)};i.onloadend=s,i.onprogress=s,i.readAsDataURL(e)}catch(e){t(!1)}}))}function tt(e){return new Promise(((t,i)=>{let s=0,n=[],r=e=>{e||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),e.isFile?(s++,e.file((e=>{s--,n.push(e),0===s&&t(n)}))):e.isDirectory&&a(e.createReader())},a=e=>{s++,e.readEntries((e=>{s--;for(let t of e)r(t);0===s&&t(n)}))};r(e)}))}const it={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let st=["dragleave","dragexit","dragend","drop","mouseleave","mouseout"],nt=new Map;function rt(e){let t=new Set,i=e=>t.add(e),s=it.INACTIVE,n=e=>{s!==e&&t.forEach((t=>t(e))),s=e},r=e=>{let{clientX:t,clientY:i}=e,s=document.body.getBoundingClientRect(),r="drop"===e.type,a=["dragleave","dragexit","dragend"].includes(e.type)&&0===t&&0===i,o=["mouseleave","mouseout"].includes(e.type)&&(t<0||t>s.width||i<0||i>s.height);(r||a||o)&&n(it.INACTIVE),e.preventDefault()};i((t=>e.onChange(t))),i((e=>{e===it.ACTIVE&&st.forEach((e=>{window.addEventListener(e,r,!1)}))})),i((e=>{e===it.INACTIVE&&st.forEach((e=>{window.removeEventListener(e,r,!1)}))}));let a=t=>{t.preventDefault(),s===it.INACTIVE&&n(it.ACTIVE);let i=[t.x,t.y],r=e.element.getBoundingClientRect(),a=Math.floor(function(e,t){let i=Math.max(Math.min(e[0],t.x+t.width),t.x),s=Math.max(Math.min(e[1],t.y+t.height),t.y);return Math.sqrt((e[0]-i)*(e[0]-i)+(e[1]-s)*(e[1]-s))}(i,r)),o=a<100,l=t.composedPath().includes(e.element);nt.set(e.element,a);let c=Math.min(...nt.values())===a;n(l&&c?it.OVER:o&&c?it.NEAR:it.ACTIVE)};window.addEventListener("dragover",a,!1);let o=async t=>{t.preventDefault();let i=await function(e){let t=[],i=[];for(let s=0;s<e.items.length;s++){let n=e.items[s];if(n&&"file"===n.kind){if("function"==typeof n.webkitGetAsEntry||"function"==typeof n.getAsEntry){let e="function"==typeof n.webkitGetAsEntry?n.webkitGetAsEntry():n.getAsEntry();i.push(tt(e).then((e=>{t.push(...e)})));continue}let e=n.getAsFile();i.push(et(e).then((i=>{i||t.push(e)})))}}return Promise.all(i).then((()=>t))}(t.dataTransfer);e.onFiles(i),n(it.INACTIVE)};return e.element.addEventListener("drop",o),()=>{nt.delete(e.element),window.removeEventListener("dragover",a,!1),e.element.removeEventListener("drop",o),st.forEach((e=>{window.removeEventListener(e,r,!1)}))}}class at extends qe{_registeredTypes={};init$={iconName:"default"};initTypes(){this.registerType({type:qe.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:qe.sourceTypes.URL,activity:qe.activities.URL,textKey:"from-url"}),this.registerType({type:qe.sourceTypes.CAMERA,activity:qe.activities.CAMERA}),this.registerType({type:"draw",activity:qe.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(qe.extSrcList))this.registerType({type:e,activity:qe.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",(e=>{e&&this.applyType(e)}))}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){const t=this._registeredTypes[e];if(!t)return void console.warn("Unsupported source type: "+e);const{textKey:i=e,icon:s=e,activity:n,onClick:r,activityParams:a={}}=t;this.applyL10nKey("src-type",`src-type-${i}`),this.$.iconName=s,this.onclick=e=>{n&&this.set$({"*currentActivityParams":a,"*currentActivity":n}),r&&r(e)}}}at.template='\n<uc-icon set="@name: iconName"></uc-icon>\n<div class="txt" l10n="src-type"></div>\n',at.bindAttributes({type:null});class ot{caption="";text="";iconName="";isError=!1}class lt extends qe{init$={iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}};initCallback(){this.sub("*message",(e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption,msgTxt:e.text,iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")}))}}function ct(e){let t=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(t)}function ht(e="hsl(0, 0%, 100%)",t=36,i=36){return ct(`\n  <svg width="${t}" height="${i}" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z" fill="black" fill-opacity="0.06"/>\n    <path d="M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z" fill="black" fill-opacity="0.06"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="${e}"/>\n    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="url(#paint0_linear_2735_2136)"/>\n    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z" fill="url(#paint1_radial_2735_2136)"/>\n    <path d="M21 8L26 13V14H20V8H21Z" fill="black" fill-opacity="0.03"/>\n    <path d="M21 8L26 13V13.5H20.5V8H21Z" fill="black" fill-opacity="0.08"/>\n    <path d="M21 8L26 13H21V8Z" fill="${e}"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint2_linear_2735_2136)"/>\n    <path d="M21 8L26 13H21V8Z" fill="url(#paint3_linear_2735_2136)"/>\n    <path d="M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z" fill="url(#paint4_linear_2735_2136)"/>\n    <defs>\n      <linearGradient id="paint0_linear_2735_2136" x1="18" y1="8" x2="18" y2="28.0027" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.06"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n      <radialGradient id="paint1_radial_2735_2136" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10 11) rotate(53.7462) scale(18.6011 18.0323)">\n        <stop stop-color="white" stop-opacity="0.12"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </radialGradient>\n      <linearGradient id="paint2_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop offset="0.40625" stop-opacity="0"/>\n        <stop offset="1" stop-opacity="0.04"/>\n      </linearGradient>\n      <linearGradient id="paint3_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.16"/>\n        <stop offset="1" stop-color="white" stop-opacity="0.06"/>\n      </linearGradient>\n      <linearGradient id="paint4_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">\n        <stop stop-color="white" stop-opacity="0.15"/>\n        <stop offset="1" stop-color="white" stop-opacity="0"/>\n      </linearGradient>\n    </defs>\n</svg>\n  `)}lt.template='\n<div class="heading">\n  <uc-icon set="@name: iconName"></uc-icon>\n  <div class="caption">{{captionTxt}}</div>\n  <button set="onclick: onClose">\n    <uc-icon name="close"></uc-icon>\n  </button>\n</div>\n<div class="msg">{{msgTxt}}</div>\n';function dt({publicKey:e,languageName:t}){return`uc-blocks/0.1.2/${e} (${t})`}class ut extends qe{pauseRender=!0;init$={itemName:"",thumb:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,notImage:!0,badgeIcon:"check","*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this.entry,"*currentActivity":qe.activities.DETAILS})},onRemove:()=>{this.uploadCollection.remove(this.uid)},onUpload:()=>{this.upload()}};_observerCallback(e){let[t]=e;0===t.intersectionRatio?(clearTimeout(this._thumbTimeoutId),this._thumbTimeoutId=void 0):this._thumbTimeoutId||(this._thumbTimeoutId=window.setTimeout((()=>this._generateThumbnail()),100))}_generateThumbnail(){if(!this.$.thumbUrl)if(this.file?.type.includes("image"))(function(e,t=40){let i=document.createElement("canvas"),s=i.getContext("2d"),n=new Image,r=new Promise(((e,r)=>{n.onload=()=>{let r=n.height/n.width;r>1?(i.width=t,i.height=t*r):(i.height=t,i.width=t/r),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(n,0,0,i.width,i.height),i.toBlob((t=>{let i=URL.createObjectURL(t);e(i)}),"image/png")},n.onerror=e=>{console.warn("Resize error..."),r(e)}}));return n.src=URL.createObjectURL(e),r})(this.file,this.$["*--cfg-thumb-size"]||76).then((e=>{this.$.thumbUrl=`url(${e})`}));else{let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");this.$.thumbUrl=`url(${ht(e)})`}}_revokeThumbUrl(){this.$.thumbUrl?.startsWith("blob:")&&URL.revokeObjectURL(this.$.thumbUrl)}initCallback(){super.initCallback(),this.bindCssData("--cfg-thumb-size"),this.defineAccessor("entry-id",(e=>{e&&e!==this.uid&&(this.uid=e,this.entry=this.uploadCollection?.read(e),this.entry&&(this.entry.subscribe("isUploading",(e=>{this.$.progressVisible=e})),this.entry.subscribe("uploadProgress",(e=>{this.$.progressValue=e})),this.entry.subscribe("fileName",(e=>{this.$.itemName=e||this.externalUrl||this.l10n("file-no-name")})),this.entry.subscribe("externalUrl",(e=>{this.$.itemName=this.entry.getValue("fileName")||e||this.l10n("file-no-name")})),this.entry.subscribe("uuid",(e=>{if(e&&(this._observer.unobserve(this),this.setAttribute("loaded",""),this.entry.getValue("isImage"))){let t=`https://ucarecdn.com/${e}/`;this._revokeThumbUrl();let i=this.$["*--cfg-thumb-size"]||76;this.$.thumbUrl=`url(${t}-/scale_crop/${i}x${i}/center/)`}})),this.entry.subscribe("transformationsUrl",(e=>{if(e&&this.entry.getValue("isImage")){this._revokeThumbUrl();let t=this.$["*--cfg-thumb-size"]||76;this.$.thumbUrl=`url(${e}-/scale_crop/${t}x${t}/center/)`}})),this.file=this.entry.getValue("file"),this.externalUrl=this.entry.getValue("externalUrl"),this.$["*--cfg-confirm-upload"]||this.upload(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)))})),this.$["*uploadTrigger"]=null,ut.activeInstances.add(this),this.sub("*uploadTrigger",(e=>{e&&this.isConnected&&this.upload()})),this.onclick=()=>{ut.activeInstances.forEach((e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")}))}}destroyCallback(){ut.activeInstances.delete(this),this._observer.unobserve(this),clearTimeout(this._thumbTimeoutId)}async upload(){if(this.hasAttribute("loaded")||this.entry.getValue("uuid"))return;this.entry.setValue("isUploading",!0),this.entry.setValue("uploadError",null),this.removeAttribute("focused"),this.removeAttribute("error"),this.setAttribute("uploading","");let e={},t=this.$["*--cfg-store"];null!==t&&(e.store=!!t),!this.file&&this.externalUrl&&(this.$.progressUnknown=!0);try{let t=await ze(this.file||this.externalUrl,{...e,publicKey:this.$["*--cfg-pubkey"],userAgent:dt,fileName:this.entry.getValue("fileName"),onProgress:e=>{if(e.isComputable){let t=100*e.value;this.entry.setValue("uploadProgress",t)}this.$.progressUnknown=!e.isComputable}});this.entry.setValue("isUploading",!1),this.setAttribute("loaded",""),this.removeAttribute("uploading"),this.$.badgeIcon="badge-success",this.entry.setMultipleValues({fileInfo:t,uploadProgress:100,fileName:t.name,fileSize:t.size,isImage:t.isImage,mimeType:t.mimeType,uuid:t.uuid})}catch(e){this.entry.setValue("isUploading",!1),this.$.progressValue=0,this.setAttribute("error",""),this.removeAttribute("uploading");let t=new ot;t.caption=this.l10n("upload-error")+": "+(this.file?.name||this.externalUrl),t.text=e,t.isError=!0,this.set$({badgeIcon:"badge-error","*message":t}),this.entry.setValue("uploadProgress",0),this.entry.setValue("uploadError",e)}}}ut.template='\n<div\n  class="thumb"\n  set="style.backgroundImage: thumbUrl">\n  <div class="badge">\n    <uc-icon set="@name: badgeIcon"></uc-icon>\n  </div>\n</div>\n<div class="file-name-wrapper">\n  <span class="file-name" set="@title: itemName">{{itemName}}</span>\n</div>\n<button class="edit-btn" set="onclick: onEdit;">\n  <uc-icon name="edit-file"></uc-icon>\n</button>\n<button class="remove-btn" set="onclick: onRemove;">\n  <uc-icon name="remove-file"></uc-icon>\n</button>\n<button class="upload-btn" set="onclick: onUpload;">\n  <uc-icon name="upload"></uc-icon>\n</button>\n<uc-progress-bar\n  class="progress-bar"\n  set="value: progressValue; visible: progressVisible; unknown: progressUnknown">\n</uc-progress-bar>\n',ut.activeInstances=new Set,ut.bindAttributes({"entry-id":null});class pt extends qe{init$={"*modalActive":!1,"*modalHeaderHidden":!1,closeClicked:()=>{this.set$({"*modalActive":!1,"*currentActivity":""})}};initCallback(){this.sub("*modalActive",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active"),e&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null})),this.getCssData("--cfg-modal-backdrop-strokes")&&(this.style.backgroundImage=`url(${function(e="rgba(0, 0, 0, .1)"){return ct(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">\n    <line x1="0" y1="10" x2="10" y2="0" stroke="${e}" />\n  </svg>`)}()})`)}}pt.template='\n<div class="dialog">\n  <div class="heading" set="@hidden: *modalHeaderHidden">\n    <slot name="heading"></slot>\n    <button\n      class="close-btn"\n      set="onclick: closeClicked">\n      <uc-icon name="close"></uc-icon>\n    </button>\n  </div>\n  <div class="content">\n    <slot></slot>\n  </div>\n</div>\n';class mt{captionL10nStr="confirm-your-action";messageL10Str="are-you-sure";confirmL10nStr="yes";denyL10nStr="no";confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class gt extends qe{activityType=qe.activities.CONFIRMATION;_defaults=new mt;init$={messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)};initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",(e=>{e&&this.set$({"*modalHeaderHidden":!0,"*currentActivity":qe.activities.CONFIRMATION,"*activityCaption":this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,e.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,e.confirmAction()}})}))}}gt.template='\n<div class="message">{{messageTxt}}</div>\n<div class="toolbar">\n  <button\n    class="deny-btn secondary-btn"\n    set="onclick: onDeny">{{denyBtnTxt}}</button>\n  <button\n    class="confirm-btn primary-btn"\n    set="onclick: onConfirm">{{confirmBtnTxt}}</button>\n</div>\n';class bt extends qe{activityType=qe.activities.UPLOAD_LIST;init$={doneBtnHidden:!0,uploadBtnHidden:!1,uploadBtnDisabled:!1,hasFiles:!1,moreBtnDisabled:!0,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.set$({uploadBtnHidden:!1,doneBtnHidden:!0,uploadBtnDisabled:!0,"*uploadTrigger":{}})},onDone:()=>{this.set$({"*currentActivity":this.doneActivity||""}),this.setForCtxTarget("uc-modal","*modalActive",!1),this.output()},onCancel:()=>{let e=new mt;e.confirmAction=()=>{this.cancelFlow(),this.uploadCollection.clearAll(),this.output()},e.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=e}};_renderMap=Object.create(null);updateButtonsState(){let e=this.uploadCollection.items(),t={total:e.length,uploaded:0,uploading:0};for(let i of e){let e=this.uploadCollection.read(i);e.getValue("uuid")?t.uploaded+=1:e.getValue("isUploading")&&(t.uploading+=1)}let i=t.total===t.uploaded;this.set$({uploadBtnHidden:i,doneBtnHidden:!i,uploadBtnDisabled:t.uploading>0}),!this.$["*--cfg-confirm-upload"]&&i&&this.$.onDone()}initCallback(){super.initCallback(),this.bindCssData("--cfg-show-empty-list"),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("selected"),"*activityIcon":"local"})})),this.sub("*--cfg-multiple",(e=>{this.$.moreBtnDisabled=!e})),this.uploadCollection.observe((()=>{this.updateButtonsState()})),this.sub("*uploadList",(e=>{if(0===e?.length&&!this.$["*--cfg-show-empty-list"])return this.cancelFlow(),void(this.ref.files.innerHTML="");this.updateButtonsState(),this.set$({hasFiles:e.length>0}),e.forEach((e=>{if(!this._renderMap[e]){let t=new ut;this._renderMap[e]=t}}));for(let t in this._renderMap)e.includes(t)||(this._renderMap[t].remove(),delete this._renderMap[t]);let t=document.createDocumentFragment();Object.values(this._renderMap).forEach((e=>t.appendChild(e))),this.ref.files.replaceChildren(t),Object.keys(this._renderMap).forEach((e=>{let t=this._renderMap[e];setTimeout((()=>{t["entry-id"]=e,t.innerHTML||t.render()}))})),this.setForCtxTarget("uc-modal","*modalActive",!0)}))}}bt.template='\n<div class="no-files" set="@hidden: hasFiles">\n  <slot name="empty"><span l10n="no-files"></span></slot>\n</div>\n<div class="files" ref="files"></div>\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel;"\n    l10n="clear"></button>\n  <div></div>\n  <button\n    class="add-more-btn secondary-btn"\n    set="onclick: onAdd; @disabled: moreBtnDisabled"\n    l10n="add-more"></button>\n  <button\n    class="upload-btn primary-btn"\n    set="@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled"\n    l10n="upload"></button>\n  <button\n    class="done-btn primary-btn"\n    set="@hidden: doneBtnHidden; onclick: onDone"\n    l10n="done"></button>\n</div>\n';class ft extends qe{activityType=qe.activities.URL;init$={importDisabled:!0,onUpload:()=>{let e=this.ref.input.value;this.uploadCollection.add({externalUrl:e}),this.$["*currentActivity"]=qe.activities.UPLOAD_LIST},onCancel:()=>{this.cancelFlow()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}};initCallback(){this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("caption-from-url"),"*activityIcon":"url"})}))}}ft.template='\n<input placeholder="https://..." .url-input type="text" ref="input" set="oninput: onInput"/>\n<button\n  class="url-upload-btn primary-btn"\n  set="onclick: onUpload; @disabled: importDisabled">\n</button>\n<button\n  class="cancel-btn secondary-btn"\n  set="onclick: onCancel"\n  l10n="cancel">\n</button>\n';const _t=()=>void 0!==navigator.permissions;class vt extends qe{activityType=qe.activities.CAMERA;_unsubPermissions=null;init$={video:null,videoTransformCss:null,shotBtnDisabled:!1,videoHidden:!1,messageHidden:!0,requestBtnHidden:_t(),l10nMessage:null,onCancel:()=>{this.cancelFlow()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}};_onActivate=()=>{this.set$({"*activityCaption":this.l10n("caption-camera"),"*activityIcon":"camera"}),_t()&&this._subscribePermissions(),this._capture()};_onDeactivate=()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()};_handlePermissionsChange=()=>{this._capture()};_setPermissionsState=function(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}((e=>{"granted"===e?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):"prompt"===e?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())}),300);async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",(()=>{this._setPermissionsState("denied")})),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied")}}_stopCapture(){this._capturing&&(this.$.video?.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob((i=>{let s=new File([i],t,{lastModified:e,type:"image/png"});this.uploadCollection.add({file:s,fileName:t,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":qe.activities.UPLOAD_LIST})}))}initCallback(){this.registerActivity(this.activityType,this._onActivate,this._onDeactivate);let e=this.bindCssData("--cfg-camera-mirror");this.sub(e,(e=>{this.isActivityActive&&(this.$.videoTransformCss=e?"scaleX(-1)":null)}))}}vt.template='\n<div class="content">\n  <video\n    autoplay\n    playsinline\n    set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"\n    ref="video">\n  </video>\n  <div class="message-box" set="@hidden: messageHidden">\n    <span>{{l10nMessage}}</span>\n    <button set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request"></button>\n  </div>\n</div>\n\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <button\n    class="shot-btn primary-btn"\n    set="onclick: onShot; @disabled: shotBtnDisabled"\n    l10n="camera-shot">\n  </button>\n</div>\n';class yt extends qe{activityType=qe.activities.DETAILS;init$={checkerboard:!1,localImageEditDisabled:!0,cloudImageEditDisabled:!0,fileSize:null,fileName:"",notUploaded:!0,imageUrl:"",errorTxt:"",editBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=qe.activities.CLOUD_IMG_EDIT)}};showNonImageThumb(){let e=ht(window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),108,108);this.eCanvas.setImageUrl(e),this.set$({checkerboard:!1})}initCallback(){this.bindCssData("--cfg-use-local-image-editor"),this.sub("*--cfg-use-local-image-editor",(e=>{this.$.localImageEditDisabled=!e})),this.bindCssData("--cfg-use-cloud-image-editor"),this.sub("*--cfg-use-cloud-image-editor",(e=>{this.$.cloudImageEditDisabled=!e})),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("caption-edit-file")})})),this.eCanvas=this.ref.canvas,this.sub("*focusedEntry",(e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach((e=>{this._entrySubs.delete(e),e.remove()})):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(this.eCanvas.clear(),t){this._file=t;let i=this._file.type.includes("image");i&&!e.getValue("transformationsUrl")&&(this.eCanvas.setImageFile(this._file),this.set$({checkerboard:!0,editBtnHidden:!this.$["*--cfg-use-local-image-editor"]})),i||this.showNonImageThumb()}let i=(e,t)=>{this._entrySubs.add(this.entry.subscribe(e,t))};i("fileName",(e=>{this.$.fileName=e,this.$.onNameInput=()=>{let e=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:e}),this.entry.setValue("fileName",e)}})),i("fileSize",(e=>{this.$.fileSize=Number.isFinite(e)?this.fileSizeFmt(e):this.l10n("file-size-unknown")})),i("uuid",(e=>{e&&!this.entry.getValue("transformationsUrl")?(this.eCanvas.clear(),this.set$({imageUrl:`https://ucarecdn.com/${e}/`,notUploaded:!1,editBtnHidden:!this.entry.getValue("isImage")&&!this.$["*--cfg-use-cloud-image-editor"]}),this.eCanvas.setImageUrl(this.$.imageUrl)):this.$.imageUrl="Not uploaded yet..."})),i("uploadError",(e=>{this.$.errorTxt=e?.message})),i("externalUrl",(e=>{e&&(this.entry.getValue("uuid")||this.showNonImageThumb())})),i("transformationsUrl",(e=>{e&&this.entry.getValue("isImage")&&this.eCanvas.setImageUrl(e)}))}))}}yt.template='\n<uc-tabs\n  tab-list="tab-view, tab-details">\n\n  <div\n    tab-ctx="tab-details"\n    class="details">\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="file-name"></div>\n      <input\n        name="name-input"\n        ref="file_name_input"\n        set="value: fileName; oninput: onNameInput"\n        type="text" />\n    </div>\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="file-size"></div>\n      <div>{{fileSize}}</div>\n    </div>\n\n    <div class="info-block">\n      <div class="info-block_name" l10n="cdn-url"></div>\n      <a\n        target="_blank"\n        set="@href: imageUrl; @disabled: notUploaded">{{imageUrl}}</a>\n    </div>\n\n    <div>{{errorTxt}}</div>\n\n  </div>\n\n  <uc-editable-canvas\n    tab-ctx="tab-view"\n    set="@disabled: localImageEditDisabled; @checkerboard: checkerboard;"\n    ref="canvas">\n  </uc-editable-canvas>\n</uc-tabs>\n\n<div class="toolbar" set="@edit-disabled: editBtnHidden">\n  <button\n    class="edit-btn secondary-btn"\n    set="onclick: onEdit; @hidden: editBtnHidden;">\n    <uc-icon name="edit"></uc-icon>\n    <span l10n="edit-image"></span>\n  </button>\n  <button\n    class="remove-btn secondary-btn"\n    set="onclick: onRemove">\n    <uc-icon name="remove"></uc-icon>\n    <span l10n="remove-from-list"></span>\n  </button>\n  <div></div>\n  <button\n    class="back-btn primary-btn"\n    set="onclick: onBack">\n    <span l10n="done"></span>\n  </button>\n</div>\n';class wt extends qe{init$={visible:!1,unknown:!1,value:0,"*commonProgress":0};initCallback(){this.uploadCollection.observe((()=>{let e=this.uploadCollection.items().some((e=>this.uploadCollection.read(e).getValue("isUploading")));this.$.visible=e})),this.sub("visible",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})),this.sub("*commonProgress",(e=>{this.$.value=e}))}}wt.template='\n<uc-progress-bar set="visible: visible; unknown: unknown; value: value"></uc-progress-bar>\n';class $t extends qe{_value=0;_unknownMode=!1;init$={width:0,opacity:0};initCallback(){this.defineAccessor("value",(e=>{void 0!==e&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))})),this.defineAccessor("visible",(e=>{this.ref.line.classList.toggle("progress--hidden",!e)})),this.defineAccessor("unknown",(e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)}))}}$t.template='\n<div\n  ref="line"\n  class="progress">\n</div>\n';class Ct extends qe{init$={refMap:null,disabled:!0,toolbarHidden:!0,checkerboard:!1};constructor(){super(),H(this,{display:"flex",justifyContent:"center",alignItems:"center"})}initCallback(){this.sub("disabled",(()=>{this.$.toolbarHidden=this.hasAttribute("disabled")&&"false"!==this.getAttribute("disabled")})),this.sub("checkerboard",(()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${function(e="#fff",t="rgba(0, 0, 0, .1)"){return ct(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">\n    <rect x="0" y="0" width="20" height="20" fill="${e}" />\n    <rect x="0" y="0" width="10" height="10" fill="${t}" />\n    <rect x="10" y="10" width="10" height="10" fill="${t}" />\n  </svg>`)}()})`:"unset"})),this.canvas=this.ref.cvs,this.canvCtx=this.canvas.getContext("2d"),this.$.refMap={parent:this,canvas:this.canvas,canvCtx:this.canvCtx,svg:this.ref.svg,svgGroup:this.ref.svg_g,svgImg:this.ref.svg_img}}setImage(e){e.height&&e.width?(this.canvas.height=e.height,this.canvas.width=e.width,this.canvCtx.drawImage(e,0,0,e.width,e.height)):(this.clear(),e.onload=()=>{this.canvas.height=e.height,this.canvas.width=e.width,this.canvCtx.drawImage(e,0,0,e.width,e.height)})}setImageFile(e){let t=new Image,i=URL.createObjectURL(e);t.src=i,this.setImage(t)}setImageUrl(e){let t=new Image;t.src=e,this.setImage(t)}clear(){this.canvCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}}function xt(...e){return e.reduce(((e,t)=>{if("string"==typeof t)return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e}),{})}function Tt(...e){let t=xt(...e);return Object.keys(t).reduce(((e,i)=>(t[i]&&e.push(i),e)),[]).join(" ")}function At(e,t){let i,s=(...s)=>{clearTimeout(i),i=setTimeout((()=>e(...s)),t)};return s.cancel=()=>{clearTimeout(i)},s}Ct.template='\n<canvas class="img-view" ref="cvs"></canvas>\n<svg class="img-view" xmlns="http://www.w3.org/2000/svg" ref="svg">\n  <g ref="svg_g">\n    <image ref="svg_img" x="0" y="0"></image>\n  </g>\n</svg>\n<editable-canvas-toolbar\n  set="refMap: refMap; @hidden: toolbarHidden">\n</editable-canvas-toolbar>\n',Ct.bindAttributes({disabled:"disabled",checkerboard:"checkerboard"});const kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function Et(e){let t=new Image;return{promise:new Promise(((i,s)=>{t.src=e,t.onload=i,t.onerror=s})),image:t,cancel:()=>{0===t.naturalWidth&&(t.src=kt)}}}function St(e){let t=[];for(let i of e){let e=Et(i);t.push(e)}let i=t.map((e=>e.image));return{promise:Promise.allSettled(t.map((e=>e.promise))),images:i,cancel:()=>{t.forEach((e=>{e.cancel()}))}}}const It={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function Lt(...e){return e.join("/-/").replace(/\/\//g,"/")}const Pt=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Ut(e){return Lt(...Pt.filter((t=>void 0!==e[t]&&null!==e[t])).map((t=>function(e,t){if("number"==typeof t)return It[e]!==t?`${e}/${t}`:"";if("boolean"==typeof t)return t&&It[e]!==t?`${e}`:"";if("filter"===e){if(!t||It[e]===t.amount)return"";let{name:i,amount:s}=t;return`${e}/${i}/${s}`}if("crop"===e){if(!t)return"";let{dimensions:i,coords:s}=t;return`${e}/${i.join("x")}/${s.join(",")}`}return""}(t,e[t]))).filter((e=>e&&e.length>0)))}function Rt(e,...t){return e.replace(/\/$/g,"")+"/-/"+Lt(...t.filter((e=>e&&e.length>0)))+"/"}const Nt=["format/auto","progressive/yes"].join("/-/");const Mt=`\n<div class="wrapper wrapper_desktop">\n  <uc-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">\n    <div class="network_problems_content">\n      <div class="network_problems_icon">\n        <uc-icon size="20" name="sad"></uc-icon>\n      </div>\n      <div class="network_problems_text">\n        Network error\n      </div>\n    </div>\n    <div class="network_problems_footer">\n      <uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui>\n    </div>\n  </uc-presence-toggle>\n  <div class="viewport">\n    <div class="file_type_outer">\n      <div class="file_type">{{fileType}}</div>\n    </div>\n    <div class="image_container" ref="img-container-el">\n      <img src="${kt}" class="image image_visible_from_editor" ref="img-el">\n      <uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper>\n      <uc-editor-image-fader ref="fader-el"></uc-editor-image-fader>\n    </div>\n    <div class="info_pan">{{msg}}</div>\n  </div>\n  <div class="toolbar">\n    <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>\n    <div class="toolbar_content toolbar_content__editor">\n      <uc-editor-toolbar></uc-editor-toolbar>\n    </div>\n  </div>\n</div>\n`,Dt="crop",Ot="sliders",Bt="filters",zt=[Dt,Ot,Bt],Vt=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Ft=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],jt=["rotate","mirror","flip"],Ht={brightness:{zero:It.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:It.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:It.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:It.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:It.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:It.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:It.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:It.enhance,range:[0,100],keypointsNumber:1},filter:{zero:It.filter,range:[0,100],keypointsNumber:1}};function qt(e,t,i){let s=window.devicePixelRatio,n=Math.min(Math.ceil(t*s),3e3),r=s>=2?"lightest":"normal";return Rt(e,Nt,Ut(i),`quality/${r}`,`stretch/off/-/resize/${n}x`)}class Kt extends qe{init$=function(e){return{"*originalUrl":null,"*tabId":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*modalEl":e,"*networkProblems":!1,"*imageSize":null,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:kt,fileType:"",showLoader:!1,uuid:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let t=e.querySelectorAll("img");for(let e of t){let t=e.src;e.src=kt,e.src=t}e.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let i=Rt(e.$["*originalUrl"],Ut(t),"preview");e.dispatchEvent(new CustomEvent("apply",{detail:{originalUrl:e.$["*originalUrl"],transformationsUrl:i,transformations:t}})),e.remove()},"*on.cancel":()=>{e.remove(),e.dispatchEvent(new CustomEvent("cancel"))}}}(this);_debouncedShowLoader=At(this._showLoader.bind(this),300);_showLoader(e){this.$.showLoader=e}_loadImageFromCdn(){this._debouncedShowLoader(!0);let e=this._imageSrc(),{promise:t,cancel:i}=Et(e);t.then((()=>{this.$.src=e})).catch((t=>{this.$["*networkProblems"]=!0,this._debouncedShowLoader(!1),this.$.src=e})),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=i}_imageSrc(){let{width:e}=this.ref["img-container-el"].getBoundingClientRect();return qt(this.$["*originalUrl"],e,{})}_waitForSize(){return new Promise(((e,t)=>{let i=Date.now(),s=()=>{if(!this.isConnected)return clearInterval(n),void t();if(Date.now()-i>300)return clearInterval(n),void t(new Error("[cloud-image-editor] timout waiting for non-zero container size"));let{width:s,height:r}=this.getBoundingClientRect();s>0&&r>0&&(clearInterval(n),e())},n=setInterval(s,50);s()}))}async initCallback(){super.initCallback();try{await this._waitForSize()}catch(e){return void(e&&console.error(e))}this.$["*originalUrl"]=`https://ucarecdn.com/${this.$.uuid}/`,fetch(`${this.$["*originalUrl"]}-/json/`).then((e=>e.json())).then((({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}})),this._loadImageFromCdn(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.classList.add("editor_ON"),this.sub("*networkProblems",(e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e})),this.ref["img-el"].addEventListener("load",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==kt&&(this.$["*networkProblems"]=!1)})),this.ref["img-el"].addEventListener("error",(e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0})),this.sub("src",(e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||kt)})),this.sub("*tabId",(e=>{this.ref["img-el"].className=Tt("image",{image_hidden_to_cropper:e===Dt,image_hidden_effects:e!==Dt})}))}disconnectedCallback(){super.disconnectedCallback()}}Kt.template=Mt,Kt.bindAttributes({uuid:"uuid"});const Xt=1.5,Wt=100/3,Gt=82;function Jt(e,t){for(let i in t)e.setAttributeNS(null,i,t[i].toString())}function Zt(e,t={}){let i=document.createElementNS("http://www.w3.org/2000/svg",e);return Jt(i,t),i}function Yt(e,t){let{x:i,y:s,width:n,height:r}=e,a=t.includes("w")?0:1,o=t.includes("n")?0:1,l=[-1,1][a],c=[-1,1][o],h=[i+a*n+Xt*l,s+o*r+Xt*c-24*c],d=[i+a*n+Xt*l,s+o*r+Xt*c],u=[i+a*n-24*l+Xt*l,s+o*r+Xt*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,center:d}}function Qt(e,t){let i,s,{x:n,y:r,width:a,height:o}=e,l=["n","s"].includes(t)?.5:{w:0,e:1}[t],c=["w","e"].includes(t)?.5:{n:0,s:1}[t],h=[-1,1][l],d=[-1,1][c];return["n","s"].includes(t)?(i=[n+l*a-17,r+c*o+Xt*d],s=[n+l*a+17,r+c*o+Xt*d]):(i=[n+l*a+Xt*h,r+c*o-17],s=[n+l*a+Xt*h,r+c*o+17]),{d:`M ${i[0]} ${i[1]} L ${s[0]} ${s[1]}`,center:[s[0]-(s[0]-i[0])/2,s[1]-(s[1]-i[1])/2]}}function ei(e,t){let{x:i}=e,{y:s}=e;return e.x<t.x?i=t.x:e.x+e.width>t.x+t.width&&(i=t.x+t.width-e.width),e.y<t.y?s=t.y:e.y+e.height>t.y+t.height&&(s=t.y+t.height-e.height),{...e,x:i,y:s}}function ti(e,[t,i],s){let{x:n,y:r,width:a,height:o}=e;if(s.includes("n")){let e=o;o=Math.max(i,o),r=r+e-o}if(s.includes("s")&&(o=Math.max(i,o)),s.includes("w")){let e=a;a=Math.max(t,a),n=n+e-a}return s.includes("e")&&(a=Math.max(t,a)),{x:n,y:r,width:a,height:o}}class ii extends qe{init$={dragging:!1};constructor(){super(),this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(""===e&&t.height<=Gt&&t.width<=Gt)return!0;let i=t.height<=Gt&&(e.includes("n")||e.includes("s")),s=t.width<=Gt&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e,r=this.ref["svg-el"],a=Zt("mask",{id:"backdrop-mask"}),o=Zt("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),l=Zt("rect",{x:t,y:i,width:s,height:n,fill:"black"});a.appendChild(o),a.appendChild(l);let c=Zt("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});r.appendChild(c),r.appendChild(a),this._backdropMask=a,this._backdropMaskInner=l}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame((()=>{this._backdropMask.style.display="block"})))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e;Jt(this._backdropMaskInner,{x:t,y:i,width:s,height:n})}_updateFrame(){let e=this.$["*cropBox"];if(e){for(let t of Object.values(this._frameThumbs)){let{direction:i,pathNode:s,interactionNode:n,groupNode:r}=t,a=""===i,o=2===i.length;if(a){let{x:t,y:i,width:s,height:r}=e,a=[t+s/2,i+r/2];Jt(n,{r:Math.min(s,r)/3,cx:a[0],cy:a[1]})}else{let{d:t,center:r}=o?Yt(e,i):Qt(e,i);Jt(n,{cx:r[0],cy:r[1]}),Jt(s,{d:t})}let l=this._shouldThumbBeDisabled(i);r.setAttribute("class",Tt("thumb",{"thumb--hidden":l,"thumb--visible":!l}))}Jt(this._frameGuides,{x:e.x-.5,y:e.y-.5,width:e.width+1,height:e.height+1})}}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,n=Zt("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let r=Zt("circle",{r:25.5,fill:"transparent"}),a=Zt("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(a),n.appendChild(r),e[s]={direction:s,pathNode:a,interactionNode:r,groupNode:n},r.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=Zt("svg"),t=Zt("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let t=1;t<=2;t++){let i=Zt("line",{x1:Wt*t+"%",y1:"0%",x2:Wt*t+"%",y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}for(let t=1;t<=2;t++){let i=Zt("line",{x1:"0%",y1:Wt*t+"%",x2:"100%",y2:Wt*t+"%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:e}of Object.values(s))t.appendChild(e);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:n,y:r}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-n,o=t.y-r;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,o],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),n=e.x-i,r=e.y-s,a=n-this._dragStartPoint[0],o=r-this._dragStartPoint[1],{direction:l}=this._draggingThumb,c=this.$["*imageBox"],h=this._dragStartCrop;""===l?(h=function(e,[t,i]){return{...e,x:e.x+t,y:e.y+i}}(h,[a,o]),h=ei(h,c)):(h=function(e,[t,i],s){let{x:n,y:r,width:a,height:o}=e;return s.includes("n")&&(r+=i,o-=i),s.includes("s")&&(o+=i),s.includes("w")&&(n+=t,a-=t),s.includes("e")&&(a+=t),{x:n,y:r,width:a,height:o}}(h,[a,o],l),h=function(e,t){let i=Math.max(e.x,t.x),s=Math.min(e.x+e.width,t.x+t.width),n=Math.max(e.y,t.y);return{x:i,y:n,width:s-i,height:Math.min(e.y+e.height,t.y+t.height)-n}}(h,c)),h=ti(h,[Math.min(c.width,Gt),Math.min(c.height,Gt)],l),Object.values(h).every((e=>Number.isFinite(e)&&e>=0))?this.$["*cropBox"]=h:console.error("CropFrame is trying to create invalid rectangle",{payload:h})}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find((t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let i=t.groupNode.getBoundingClientRect(),s=function(e,[t,i]){return e.x<=t&&t<=e.x+e.width&&e.y<=i&&i<=e.y+e.height}({x:i.x,y:i.y,width:i.width,height:i.height},[e.x,e.y]);return s}));this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;var t;this.ref["svg-el"].style.cursor=e?""===(t=e.direction)?"move":["e","w"].includes(t)?"ew-resize":["n","s"].includes(t)?"ns-resize":["nw","se"].includes(t)?"nwse-resize":"nesw-resize":"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map((({groupNode:e})=>e)).forEach((t=>{t.setAttribute("class",Tt("thumb",{"thumb--hidden":!e,"thumb--visible":e}))}))}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",(()=>{this._resizeBackdrop(),window.requestAnimationFrame((()=>{this._render()}))})),this.sub("*cropBox",(e=>{e&&(this._guidesHidden=e.height<=Gt||e.width<=Gt,window.requestAnimationFrame((()=>{this._render()})))})),this.sub("dragging",(e=>{this._frameGuides.setAttribute("class",Tt({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))})),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}ii.template="\n  <svg class='svg' ref='svg-el' xmlns=\"http://www.w3.org/2000/svg\">\n  </svg>\n";class si extends qe{init$={active:!1,title:"",icon:"","on.click":null};initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.sub("title",(e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")})),this.sub("active",(e=>{this.className=Tt({active:e,not_active:!e})})),this.sub("on.click",(e=>{this.onclick=e}))}}si.template='\n  <div class="before"></div>\n  <uc-icon size="20" set="@name: icon;"></uc-icon>\n  <div class="title" ref="title-el">{{title}}</div>\n';class ni extends si{initCallback(){super.initCallback(),this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e)})),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=function(e,t){return"rotate"===e?function(e){let t=e+90;return t=t>=360?0:t,t}(t):["mirror","flip"].includes(e)?!t:null}(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}}const ri="filter",ai="color_operation",oi="original";class li extends qe{init$={disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}};setOperation(e,t){this._controlType="filter"===e?ri:ai,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===oi?void 0:this.$.value,filter:this._filter===oi?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=Ht[this._operation],[i,s]=e;this.$.min=i,this.$.max=s,this.$.zero=t;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===ri){let e=s;if(n){let{name:t,amount:i}=n;e=t===this._filter?i:s}this.$.value=e,this.$.defaultValue=e}if(this._controlType===ai){let e=void 0!==n?n:t;this.$.value=e,this.$.defaultValue=e}}apply(){let e;e=this._controlType===ri?this._filter===oi?null:{name:this._filter,amount:this.$.value}:this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}connectedCallback(){super.connectedCallback(),this.sub("*originalUrl",(e=>{this._originalUrl=e})),this.sub("value",(e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t}))}}li.template='\n<uc-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"></uc-slider-ui>\n';class ci extends si{init$={active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null};_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s=t>=2?"lightest":"normal",n={...this.$["*editorTransformations"]};return n[this._operation]=this._filter!==oi?{name:this._filter,amount:100}:void 0,Rt(this._originalUrl,Nt,Ut(n),`quality/${s}`,`scale_crop/${i}x${i}/center`)}_observerCallback(e,t){if(e[0].isIntersecting){let e=this._previewSrc(),i=this.ref["preview-el"],{promise:s,cancel:n}=Et(e);this._cancelPreload=n,s.catch((e=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:e})})).finally((()=>{i.style.backgroundImage=`url(${e})`,setTimeout((()=>{i.style.opacity="1"})),t.unobserve(this)}))}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",(e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===oi,this.$.icon=this.$.isOriginal?"original":"slider"})),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",(e=>{this.$.active=e&&e===this._filter})),this.sub("isOriginal",(e=>{this.$.iconSize=e?40:20})),this.sub("active",(e=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=e?"1":"0";let t=this.ref["preview-el"];e?t.style.opacity="0":t.style.backgroundImage&&(t.style.opacity="1")})),this.sub("*networkProblems",(e=>{if(!e){let e=this._previewSrc(),t=this.ref["preview-el"];t.style.backgroundImage&&(t.style.backgroundImage="none",t.style.backgroundImage=`url(${e})`)}}))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0,this._cancelPreload&&this._cancelPreload()}}ci.template='\n  <div class="before"></div>\n  <div class="preview" ref="preview-el"></div>\n  <uc-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>\n';class hi extends si{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",(e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))})),this.sub("*editorTransformations",(e=>{if(!this._operation)return;let{zero:t}=Ht[this._operation],i=e[this._operation],s=void 0!==i&&i!==t;this.$.active=s}))}}const di=window.ResizeObserver||class{constructor(e){this._callback=e}_flush(e){let t=e.getBoundingClientRect();JSON.stringify(t)!==JSON.stringify(this._lastRect)&&this._callback([{borderBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentRect:t,target:e}]),this._lastRect=t}observe(e){this.unobserve(),this._observeInterval=window.setInterval((()=>this._flush(e)),500),this._flush(e)}unobserve(e){this._observeInterval&&window.clearInterval(this._observeInterval)}};function ui(e,t,i){return Math.min(Math.max(e,t),i)}function pi({width:e,height:t},i){let s=i/90%2!=0;return{width:s?t:e,height:s?e:t}}class mi extends qe{init$={image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}};constructor(){super(),this._commitDebounced=At(this._commit.bind(this),300),this._handleResizeDebounced=At(this._handleResize.bind(this),10)}_handleResize(){this._initCanvas(),this._alignImage(),this._alignCrop(),this._draw()}_syncTransformations(){let e=function(e,t){let i={};for(let s of t){let t=e[s];(e.hasOwnProperty(s)||void 0!==t)&&(i[s]=t)}return i}(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*n,e.height=s*n,t.scale(n,n),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,n=this.offsetWidth,r=this.offsetHeight,a=pi({width:e.naturalWidth,height:e.naturalHeight},s);if(a.width>n-2*t||a.height>r-2*t){let e=a.width/a.height;if(e>n/r){let i=n-2*t,s=i/e,a=0+t,o=t+(r-2*t)/2-s/2;this.$["*imageBox"]={x:a,y:o,width:i,height:s}}else{let i=r-2*t,s=i*e,a=t+(n-2*t)/2-s/2,o=0+t;this.$["*imageBox"]={x:a,y:o,width:s,height:i}}}else{let{width:e,height:i}=a,s=t+(n-2*t)/2-e/2,o=t+(r-2*t)/2-i/2;this.$["*imageBox"]={x:s,y:o,width:e,height:i}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,n=this.$["*editorTransformations"].crop;if(n){let{dimensions:[t,i],coords:[r,a]}=n,{width:o,x:l,y:c}=this.$["*imageBox"],{width:h}=pi(this._imageSize,s),d=o/h;e={x:l+r*d,y:c+a*d,width:t*d,height:i*d}}else e={x:t.x,y:t.y,width:t.width,height:t.height};e=ti(e,[Math.min(t.width,Gt),Math.min(t.height,Gt)],"se"),e=ei(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:n,rotate:r}=i,a=this._ctx,o=pi({width:t.width,height:t.height},r);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(r*Math.PI*-1/180),a.scale(s?-1:1,n?-1:1),a.drawImage(e,-o.width/2,-o.height/2,o.width,o.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._alignTransition(),setTimeout((()=>{this.className=Tt({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1,inactive_instant:!1})})))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:r}=t,{width:a,height:o}=pi(this._imageSize,s),{width:l,height:c}=e,h=n/a,d=r/o;return[ui(Math.round(l/h),1,a),ui(Math.round(c/d),1,o)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:r,x:a,y:o}=t,{width:l,height:c}=pi(this._imageSize,s),{x:h,y:d}=e,u=n/l,p=r/c,m=this._calculateDimensions(),g={dimensions:m,coords:[ui(Math.round((h-a)/u),0,l-m[0]),ui(Math.round((d-o)/p),0,c-m[1])]};if(function(e){return!e||[({dimensions:e,coords:t})=>[...e,...t].every((e=>Number.isInteger(e)&&Number.isFinite(e))),({dimensions:e,coords:t})=>e.every((e=>e>0))&&t.every((e=>e>=0))].every((t=>t(e)))}(g)){if(m[0]!==l||m[1]!==c)return g}else console.error("Cropper is trying to create invalid crop object",{payload:g})}_commit(){let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,n=this._calculateCrop(),r={...this.$["*editorTransformations"],crop:n,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=r}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(e){console.error("Failed to activate cropper",{error:e})}}}deactivate({seamlessTransition:e=!1}={}){this._isActive&&(this._commit(),this._isActive=!1,e&&this._alignTransition(),this.className=Tt({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:e,inactive_instant:!e}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_alignTransition(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth-2*this.$["*padding"],e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight-2*this.$["*padding"],e[1])/this.$["*cropBox"].height,s=Math.min(t,i),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,r=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-n)/s}px, ${(this.offsetHeight/2-r)/s}px)`,this.style.transformOrigin=`${n}px ${r}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=qt(e,this.offsetWidth,t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0}),{promise:s,cancel:n,image:r}=Et(i),a=this._handleImageLoading(i);return r.addEventListener("load",a,{once:!0}),r.addEventListener("error",a,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,s.then((()=>r)).catch((e=>(console.error("Failed to load image",{error:e}),this.$["*networProblems"]=!0,Promise.resolve(r))))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new di((()=>{this._isActive&&this.$.image&&this._handleResizeDebounced()})),this._observer.observe(this),this.sub("*imageBox",(()=>{this._draw()})),this.sub("*cropBox",(e=>{this.$.image&&this._commitDebounced()})),setTimeout((()=>{this.sub("*networkProblems",(e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})}))}),0)}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0}}function gi(e,t,i){let s=Array(i);for(let n=--i;n>=0;n--)s[n]=Math.ceil((n*t+(i-n)*e)/i);return s}function bi(e,t){let i=Ht[e].keypointsNumber,{range:s,zero:n}=Ht[e];return[...new Set([...gi(s[0],n,i+1),...gi(n,s[1],i+1),n,t])].sort(((e,t)=>e-t))}mi.template="\n  <canvas class='canvas' ref='canvas-el'></canvas>\n  <uc-crop-frame ref='frame-el'></uc-crop-frame>\n";class fi extends qe{initCallback(){super.initCallback(),this.addEventListener("wheel",(e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>1?this.scrollLeft+=i:this.scrollLeft+=t}))}}fi.template="\n<slot></slot>\n";class _i extends qe{constructor(){super(),this.init$={"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*editorTransformations":{},"*currentFilter":oi,"*currentOperation":null,showLoader:!1,tabId:Dt,filters:Ft,colorOperations:Vt,cropOperations:jt,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,[`presence.tabContent${Dt}`]:!1,[`presence.tabContent${Ot}`]:!1,[`presence.tabContent${Bt}`]:!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=At(this._showLoader.bind(this),500)}get tabId(){return this.$.tabId}_onSliderClose(){this.$["*showSlider"]=!1,this.$.tabId===Ot&&(this.ref["tooltip-el"].className=Tt("filter-tooltip",{"filter-tooltip_visible":!1,"filter-tooltip_hidden":!0}))}_createOperationControl(e){let t=hi.is&&new hi;return t.operation=e,t}_createFilterControl(e){let t=ci.is&&new ci;return t.filter=e,t}_createToggleControl(e){let t=ni.is&&new ni;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();e===Dt?this.$.cropOperations.forEach((e=>{let t=this._createToggleControl(e);i.appendChild(t)})):e===Bt?[oi,...this.$.filters].forEach((e=>{let t=this._createFilterControl(e);i.appendChild(t)})):e===Ot&&this.$.colorOperations.forEach((e=>{let t=this._createOperationControl(e);i.appendChild(t)})),i.childNodes.forEach(((e,t)=>{t===i.childNodes.length-1&&e.classList.add("controls-list_last-item")})),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}){this.$.tabId=e,e===Dt?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate({seamlessTransition:!0}));for(let t of zt){let i=t===e;this.ref[`tab-toggle-${t}`].active=i,i?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(t),this.$[`presence.tabContent${t}`]=i}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$.tabId}`];this.ref["tabs-indicator"].style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=qt(this.$["*originalUrl"],e,this.$["*editorTransformations"]);this._cancelPreload&&this._cancelPreload();let{cancel:i}=St([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",(e=>{e&&setTimeout((()=>{this._activateTab(this.$.tabId,{fromViewer:!0})}),0)})),this.sub("*currentFilter",(e=>{this.$["*operationTooltip"]=this.l10n(e||oi),this.ref["tooltip-el"].className=Tt("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e})})),this.sub("*currentOperation",(e=>{this.$.tabId===Ot&&(this.$["*operationTooltip"]=e,this.ref["tooltip-el"].className=Tt("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e}))})),this.sub("*tabId",(e=>{e===Bt&&(this.$["*operationTooltip"]=this.$["*currentFilter"]),this.ref["tooltip-el"].className=Tt("filter-tooltip",{"filter-tooltip_visible":e===Bt,"filter-tooltip_hidden":e!==Bt})})),this.sub("*originalUrl",(e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()})),this.sub("*editorTransformations",(e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)})),this.sub("*loadingOperations",(e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,e]of i.entries())if(e){t=!0;break}}this._debouncedShowLoader(t)})),this.sub("*showSlider",(e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}))}}_i.template=`\n<uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>\n<div class="filter-tooltip_container">\n  <div class="filter-tooltip_wrapper">\n    <div ref="tooltip-el" class="filter-tooltip filter-tooltip_visible">\n      {{*operationTooltip}}\n    </div>\n  </div>\n</div>\n<div class="toolbar-container">\n  <uc-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">\n      <div class="tab-content-row">\n      ${zt.map((function(e){return`\n    <uc-presence-toggle class="tab-content" set="visible: presence.tabContent${e}; styles: presence.tabContentStyles">\n        <uc-editor-scroller hidden-scrollbar>\n          <div class="controls-list_align">\n            <div class="controls-list_inner" ref="controls-list-${e}">\n            </div>\n          </div>\n        </uc-editor-scroller>\n    </uc-presence-toggle>\n  `})).join("")}\n      </div>\n      <div class="controls-row">\n        <uc-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel">\n        </uc-btn-ui>\n        <div class="tab-toggles">\n          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>\n          ${zt.map((function(e){return`\n    <uc-btn-ui theme="boring" ref="tab-toggle-${e}" data-id="${e}" icon="${e}" tabindex="0" set="onclick: on.clickTab;">\n    </uc-btn-ui>\n  `})).join("")}\n        </div>\n        <uc-btn-ui theme="primary" icon="done" set="onclick: on.apply">\n        </uc-btn-ui>\n      </div>\n  </uc-presence-toggle>\n  <uc-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">\n      <div class="slider">\n        <uc-editor-slider ref="slider-el"></uc-editor-slider>\n      </div>\n      <div class="controls-row">\n        <uc-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;">\n        </uc-btn-ui>\n        <uc-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;">\n        </uc-btn-ui>\n      </div>\n  </uc-presence-toggle>\n</div>\n`;class vi extends qe{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",(e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}))}_iconCss(){return Tt("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",(e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()})),this.sub("theme",(e=>{"custom"!==e&&(this.className=e)})),this.sub("text",(e=>{this._iconSingle=!1})),this.setAttribute("role","button"),-1===this.tabIndex&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}vi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),vi.template='\n<uc-icon size="20" set="className: iconCss; @name: icon;"></uc-icon>\n<div class="text">{{text}}</div>\n';class yi extends qe{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",(e=>{"boolean"==typeof e&&(e?this._start():this._stop())}))}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}yi.template='\n  <div class="inner">\n    <div class="line" ref="line-el"></div>\n  </div>\n';const wi="transition",$i="visible",Ci="hidden";class xi extends qe{constructor(){super(),this._visible=!1,this._visibleStyle=$i,this._hiddenStyle=Ci,this._externalTransitions=!1,this.defineAccessor("styles",(e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)})),this.defineAccessor("visible",(e=>{"boolean"==typeof e&&(this._visible=e,this._handleVisible())}))}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",function(e,...t){let i=xt(...t);for(let t of Object.keys(i))e.classList.toggle(t,i[t])}(this,{[wi]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(wi),this._handleVisible(),setTimeout((()=>this.removeAttribute("hidden")),0)}}xi.template="\n<slot></slot>\n";class Ti extends qe{init$={disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}};constructor(){super(),this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",(e=>{this.$.disabled=e})),this.defineAccessor("min",(e=>{this.$.min=e})),this.defineAccessor("max",(e=>{this.$.max=e})),this.defineAccessor("defaultValue",(e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)})),this.defineAccessor("zero",(e=>{this._zero=e})),this.defineAccessor("onInput",(e=>{e&&(this.$.onInput=e)})),this.defineAccessor("onChange",(e=>{e&&(this.$.onChange=e)}))}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this.ref["thumb-el"].style.transform=`translateX(${i}px)`}))}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame((()=>{this._zeroDotEl.style.transform=`translateX(${i}px)`}))}_updateSteps(){let e=this.ref["steps-el"],{width:t}=e.getBoundingClientRect(),i=Math.ceil(t/2),s=Math.ceil(i/15)-2;if(this._stepsCount===s)return;let n=document.createDocumentFragment(),r=document.createElement("div"),a=document.createElement("div");r.className="minor-step",a.className="border-step",n.appendChild(a);for(let e=0;e<s;e++)n.appendChild(r.cloneNode());n.appendChild(a.cloneNode());for(let e=0;e<s;e++)n.appendChild(r.cloneNode());n.appendChild(a.cloneNode());let o=document.createElement("div");o.className="zero-dot",n.appendChild(o),this._zeroDotEl=o,e.innerHTML="",e.appendChild(n),this._stepsCount=s}connectedCallback(){super.connectedCallback(),this._updateSteps(),this._observer=new di((()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)})),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout((()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),0),this.sub("disabled",(e=>{let t=this.ref["input-el"];e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")}));let e=this.ref["input-el"];e.addEventListener("focus",(()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")})),e.addEventListener("blur",(()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")}))}disconnectedCallback(){this._observer.unobserve(this),this._observer=void 0}}Ti.template='\n  <div class="steps" ref="steps-el">\n  </div>\n  <div ref="thumb-el" class="thumb"></div>\n  <input class="input" type=\'range\' ref=\'input-el\' tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;">\n';let Ai={};window.addEventListener("message",(e=>{let t;try{t=JSON.parse(e.data)}catch(e){return}if(t?.type in Ai){let i=Ai[t.type];for(let[s,n]of i)e.source===s&&n(t)}}));function ki({textColor:e,backgroundColor:t,linkColor:i,linkColorHover:s,shadeColor:n}){let r=`solid 1px ${n}`;return a={body:{color:e,"background-color":t},".side-bar":{background:"inherit","border-right":r},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:n},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":r},".list-table-body .list-items":{"border-bottom":r},".bread-crumbs a":{color:i},".bread-crumbs a:hover":{color:s},".main-content.loading":{background:`${t} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${n}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:i},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:s},".side-bar-menu a":{color:i},".side-bar-menu a:hover":{color:s},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:s},".source-vk .side-bar-menu a":{color:i},".source-vk .side-bar-menu a:hover":{color:s,background:"none"}},Object.keys(a).reduce(((e,t)=>{let i=a[t],s=Object.keys(i).reduce(((e,t)=>e+`${t}: ${i[t]};`),"");return e+`${t}{${s}}`}),"");var a}class Ei extends qe{activityType=qe.activities.EXTERNAL;init$={counter:0,onDone:()=>{this.$["*currentActivity"]=qe.activities.UPLOAD_LIST},onCancel:()=>{this.cancelFlow()}};_iframe=null;initCallback(){this.registerActivity(this.activityType,(()=>{let{externalSourceType:e}=this.activityParams;this.set$({"*activityCaption":`${e[0].toUpperCase()}${e.slice(1)}`,"*activityIcon":e}),this.$.counter=0,this.mountIframe()})),this.sub("*currentActivity",(e=>{e!==this.activityType&&this.unmountIframe()}))}sendMessage(e){this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){this.$.counter=this.$.counter+1;let{url:t,filename:i}=e;this.uploadCollection.add({externalUrl:t,fileName:i})}handleIframeLoad(e){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:ki(e)})}remoteUrl(){let e=this.$["*--cfg-pubkey"],t=(!1).toString(),{externalSourceType:i}=this.activityParams;return`https://social.uploadcare.com/window3/${i}?lang=en&public_key=${e}&widget_version=3.11.3&images_only=${t}&pass_window_open=false`}mountIframe(){let e=q({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});var t,i,s;e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),t="file-selected",i=e.contentWindow,s=this.handleFileSelected.bind(this),t in Ai||(Ai[t]=[]),Ai[t].push([i,s]),this._iframe=e}unmountIframe(){var e,t;this._iframe&&(e="file-selected",t=this._iframe.contentWindow,e in Ai&&(Ai[e]=Ai[e].filter((e=>e[0]!==t)))),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}}Ei.template='\n<div\n  ref="iframeWrapper"\n  class="iframe-wrapper">\n</div>\n<div class="toolbar">\n  <button\n    class="cancel-btn secondary-btn"\n    set="onclick: onCancel"\n    l10n="cancel">\n  </button>\n  <div></div>\n  <div class="selected-counter">\n    <span l10n="selected-count"></span>{{counter}}</div>\n  <button class="done-btn primary-btn" set="onclick: onDone">\n    <uc-icon name="check"></uc-icon>\n  </button>\n</div>\n';class Si extends qe{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach((t=>{t.getAttribute("tab-ctx")===e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}));for(let t in this._tabMap)t===e?this._tabMap[t].setAttribute("current",""):this._tabMap[t].removeAttribute("current")}initCallback(){this._tabMap={},this.defineAccessor("tab-list",(e=>{if(!e)return;e.split(",").map((e=>e.trim())).forEach((e=>{let t=q({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(e)}}});t.textContent=this.l10n(e),this.ref.row.appendChild(t),this._tabMap[e]=t}))})),this.defineAccessor("default",(e=>{this.setCurrentTab(e)})),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}Si.bindAttributes({"tab-list":null,default:null}),Si.template='\n<div ref="row" class="tabs-row"></div>\n<div ref="context" class="tabs-context">\n  <slot></slot>\n</div>\n';class Ii extends qe{initCallback(){let e=this.getAttribute("from");this.sub(e||Ii.defaultFrom,(e=>{if(e){if(this.hasAttribute(Ii.fireEventAttrName)&&this.dispatchEvent(new CustomEvent(Ii.outputEventName,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(Ii.templateAttrName)){let t=this.getAttribute(Ii.templateAttrName),i="";e.forEach((e=>{let s=t;for(let t in e)s=s.split(`{{${t}}}`).join(e[t]);i+=s})),this.innerHTML=i}this.value=e,this.hasAttribute(Ii.formValueAttrName)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this.appendChild(this._input)),this._input.value=JSON.stringify(e)),this.hasAttribute(Ii.consoleAttrName)&&console.log(e)}else this.innerHTML=""}))}}Ii.outputEventName="data-output",Ii.templateAttrName="item-template",Ii.fireEventAttrName="fire-event",Ii.consoleAttrName="console",Ii.formValueAttrName="form-value",Ii.defaultFrom="*outputData";class Li extends qe{init$={"*activityCaption":void 0}}Li.template='\n<div class="caption">{{*activityCaption}}</div>\n';class Pi extends qe{init$={"*activityIcon":"default"}}Pi.template='\n<uc-icon set="@name: *activityIcon"></uc-icon>\n';class Ui extends qe{}Ui.template='\n<uc-simple-btn></uc-simple-btn>\n\n<uc-modal strokes block-body-scrolling>\n  <uc-activity-icon slot="heading"></uc-activity-icon>\n  <uc-activity-caption slot="heading"></uc-activity-caption>\n  <uc-start-from>\n    <uc-source-list wrap></uc-source-list>\n    <uc-drop-area></uc-drop-area>\n  </uc-start-from>\n  <uc-upload-list></uc-upload-list>\n  <uc-camera-source></uc-camera-source>\n  <uc-url-source></uc-url-source>\n  <uc-external-source></uc-external-source>\n  <uc-upload-details></uc-upload-details>\n  <uc-confirmation-dialog></uc-confirmation-dialog>\n  <uc-cloud-image-editor></uc-cloud-image-editor>\n</uc-modal>\n\n<uc-message-box></uc-message-box>\n<uc-progress-bar-common></uc-progress-bar-common>\n';class Ri extends qe{init$={selectClicked:()=>{this.openSystemDialog()}};initCallback(){this.$["*currentActivity"]=this.initActivity||qe.activities.START_FROM}}function Ni(e){for(let t in e){let i=[...t].reduce(((e,t)=>(t.toUpperCase()===t&&(t="-"+t.toLowerCase()),e+t)),"");i.startsWith("-")&&(i=i.replace("-","")),i.startsWith("uc-")||(i="uc-"+i),e[t].reg?.(i)}}Ri.template='\n  <uc-start-from>\n    <uc-drop-area>\n      <button\n        l10n="drop-files-here"\n        set="onclick: selectClicked">\n      </button>\n    </uc-drop-area>\n  </uc-start-from>\n  <uc-upload-list></uc-upload-list>\n  <uc-message-box></uc-message-box>\n';var Mi=Object.freeze({__proto__:null,BaseComponent:z,Data:L,TypedCollection:j,TypedData:F,Block:qe,Icon:Ke,Img:class extends Ye{initCallback(){super.initCallback(),this.sub$$("src",(()=>{this.init()})),this.sub$$("uuid",(()=>{this.init()})),this.sub$$("lazy",(e=>{this.$$("is-background-for")||(this.img.loading=e?"lazy":"eager")}))}},SimpleBtn:Qe,StartFrom:class extends qe{activityType="start-from";init$={"*activityCaption":"","*activityIcon":""};initCallback(){super.initCallback(),this.registerActivity(this.activityType,(()=>{this.set$({"*activityCaption":this.l10n("select-file-source"),"*activityIcon":"default"})}))}},DropArea:class extends qe{init$={state:it.INACTIVE};initCallback(){this._destroyDropzone=rt({element:this,onChange:e=>{this.$.state=e},onFiles:e=>{e.forEach((e=>{this.uploadCollection.add({file:e,isImage:e.type.includes("image"),mimeType:e.type,fileName:e.name,fileSize:e.size})})),this.set$({"*currentActivity":qe.activities.UPLOAD_LIST})}}),this.sub("state",(e=>{const t=Object.entries(it).find((([,t])=>t===e))?.[0].toLowerCase();t&&this.setAttribute("drag-state",t)}))}destroyCallback(){this._destroyDropzone?.()}},SourceBtn:at,SourceList:class extends qe{initCallback(){super.initCallback(),this.bindCssData("--cfg-source-list"),this.sub("*--cfg-source-list",(e=>{if(!e)return;let t=e.split(",").map((e=>e.trim())),i="";t.forEach((e=>{i+=`<uc-source-btn type="${e}"></uc-source-btn>`})),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=i:this.outerHTML=i}))}},FileItem:ut,Modal:pt,UploadList:bt,UrlSource:ft,CameraSource:vt,UploadDetails:yt,MessageBox:lt,ConfirmationDialog:gt,ProgressBarCommon:wt,ProgressBar:$t,EditableCanvas:Ct,CloudImageEditor:class extends qe{activityType=qe.activities.CLOUD_IMG_EDIT;init$={uuid:null};initCallback(){this.bindCssData("--cfg-pubkey"),this.sub("*currentActivity",(e=>{e===qe.activities.CLOUD_IMG_EDIT?this.mountEditor():this.unmountEditor()})),this.sub("*focusedEntry",(e=>{e&&(this.entry=e,this.entry.subscribe("uuid",(e=>{e&&(this.$.uuid=e)})))}))}handleApply(e){let t=e.detail,{transformationsUrl:i}=t;this.entry.setValue("transformationsUrl",i),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let e=new Kt;e.classList.add("uc-cldtr-common");let t=this.$.uuid;e.setAttribute("uuid",t),e.addEventListener("apply",(e=>this.handleApply(e))),e.addEventListener("cancel",(()=>this.handleCancel())),this.innerHTML="",this.appendChild(e)}unmountEditor(){this.innerHTML=""}},ExternalSource:Ei,Tabs:Si,DataOutput:Ii,ActivityCaption:Li,ActivityIcon:Pi,FileUploaderRegular:Ui,FileUploaderMinimal:Ri,registerBlocks:Ni,CloudEditor:Kt,CropFrame:ii,EditorCropButtonControl:ni,EditorFilterControl:ci,EditorOperationControl:hi,EditorImageCropper:mi,EditorImageFader:class extends qe{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=At(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{i?.get(t)?.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame((()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}}))}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let n={...this._transformations};return i&&(n[i]=t?{name:t,amount:s}:s),qt(e,this.offsetWidth,n)}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find((e=>e.value===i));if(s())return;let n=this._constructKeypoint(e,i),r=new Image;r.src=n.src;let a=this._handleImageLoading(n.src);r.addEventListener("load",a,{once:!0}),r.addEventListener("error",a,{once:!0}),n.image=r,r.classList.add("fader-image"),r.addEventListener("load",(()=>{if(s())return;let t=this._keypoints,a=t.findIndex((e=>e.value>i)),o=a<t.length?t[a].image:null;!this._container||o&&!this._container.contains(o)||(t.splice(a,0,n),this._container.insertBefore(r,o),this._update(e,i))}),{once:!0}),r.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}set(e){e="string"==typeof e?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=Ht[e],s=this._keypoints.map((e=>e.value)),n=function(e,t,i){let s=(n=e,n.reduce(((e,t,i)=>i<n.length-1?[...e,[t,n[i+1]]]:e),[])).find((([e,i])=>e<=t&&t<=i));var n;return e.map((e=>{let n=Math.abs(s[0]-s[1]),r=Math.abs(t-s[0])/n;return s[0]===e?t>i?1:1-r:s[1]===e?t>=i?r:1:0}))}(s,t,i),r=function(e,t){return e.map(((i,s)=>i<t?e.length-s:s))}(s,i);for(let[e,t]of Object.entries(this._keypoints))t.opacity=n[e],t.zIndex=r[e];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map((e=>e.src)),{images:s,promise:n,cancel:r}=St(i);s.forEach((e=>{let t=this._handleImageLoading(e.src);e.addEventListener("load",t),e.addEventListener("error",t)})),this._cancelLastImages=()=>{r(),this._cancelLastImages=void 0};let a=this._operation,o=this._filter;await n,this._isActive&&this._isSame(a,o)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach(((e,t)=>{let i=s[t];i.classList.add("fader-image"),e.image=i,this._container.appendChild(i)})),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=bi(i,s).map((s=>this._imageSrc({url:e,filter:t,operation:i,value:s}))),{cancel:r}=St(n);this._cancelBatchPreload=r}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e)return t.style.opacity="1",t.style.transform="scale(1)",void(this.className=Tt({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1}));t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",(()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=Tt({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1}))}),{once:!0}),t.addEventListener("error",(()=>{this.$["*networkProblems"]=!0}),{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=n,"number"!=typeof i&&!s){let e=this._imageSrc({operation:t,value:i});return this._setOriginalSrc(e),void(this._container&&this._container.remove())}this._keypoints=bi(t,i).map((e=>this._constructKeypoint(t,e))),this._update(t,i),this._initNodes()}deactivate({hide:e=!0,seamlessTransition:t=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=Tt({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:t,inactive_rough:!t}),this.addEventListener("transitionend",(()=>{this._container&&this._container.remove()}),{once:!0})):this._container&&this._container.remove()}},EditorScroller:fi,EditorSlider:li,EditorToolbar:_i,UcBtnUi:vi,LineLoaderUi:yi,PresenceToggle:xi,SliderUi:Ti});function Di(e,t,i){const s=e.slice();return s[2]=t[i],s}function Oi(e){let t,i;return{c(){t=u("img"),l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/-/preview/-/scale_crop/400x400/")||m(t,"src",i),m(t,"width","200"),m(t,"alt","Uploadcare uploaded file")},m(e,i){h(e,t,i)},p(e,s){1&s&&!l(t.src,i="https://ucarecdn.com/"+e[2].uuid+"/-/preview/-/scale_crop/400x400/")&&m(t,"src",i)},d(e){e&&d(t)}}}function Bi(t){let i,s,n,r,a,o,l,b,f=t[0],_=[];for(let e=0;e<f.length;e+=1)_[e]=Oi(Di(t,f,e));return{c(){i=u("div"),s=u("uc-file-uploader-regular"),n=p(),r=u("uc-data-output"),a=p(),o=u("div");for(let e=0;e<_.length;e+=1)_[e].c();g(s,"class","uploader-cfg uc-wgt-common svelte-1d53i1x"),g(r,"fire-event",""),g(r,"class","uploader-cfg uc-wgt-common svelte-1d53i1x"),m(o,"class","output svelte-1d53i1x"),m(i,"class","wrapper svelte-1d53i1x")},m(e,d){h(e,i,d),c(i,s),c(i,n),c(i,r),c(i,a),c(i,o);for(let e=0;e<_.length;e+=1)_[e].m(o,null);var u,p,m,g;l||(u=r,p="data-output",m=t[1],u.addEventListener(p,m,g),b=()=>u.removeEventListener(p,m,g),l=!0)},p(e,[t]){if(1&t){let i;for(f=e[0],i=0;i<f.length;i+=1){const s=Di(e,f,i);_[i]?_[i].p(s,t):(_[i]=Oi(s),_[i].c(),_[i].m(o,null))}for(;i<_.length;i+=1)_[i].d(1);_.length=f.length}},i:e,o:e,d(e){e&&d(i),function(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}(_,e),l=!1,b()}}}function zi(e,t,i){Ni(Mi);let s=[];return[s,function(e){const{data:t}=e.detail;i(0,s=t)}]}return new class extends class{$destroy(){!function(e,t){const i=e.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}(this,1),this.$destroy=e}$on(e,t){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}{constructor(e){super(),I(this,e,zi,Bi,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
